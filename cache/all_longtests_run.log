============================================================
Running all long tests to populate cache/longtest_results/
============================================================

============================================================
Running: longtest_phasetype_exact.jl
============================================================
✗ longtest_phasetype_exact.jl FAILED: LoadError("/Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_exact.jl", 42, LoadError("/Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/src/phasetype_longtest_helpers.jl", 20, UndefVarError(:FormulaTerm, 0x000000000000990f, Main)))

============================================================
Running: longtest_phasetype_panel.jl
============================================================

======================================================================
Phase-Type Hazard Models: Panel & Mixed Data Long Tests
======================================================================
Testing inference for Coxian phase-type models with intermittent observations.
These models are Markov on expanded state space → direct likelihood (no MCEM).
Default sample size: n=1000

--- Simple 2-State Phase-Type with Panel Data ---
Observed states: 2, Expanded phases: 3
State 1 → phases 1:2
State 2 → phases 3:3
Phase-Type Panel: Simple 2-State Model: Error During Test at /Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:232
  Got exception outside of a @test
  UndefVarError: `build_phasetype_model` not defined in `Main`
  Suggestion: check for spelling errors or missing imports.
  Stacktrace:
   [1] top-level scope
     @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:233
   [2] macro expansion
     @ ~/.julia/juliaup/julia-1.12.2+0.aarch64.apple.darwin14/share/julia/stdlib/v1.12/Test/src/Test.jl:1776 [inlined]
   [3] macro expansion
     @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:250 [inlined]
   [4] include(mapexpr::Function, mod::Module, _path::String)
     @ Base ./Base.jl:307
   [5] top-level scope
     @ ./none:24
   [6] eval(m::Module, e::Any)
     @ Core ./boot.jl:489
   [7] exec_options(opts::Base.JLOptions)
     @ Base ./client.jl:283
   [8] _start()
     @ Base ./client.jl:550
Test Summary:                          | Error  Total  Time
Phase-Type Panel: Simple 2-State Model |     1      1  1.3s
RNG of the outermost testset: Xoshiro(0xf3bbc534959b1931, 0xc9f3d9fb9de02a92, 0x91e98dc6ca0ed5e7, 0x9f55581917bf759d, 0x867c80b907c1fdb5)
✗ longtest_phasetype_panel.jl FAILED: LoadError("/Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl", 232, Test.TestSetException(0, 0, 1, 0, Union{Test.Error, Test.Fail}[Test.Error(:nontest_error, "()", "UndefVarError(:build_phasetype_model, 0x0000000000009984, Main)", "UndefVarError: `build_phasetype_model` not defined in `Main`\nSuggestion: check for spelling errors or missing imports.\nStacktrace:\n [1] top-level scope\n   @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:233\n [2] macro expansion\n   @ ~/.julia/juliaup/julia-1.12.2+0.aarch64.apple.darwin14/share/julia/stdlib/v1.12/Test/src/Test.jl:1776 [inlined]\n [3] macro expansion\n   @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:250 [inlined]\n [4] include(mapexpr::Function, mod::Module, _path::String)\n   @ Base ./Base.jl:307\n [5] top-level scope\n   @ ./none:24\n [6] eval(m::Module, e::Any)\n   @ Core ./boot.jl:489\n [7] exec_options(opts::Base.JLOptions)\n   @ Base ./client.jl:283\n [8] _start()\n   @ Base ./client.jl:550", :(#= /Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_phasetype_panel.jl:232 =#))]))

============================================================
Running: longtest_mcem_splines.jl
============================================================
MCEM Spline vs Exponential: Error During Test at /Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:95
  Got exception outside of a @test
  ArgumentError: knots vector must contain at least 1 knot, got empty vector
  Stacktrace:
   [1] Hazard(hazard::StatsModels.FormulaTerm{StatsModels.ConstantTerm{Int64}, StatsModels.ConstantTerm{Int64}}, family::String, statefrom::Int64, stateto::Int64; degree::Int64, knots::Vector{Float64}, boundaryknots::Vector{Float64}, natural_spline::Bool, extrapolation::String, monotone::Int64, n_phases::Int64, coxian_structure::Symbol, covariate_constraints::Symbol, time_transform::Bool, linpred_effect::Symbol)
     @ MultistateModels ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/src/construction/hazard_constructors.jl:224
   [2] macro expansion
     @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:131 [inlined]
   [3] macro expansion
     @ ~/.julia/juliaup/julia-1.12.2+0.aarch64.apple.darwin14/share/julia/stdlib/v1.12/Test/src/Test.jl:1776 [inlined]
   [4] top-level scope
     @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:96
   [5] include(mapexpr::Function, mod::Module, _path::String)
     @ Base ./Base.jl:307
   [6] top-level scope
     @ ./none:24
   [7] eval(m::Module, e::Any)
     @ Core ./boot.jl:489
   [8] exec_options(opts::Base.JLOptions)
     @ Base ./client.jl:283
   [9] _start()
     @ Base ./client.jl:550
Test Summary:              | Error  Total   Time
MCEM Spline vs Exponential |     1      1  20.5s
RNG of the outermost testset: Xoshiro(0xf3bbc534959b1931, 0xc9f3d9fb9de02a92, 0x91e98dc6ca0ed5e7, 0x9f55581917bf759d, 0x867c80b907c1fdb5)
✗ longtest_mcem_splines.jl FAILED: LoadError("/Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl", 95, Test.TestSetException(0, 0, 1, 0, Union{Test.Error, Test.Fail}[Test.Error(:nontest_error, "()", "ArgumentError(\"knots vector must contain at least 1 knot, got empty vector\")", "ArgumentError: knots vector must contain at least 1 knot, got empty vector\nStacktrace:\n [1] Hazard(hazard::StatsModels.FormulaTerm{StatsModels.ConstantTerm{Int64}, StatsModels.ConstantTerm{Int64}}, family::String, statefrom::Int64, stateto::Int64; degree::Int64, knots::Vector{Float64}, boundaryknots::Vector{Float64}, natural_spline::Bool, extrapolation::String, monotone::Int64, n_phases::Int64, coxian_structure::Symbol, covariate_constraints::Symbol, time_transform::Bool, linpred_effect::Symbol)\n   @ MultistateModels ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/src/construction/hazard_constructors.jl:224\n [2] macro expansion\n   @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:131 [inlined]\n [3] macro expansion\n   @ ~/.julia/juliaup/julia-1.12.2+0.aarch64.apple.darwin14/share/julia/stdlib/v1.12/Test/src/Test.jl:1776 [inlined]\n [4] top-level scope\n   @ ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:96\n [5] include(mapexpr::Function, mod::Module, _path::String)\n   @ Base ./Base.jl:307\n [6] top-level scope\n   @ ./none:24\n [7] eval(m::Module, e::Any)\n   @ Core ./boot.jl:489\n [8] exec_options(opts::Base.JLOptions)\n   @ Base ./client.jl:283\n [9] _start()\n   @ Base ./client.jl:550", :(#= /Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_mcem_splines.jl:95 =#))]))

============================================================
Running: longtest_spline_exact.jl
============================================================

  ▶ Running: sp_exact_nocov
┌ Warning: No transitions observed in data (all statefrom == stateto). Falling back to :crude initialization. If this is template data for simulation, consider using `initialize=false` when creating the model.
└ @ MultistateModels ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/src/utilities/initialization.jl:467
    Data: 1000 subjects, 979 transitions, max_t=10.0
    Spline: degree=1, knots=[5.0], boundary=[0.0, 10.0]

    Hazard h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    1.0       0.2100      0.1909      0.091       ✓
    2.0       0.2771      0.2493      0.100       ✓
    4.0       0.3656      0.3662      0.002       ✓
    6.0       0.4300      0.4559      0.060       ✓
    8.0       0.4825      0.5184      0.075       ✓
    10.0      0.5275      0.5810      0.101       ✓
    -------------------------------------------------------

    Cumulative H(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    2.0       0.3959      0.3817      0.036       ✓
    4.0       1.0447      0.9972      0.045       ✓
    6.0       1.8429      1.8329      0.005       ✓
    8.0       2.7569      2.8073      0.018       ✓
    10.0      3.7678      3.9067      0.037       ✓
    -------------------------------------------------------
  ✓ sp_exact_nocov: PASS
Test Summary:                                | Pass  Total   Time
Spline Exact: No Covariates (sp_exact_nocov) |    7      7  18.0s

  ▶ Running: Spline Boundary Behavior Check (informational)

    Boundary region hazard comparison (relaxed tolerance = 60%):
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    0.10      0.0836      0.1502      0.797       ⚠
┌ Warning: Boundary region: Large deviation at t=0.1 (79.7% error). This is expected behavior for splines near boundaries.
└ @ Main ~/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/longtests/longtest_spline_exact.jl:306
    0.30      0.1297      0.1623      0.251       ✓
    0.50      0.1592      0.1744      0.096       ✓
    0.70      0.1821      0.1864      0.024       ✓
    1.00      0.2100      0.2046      0.026       ✓
    -------------------------------------------------------
    Note: Boundary deviations are expected and do not indicate a bug.
[ Info: Boundary behavior summary: 1/5 times exceeded 60% tolerance (expected)
  ✓ Boundary behavior check complete (informational only)
Test Summary:                            | Pass  Total  Time
Spline Boundary Behavior (INFORMATIONAL) |    2      2  0.5s

  ▶ Running: sp_exact_tfc
    Data: 1000 subjects, 988 transitions, x=0: 501, x=1: 499

    Baseline (x=0):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    0.5       0.1592      0.1763      0.108       ✓
    1.0       0.2100      0.2088      0.006       ✓
    2.0       0.2771      0.2737      0.012       ✓
    4.0       0.3656      0.4036      0.104       ✓
    6.0       0.4300      0.4613      0.073       ✓
    8.0       0.4825      0.4466      0.074       ✓
    -------------------------------------------------------

    With covariate (x=1):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    0.5       0.2624      0.2949      0.124       ✓
    1.0       0.3462      0.3492      0.008       ✓
    2.0       0.4569      0.4578      0.002       ✓
    4.0       0.6028      0.6751      0.120       ✓
    6.0       0.7090      0.7714      0.088       ✓
    8.0       0.7954      0.7469      0.061       ✓
    -------------------------------------------------------

    Log hazard ratio (beta) validation:
    Time      True β      Fitted β    Abs Diff    Status
    -------------------------------------------------------
    0.5       0.5000      0.5143      0.014       ✓
    1.0       0.5000      0.5143      0.014       ✓
    2.0       0.5000      0.5143      0.014       ✓
    4.0       0.5000      0.5143      0.014       ✓
    6.0       0.5000      0.5143      0.014       ✓
    8.0       0.5000      0.5143      0.014       ✓
    -------------------------------------------------------
  ✓ sp_exact_tfc: PASS
Test Summary:                                     | Pass  Total   Time
Spline Exact: Time-Fixed Covariate (sp_exact_tfc) |    5      5  10.7s

  ▶ Running: sp_exact_tvc
    Data: 1000 subjects, 994 transitions, changepoint=5.0

    Before changepoint (t < 5.0, x=0):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    1.0       0.2100      0.1987      0.054       ✓
    2.0       0.2771      0.2543      0.082       ✓
    3.0       0.3259      0.3100      0.049       ✓
    4.0       0.3656      0.3656      0.000       ✓
    -------------------------------------------------------

    After changepoint (t >= 5.0, x=1):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    6.0       0.7090      0.6880      0.030       ✓
    7.0       0.7541      0.7516      0.003       ✓
    8.0       0.7954      0.8152      0.025       ✓
    9.0       0.8338      0.8787      0.054       ✓
    -------------------------------------------------------

    Covariate effect consistency (β = 0.5):
    Time      Fitted β    True β      Abs Diff    Status
    -------------------------------------------------------
    3.0       0.3938      0.5000      0.106       ✓
    6.0       0.3938      0.5000      0.106       ✓
    9.0       0.3938      0.5000      0.106       ✓
    -------------------------------------------------------
  ✓ sp_exact_tvc: PASS
Test Summary:                                       | Pass  Total  Time
Spline Exact: Time-Varying Covariate (sp_exact_tvc) |    5      5  1.0s

  ▶ Running: sp_aft_exact_nocov
    Data: 1000 subjects, 985 transitions, max_t=10.0
    Spline: degree=1, knots=[5.0], AFT mode

    Hazard h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    1.0       0.2100      0.1931      0.081       ✓
    2.0       0.2771      0.2568      0.073       ✓
    4.0       0.3656      0.3844      0.051       ✓
    6.0       0.4300      0.4775      0.111       ✓
    8.0       0.4825      0.5363      0.112       ✓
    -------------------------------------------------------

    Cumulative H(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    2.0       0.3959      0.3861      0.025       ✓
    4.0       1.0447      1.0273      0.017       ✓
    6.0       1.8429      1.9064      0.034       ✓
    8.0       2.7569      2.9203      0.059       ✓
    10.0      3.7678      4.0516      0.075       ✓
    -------------------------------------------------------
  ✓ sp_aft_exact_nocov: PASS
Test Summary:                                        | Pass  Total  Time
Spline AFT Exact: No Covariates (sp_aft_exact_nocov) |    7      7  1.5s

  ▶ Running: sp_aft_exact_tfc
    Data: 1000 subjects, 911 transitions, x=0: 502, x=1: 498

    Baseline (x=0):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    0.5       0.1592      0.1543      0.031       ✓
    1.0       0.2100      0.1917      0.087       ✓
    2.0       0.2771      0.2666      0.038       ✓
    4.0       0.3656      0.4165      0.139       ✓
    6.0       0.4300      0.4542      0.056       ✓
    8.0       0.4825      0.3800      0.212       ✓
    -------------------------------------------------------

    With covariate (x=1):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    0.5       0.0790      0.0825      0.044       ✓
    1.0       0.1043      0.0957      0.082       ✓
    2.0       0.1376      0.1221      0.113       ✓
    4.0       0.1816      0.1748      0.037       ✓
    6.0       0.2135      0.2275      0.066       ✓
    8.0       0.2396      0.2803      0.170       ✓
    -------------------------------------------------------

    Cumulative hazard comparison:
    Time      H_true(x=0)  H_fit(x=0)  H_true(x=1)  H_fit(x=1)
    -----------------------------------------------------------------
    2.0       0.3959       0.3835       0.1966       0.1914      
    4.0       1.0447       1.0666       0.5188       0.4882      
    6.0       1.8429       1.9933       0.9152       0.8905      
    -----------------------------------------------------------------
  ✓ sp_aft_exact_tfc: PASS
Test Summary:                                             | Pass  Total  Time
Spline AFT Exact: Time-Fixed Covariate (sp_aft_exact_tfc) |    7      7  1.4s

  ▶ Running: sp_aft_exact_tvc
    Data: 1000 subjects, 924 transitions, changepoint=5.0

    Before changepoint (t < 5.0, x=0):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    1.0       0.2100      0.1752      0.166       ✓
    2.0       0.2771      0.2376      0.142       ✓
    3.0       0.3259      0.3000      0.079       ✓
    4.0       0.3656      0.3625      0.009       ✓
    -------------------------------------------------------

    After changepoint (t >= 5.0, x=1):

    h(t) comparison:
    Time      True        Fitted      Rel Diff    Status
    -------------------------------------------------------
    6.0       0.2135      0.1558      0.270       ✓
    7.0       0.2271      0.1721      0.242       ✓
    8.0       0.2396      0.1885      0.213       ✓
    9.0       0.2511      0.2048      0.184       ✓
    -------------------------------------------------------

    AFT effect check (comparing hazard ratios):
    Time      h(x=0)      h(x=1)      log(HR)     Expected*
    ------------------------------------------------------------
    *Expected for Weibull AFT: -β×shape = -0.7
    3.0       0.3000      0.1068      -1.0334     -0.7000    
    6.0       0.4759      0.1558      -1.1166     -0.7000    
    9.0       0.6288      0.2048      -1.1216     -0.7000    
    ------------------------------------------------------------
  ✓ sp_aft_exact_tvc: PASS
Test Summary:                                               | Pass  Total  Time
Spline AFT Exact: Time-Varying Covariate (sp_aft_exact_tvc) |    7      7  0.7s
✓ longtest_spline_exact.jl completed

============================================================
Done! Results saved to cache/longtest_results/
============================================================
