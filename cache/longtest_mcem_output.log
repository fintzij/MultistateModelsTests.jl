  ▸ [MCEM] Section 1: Exponential hazards (Markov panel solver)
    ▸ Exponential panel (Markov) - No Covariates

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit https://github.com/coin-or/Ipopt
******************************************************************************


    Parameter Comparison: Exponential - No Covariates
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    rate_12           0.2000      0.1989      0.0011      0.5%
    rate_23           0.1500      0.1430      0.0070      4.7%
    ----------------------------------------------------------------------
Test Summary:                              | Pass  Total   Time
Exponential panel (Markov) - No Covariates |    6      6  35.5s
    ▸ Exponential panel (Markov) - With Covariate

    Parameter Comparison: Exponential - With Covariate
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    rate_12           0.2000      0.2065      0.0065      3.2%
    beta_12           0.4000      0.3321      0.0679      17.0%
    rate_23           0.1500      0.1480      0.0020      1.4%
    beta_23           -0.3000     -0.3694     0.0694      23.1%
    ----------------------------------------------------------------------
Test Summary:                               | Pass  Total  Time
Exponential panel (Markov) - With Covariate |    4      4  6.1s
  ▸ [MCEM] Section 2: Weibull hazards
    ▸ MCEM Weibull - No Covariates
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using model's Markov surrogate for MCEM.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -4533.169
Initial estimate of the log marginal likelihood: -3419.979

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4530.026
Gain in marginal log-likelihood, ΔQ: 3.14
MCEM asymptotic standard error: 0.162
Ascent lower and upper bound: [2.94, 3.35]
Estimate of the log marginal likelihood, l(θ): -3416.173
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4527.785
Gain in marginal log-likelihood, ΔQ: 0.156
MCEM asymptotic standard error: 0.0359
Ascent lower and upper bound: [0.11, 0.202]
Estimate of the log marginal likelihood, l(θ): -3415.985
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4527.259
Gain in marginal log-likelihood, ΔQ: 0.00805
MCEM asymptotic standard error: 0.00813
Ascent lower and upper bound: [-0.00237, 0.0185]
Estimate of the log marginal likelihood, l(θ): -3415.976
SQUAREM: 0 accelerations, 1 fallbacks

The MCEM algorithm has converged.

Computing variance-covariance matrix at final estimates.

    Parameter Comparison: Weibull - No Covariates
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          1.3000      1.2582      0.0418      3.2%
    scale_12          0.1500      0.1500      0.0000      0.0%
    shape_23          1.1000      1.0862      0.0138      1.3%
    scale_23          0.1200      0.1252      0.0052      4.4%
    ----------------------------------------------------------------------
Test Summary:                | Pass  Total     Time
MCEM Weibull - No Covariates |    5      5  1m01.2s
    ▸ MCEM Weibull - With Covariate
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using model's Markov surrogate for MCEM.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -4425.224
Initial estimate of the log marginal likelihood: -3321.611

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4418.578
Gain in marginal log-likelihood, ΔQ: 6.65
MCEM asymptotic standard error: 0.242
Ascent lower and upper bound: [6.34, 6.96]
Estimate of the log marginal likelihood, l(θ): -3313.337
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4412.951
Gain in marginal log-likelihood, ΔQ: 0.453
MCEM asymptotic standard error: 0.0634
Ascent lower and upper bound: [0.372, 0.534]
Estimate of the log marginal likelihood, l(θ): -3312.769
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4411.331
Gain in marginal log-likelihood, ΔQ: 0.0344
MCEM asymptotic standard error: 0.0176
Ascent lower and upper bound: [0.0119, 0.057]
Estimate of the log marginal likelihood, l(θ): -3312.727
SQUAREM: 0 accelerations, 1 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 4
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4410.866
Gain in marginal log-likelihood, ΔQ: 0.00284
MCEM asymptotic standard error: 0.00515
Ascent lower and upper bound: [-0.00375, 0.00944]
Estimate of the log marginal likelihood, l(θ): -3312.724
SQUAREM: 0 accelerations, 2 fallbacks

The MCEM algorithm has converged.


    Parameter Comparison: Weibull - With Covariate
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          1.3000      1.3009      0.0009      0.1%
    scale_12          0.1500      0.1520      0.0020      1.3%
    beta_12           0.4000      0.4174      0.0174      4.4%
    shape_23          1.1000      1.1237      0.0237      2.2%
    scale_23          0.1200      0.1156      0.0044      3.7%
    beta_23           -0.3000     -0.3684     0.0684      22.8%
    ----------------------------------------------------------------------
Test Summary:                 | Pass  Total     Time
MCEM Weibull - With Covariate |    3      3  1m00.2s
  ▸ [MCEM] Section 3: Gompertz hazards
    ▸ MCEM Gompertz - No Covariates
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using model's Markov surrogate for MCEM.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -5055.101
Initial estimate of the log marginal likelihood: -2837.904

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -5041.429
Gain in marginal log-likelihood, ΔQ: 13.7
MCEM asymptotic standard error: 0.253
Ascent lower and upper bound: [13.3, 14.0]
Estimate of the log marginal likelihood, l(θ): -2822.647
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -5038.402
Gain in marginal log-likelihood, ΔQ: 0.204
MCEM asymptotic standard error: 0.0322
Ascent lower and upper bound: [0.162, 0.245]
Estimate of the log marginal likelihood, l(θ): -2822.421
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -5037.994
Gain in marginal log-likelihood, ΔQ: 0.00342
MCEM asymptotic standard error: 0.00419
Ascent lower and upper bound: [-0.00195, 0.00879]
Estimate of the log marginal likelihood, l(θ): -2822.417
SQUAREM: 0 accelerations, 1 fallbacks

The MCEM algorithm has converged.

Computing variance-covariance matrix at final estimates.
ESS diagnostics for test 'MCEM Gompertz - No Covariates':
  Iter 1: ESS min=30.0, median=49.69, max=50.0
  Iter 2: ESS min=30.0, median=49.68, max=50.0
  Iter 3: ESS min=30.0, median=49.67, max=50.0

    Parameter Comparison: Gompertz - No Covariates
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          0.0800      0.0797      0.0003      0.4%
    rate_12           0.0400      0.0389      0.0011      2.8%
    shape_23          0.0600      0.0696      0.0096      16.0%
    rate_23           0.0300      0.0272      0.0028      9.2%
    ----------------------------------------------------------------------
Test Summary:                 | Pass  Total   Time
MCEM Gompertz - No Covariates |    5      5  47.0s
    ▸ MCEM Gompertz - With Covariate
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using model's Markov surrogate for MCEM.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -4957.068
Initial estimate of the log marginal likelihood: -2781.694

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4948.572
Gain in marginal log-likelihood, ΔQ: 8.5
MCEM asymptotic standard error: 0.2
Ascent lower and upper bound: [8.24, 8.75]
Estimate of the log marginal likelihood, l(θ): -2772.21
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4946.784
Gain in marginal log-likelihood, ΔQ: 0.126
MCEM asymptotic standard error: 0.0253
Ascent lower and upper bound: [0.094, 0.159]
Estimate of the log marginal likelihood, l(θ): -2772.07
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4946.548
Gain in marginal log-likelihood, ΔQ: 0.0021
MCEM asymptotic standard error: 0.00328
Ascent lower and upper bound: [-0.0021, 0.0063]
Estimate of the log marginal likelihood, l(θ): -2772.068
SQUAREM: 0 accelerations, 1 fallbacks

The MCEM algorithm has converged.


    Parameter Comparison: Gompertz - With Covariate
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          0.0800      0.0798      0.0002      0.3%
    rate_12           0.0400      0.0404      0.0004      0.9%
    beta_12           0.3000      0.2812      0.0188      6.3%
    shape_23          0.0600      0.0590      0.0010      1.7%
    rate_23           0.0300      0.0280      0.0020      6.5%
    beta_23           -0.2000     -0.1910     0.0090      4.5%
    ----------------------------------------------------------------------
Test Summary:                  | Pass  Total   Time
MCEM Gompertz - With Covariate |    3      3  41.1s
  ▸ [MCEM] Section 3B: PhaseType proposal fitting
    ▸ MCEM Weibull - PhaseType Proposal
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using phase-type proposal for MCEM importance sampling.

Using model's Markov surrogate for MCEM.

Phase-type surrogate configuration:
  n_phases per state: [3, 3, 1]
  Total expanded states: 7
  Phase-type surrogate built successfully.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -4169.764
Initial estimate of the log marginal likelihood: -3017.441

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4157.024
Gain in marginal log-likelihood, ΔQ: 12.7
MCEM asymptotic standard error: 0.356
Ascent lower and upper bound: [12.3, 13.2]
Estimate of the log marginal likelihood, l(θ): -3001.155
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4137.667
Gain in marginal log-likelihood, ΔQ: 1.14
MCEM asymptotic standard error: 0.112
Ascent lower and upper bound: [0.994, 1.28]
Estimate of the log marginal likelihood, l(θ): -2999.683
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4132.227
Gain in marginal log-likelihood, ΔQ: 0.129
MCEM asymptotic standard error: 0.0403
Ascent lower and upper bound: [0.0776, 0.181]
Estimate of the log marginal likelihood, l(θ): -2999.516
SQUAREM: 0 accelerations, 1 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 4
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -4130.627
Gain in marginal log-likelihood, ΔQ: 0.0187
MCEM asymptotic standard error: 0.016
Ascent lower and upper bound: [-0.00175, 0.0392]
Estimate of the log marginal likelihood, l(θ): -2999.493
SQUAREM: 0 accelerations, 2 fallbacks

The MCEM algorithm has converged.


    Parameter Comparison: Weibull - PhaseType Proposal
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          1.3000      1.4112      0.1112      8.6%
    scale_12          0.1500      0.1303      0.0197      13.1%
    shape_23          1.4000      1.4150      0.0150      1.1%
    scale_23          0.2000      0.2078      0.0078      3.9%
    ----------------------------------------------------------------------
Test Summary:                     | Pass  Total   Time
MCEM Weibull - PhaseType Proposal |    6      6  23.4s
    ▸ MCEM Gompertz - PhaseType Proposal
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using phase-type proposal for MCEM importance sampling.

Using model's Markov surrogate for MCEM.

Phase-type surrogate configuration:
  n_phases per state: [3, 1]
  Total expanded states: 4
  Phase-type surrogate built successfully.

Initializing sample paths ...

Initial target ESS: 30.0 per-subject
Initial range of the number of sample paths per-subject: [30, 50]
Initial estimate of the marginal log-likelihood, Q: -2103.031
Initial estimate of the log marginal likelihood: -1423.695

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -2094.617
Gain in marginal log-likelihood, ΔQ: 8.41
MCEM asymptotic standard error: 0.187
Ascent lower and upper bound: [8.17, 8.65]
Estimate of the log marginal likelihood, l(θ): -1414.414
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -2091.946
Gain in marginal log-likelihood, ΔQ: 0.123
MCEM asymptotic standard error: 0.0271
Ascent lower and upper bound: [0.0882, 0.158]
Estimate of the log marginal likelihood, l(θ): -1414.278
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 30.0 per-subject
Range of the number of sampled paths per-subject: [30, 50]
Estimate of the marginal log-likelihood, Q: -2091.199
Gain in marginal log-likelihood, ΔQ: 0.00344
MCEM asymptotic standard error: 0.00478
Ascent lower and upper bound: [-0.00269, 0.00957]
Estimate of the log marginal likelihood, l(θ): -1414.275
SQUAREM: 0 accelerations, 1 fallbacks

The MCEM algorithm has converged.


    Parameter Comparison: Gompertz - PhaseType Proposal
    ----------------------------------------------------------------------
    Parameter         True        Estimated   Abs Diff    Rel Diff (%)
    ----------------------------------------------------------------------
    shape_12          0.3000      0.3033      0.0033      1.1%
    rate_12           0.1200      0.1135      0.0065      5.4%
    ----------------------------------------------------------------------
Test Summary:                      | Pass  Total   Time
MCEM Gompertz - PhaseType Proposal |    4      4  13.9s
  ▸ [MCEM] Section 4: Proposal selection and convergence
    ▸ Phase-Type vs Markov Proposal Selection
Test Summary:                           | Pass  Total  Time
Phase-Type vs Markov Proposal Selection |    8      8  0.4s
    ▸ MCEM Convergence Diagnostics
Using SQUAREM acceleration for MCEM.

Using adaptive SIR (will switch to lhs when cost-effective).

Using model's Markov surrogate for MCEM.

Initializing sample paths ...

Initial target ESS: 20.0 per-subject
Initial range of the number of sample paths per-subject: [20, 50]
Initial estimate of the marginal log-likelihood, Q: -61.691
Initial estimate of the log marginal likelihood: -61.767

Starting Monte Carlo EM...

Iteration: 1
Target ESS: 20.0 per-subject
Range of the number of sampled paths per-subject: [20, 50]
Estimate of the marginal log-likelihood, Q: -61.327
Gain in marginal log-likelihood, ΔQ: 0.364
MCEM asymptotic standard error: 0.078
Ascent lower and upper bound: [0.264, 0.464]
Estimate of the log marginal likelihood, l(θ): -61.268
SQUAREM: 0 accelerations, 0 fallbacks

  [SQUAREM: no acceleration (Δ too small), using standard EM]

Iteration: 2
Target ESS: 20.0 per-subject
Range of the number of sampled paths per-subject: [20, 50]
Estimate of the marginal log-likelihood, Q: -60.901
Gain in marginal log-likelihood, ΔQ: 0.0718
MCEM asymptotic standard error: 0.0409
Ascent lower and upper bound: [0.0194, 0.124]
Estimate of the log marginal likelihood, l(θ): -61.163
SQUAREM: 0 accelerations, 1 fallbacks

Iteration: 3
Target ESS: 20.0 per-subject
Range of the number of sampled paths per-subject: [20, 50]
Estimate of the marginal log-likelihood, Q: -60.628
Gain in marginal log-likelihood, ΔQ: 0.0237
MCEM asymptotic standard error: 0.0289
Ascent lower and upper bound: [-0.0133, 0.0608]
Estimate of the log marginal likelihood, l(θ): -61.128
SQUAREM: 0 accelerations, 1 fallbacks

The MCEM algorithm has converged.

Test Summary:                | Pass  Total  Time
MCEM Convergence Diagnostics |    7      7  0.6s
Fitting Markov surrogate via MLE ...

Markov surrogate MLE complete.

Test Summary:            | Pass  Total  Time
Markov Surrogate Fitting |    4      4  0.1s

=== MCEM Long Test Suite Complete ===

This test suite validated:
  - Progressive 3-state model (1→2→3)
  - MCEM parameter recovery for exponential, Weibull, Gompertz hazards
  - MCEM with covariates
  - MCEM distributional fidelity (state prevalence)
  - MCEM with PhaseType proposal (Weibull, Gompertz)
  - Phase-type vs Markov proposal selection
  - Convergence diagnostics and ESS tracking
  - Markov surrogate fitting
  - Estimated vs. true parameter comparisons printed for all tests
Sample size: n=1000, simulation trajectories: 10000

Saving MCEM results to cache...
  ✓ Saved gom_panel_nocov → mcem_gom_panel_nocov.json
  ✓ Saved wei_panel_nocov → mcem_wei_panel_nocov.json
  ✓ Saved exp_panel_nocov → mcem_exp_panel_nocov.json
Results saved to: /Users/fintzij/Library/CloudStorage/OneDrive-BristolMyersSquibb/Documents/Julia packages/MultistateModels.jl/MultistateModelsTests/cache/longtest_results
