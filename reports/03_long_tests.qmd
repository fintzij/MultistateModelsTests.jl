---
title: "Long Tests Status"
subtitle: "Statistical recovery of parameters"
date: last-modified
---

```{julia}
#| echo: false
#| output: false
using Pkg
Pkg.activate(joinpath(@__DIR__, ".."))
using DataFrames
using JSON3
using CairoMakie
using Statistics

# Load ReportHelpers
include("../src/ReportHelpers.jl")
using .ReportHelpers

# Get longtest results directory
RESULTS_DIR = normpath(joinpath(@__DIR__, "..", "cache", "longtest_results"))
```

## 1. Test Inventory

```{julia}
#| echo: false
#| label: tbl-inventory
#| tbl-cap: "Long Test Results Summary"

inventory = create_test_inventory_df(RESULTS_DIR)

if nrow(inventory) == 0
    println("No test results found in cache. Run long tests first.")
else
    # Summary stats
    n_pass = count(x -> occursin("Pass", x), inventory.Status)
    n_fail = count(x -> occursin("Fail", x), inventory.Status)
    n_total = nrow(inventory)
    
    println("**Summary**: $n_pass / $n_total tests passed ($n_fail failed)")
    println("")
    
    # Display table
    inventory
end
```

## 2. Parametric Models

### 2.1 Exponential Hazard

```{julia}
#| echo: false
#| label: fig-exp-exact

# Load results for exponential exact tests
exp_tests = ["exp_exact_nocov", "exp_exact_fixed", "exp_exact_tvc"]

for test_name in exp_tests
    result = load_longtest_result(test_name)
    if !isnothing(result)
        println("#### $test_name")
        println("- **Status**: $(get(result, :passed, false) ? "✅ Pass" : "❌ Fail")")
        println("- **N subjects**: $(get(result, :n_subjects, "?"))")
        println("")
        
        # Parameter table
        params = get(result, :true_params, Dict())
        estimates = get(result, :estimated_params, Dict())
        if !isempty(params)
            println("| Parameter | True | Estimated |")
            println("|-----------|------|-----------|")
            for (k, v) in params
                est = get(estimates, k, NaN)
                println("| $k | $(round(v, digits=4)) | $(round(est, digits=4)) |")
            end
            println("")
        end
    else
        println("#### $test_name\n*Not yet run*\n")
    end
end
```

### 2.2 Weibull Hazard

```{julia}
#| echo: false

wei_tests = ["wei_exact_nocov", "wei_exact_fixed", "wei_exact_tvc", 
             "wei_mcem_nocov", "wei_mcem_fixed", "wei_mcem_tvc"]

for test_name in wei_tests
    result = load_longtest_result(test_name)
    if !isnothing(result)
        println("#### $test_name")
        println("- **Status**: $(get(result, :passed, false) ? "✅ Pass" : "❌ Fail")")
        println("- **N subjects**: $(get(result, :n_subjects, "?"))")
        println("")
    else
        println("#### $test_name\n*Not yet run*\n")
    end
end
```

### 2.3 Gompertz Hazard

```{julia}
#| echo: false

gom_tests = ["gom_exact_nocov", "gom_exact_fixed", "gom_exact_tvc",
             "gom_mcem_nocov", "gom_mcem_fixed", "gom_mcem_tvc"]

for test_name in gom_tests
    result = load_longtest_result(test_name)
    if !isnothing(result)
        println("#### $test_name")
        println("- **Status**: $(get(result, :passed, false) ? "✅ Pass" : "❌ Fail")")
        println("- **N subjects**: $(get(result, :n_subjects, "?"))")
        println("")
    else
        println("#### $test_name\n*Not yet run*\n")
    end
end
```

## 3. Panel Data (Exponential / Markov)

```{julia}
#| echo: false

panel_tests = ["exp_panel_nocov", "exp_panel_fixed", "exp_panel_tvc"]

for test_name in panel_tests
    result = load_longtest_result(test_name)
    if !isnothing(result)
        println("#### $test_name")
        println("- **Status**: $(get(result, :passed, false) ? "✅ Pass" : "❌ Fail")")
        println("- **N subjects**: $(get(result, :n_subjects, "?"))")
        println("")
    else
        println("#### $test_name\n*Not yet run*\n")
    end
end
```

## 4. Notes

- Tests use a 3-state progressive model: State 1 → State 2 → State 3
- Parameter recovery tolerance: 35% relative error for main parameters
- TVC (time-varying covariate) tests verify covariate effects change at t=5
- Exact data uses `obstype=1` (continuous observation)
- Panel data uses discrete observation times with MCEM for semi-Markov families
