{
  "hash": "ee9ac5b89a59f27205f09dc03d95bb9a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Long Test Status\"\nsubtitle: \"Parameter Recovery and Validation Tests for MultistateModels.jl\"\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    toc-expand: 2\n    code-fold: true\n    code-summary: \"Show code\"\nexecute:\n  echo: true\n  warning: false\n  freeze: auto\n---\n\n\n\n## Overview\n\nLong tests validate that MultistateModels.jl correctly estimates model parameters from simulated data where the true data-generating process (DGP) is known. These tests are computationally intensive and typically run nightly or before releases.\n\n### Test Philosophy\n\n1. **Simulate** data from a model with known true parameters\n2. **Fit** the model to the simulated data\n3. **Compare** estimated parameters to true values\n4. **Verify** distributional properties of trajectories from fitted model\n\n### Success Criteria\n\n- **Parameter Recovery**: Estimated parameters within relative tolerance of true values\n- **Coverage**: 95% confidence intervals contain true values at appropriate rate\n- **Distributional Fidelity**: Simulated trajectories from fitted model match DGP statistics\n\n## Long Test Inventory\n\n::: {#0825f77f .cell execution_count=2}\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div><div style = \"float: left;\"><span>10×4 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">File</th><th style = \"text-align: left;\">Category</th><th style = \"text-align: left;\">Description</th><th style = \"text-align: left;\">Runtime</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">longtest_exact_markov.jl</td><td style = \"text-align: left;\">Direct ML</td><td style = \"text-align: left;\">Exact observation direct MLE fitting</td><td style = \"text-align: left;\">~5 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">longtest_mcem.jl</td><td style = \"text-align: left;\">MCEM Fitting</td><td style = \"text-align: left;\">Panel data fitting with parametric hazards</td><td style = \"text-align: left;\">~15 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">longtest_mcem_splines.jl</td><td style = \"text-align: left;\">MCEM Fitting</td><td style = \"text-align: left;\">Panel data fitting with B-spline hazards</td><td style = \"text-align: left;\">~20 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">longtest_mcem_tvc.jl</td><td style = \"text-align: left;\">MCEM Fitting</td><td style = \"text-align: left;\">Time-varying covariates with MCEM</td><td style = \"text-align: left;\">~10 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">longtest_simulation_distribution.jl</td><td style = \"text-align: left;\">Simulation</td><td style = \"text-align: left;\">Simulation distribution verification</td><td style = \"text-align: left;\">~5 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">longtest_simulation_tvc.jl</td><td style = \"text-align: left;\">Simulation</td><td style = \"text-align: left;\">TVC simulation verification</td><td style = \"text-align: left;\">~5 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">longtest_robust_parametric.jl</td><td style = \"text-align: left;\">Robust SE</td><td style = \"text-align: left;\">Robust variance for parametric models</td><td style = \"text-align: left;\">~15 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">longtest_robust_markov_phasetype.jl</td><td style = \"text-align: left;\">Robust SE</td><td style = \"text-align: left;\">Markov vs phase-type validation</td><td style = \"text-align: left;\">~20 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">longtest_phasetype.jl</td><td style = \"text-align: left;\">Phase-Type</td><td style = \"text-align: left;\">Phase-type proposals (exact + panel data)</td><td style = \"text-align: left;\">~30 min</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">longtest_variance_validation.jl</td><td style = \"text-align: left;\">Variance</td><td style = \"text-align: left;\">Variance estimation validation</td><td style = \"text-align: left;\">~10 min</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## MCEM Parameter Recovery Tests\n\n### `longtest_mcem.jl`\n\nTests MCEM algorithm convergence and parameter recovery for panel data with parametric hazards.\n\n**Test Configuration**:\n- Model: Progressive 3-state (1→2→3, state 3 absorbing)\n- Hazard families: Exponential, Weibull, Gompertz\n- Sample size: n=1000\n- Observation: Panel data with interval censoring\n\n::: {#cell-fig-mcem-params .cell execution_count=3}\n\n::: {.cell-output .cell-output-display execution_count=4}\n![MCEM Parameter Recovery: True vs Estimated](long_tests_files/figure-html/fig-mcem-params-output-1.svg){#fig-mcem-params}\n:::\n:::\n\n\n**Validation Criteria**:\n```julia\n# Parameters should be within 15% relative tolerance\nPARAM_TOL_REL = 0.15\n\n# Check each parameter\nfor (est, true_val) in zip(estimated, true_params)\n    rel_error = abs(est - true_val) / abs(true_val)\n    @test rel_error < PARAM_TOL_REL\nend\n```\n\n### `longtest_mcem_splines.jl`\n\nTests MCEM with B-spline hazards for flexible semi-Markov modeling.\n\n**Key Features Tested**:\n- Automatic knot placement from data quantiles\n- Spline coefficient estimation\n- Non-monotonic hazard recovery\n- PH covariate effects with splines\n\n### `longtest_mcem_tvc.jl`\n\nTests time-varying covariate handling in MCEM.\n\n**Configuration**:\n- Covariates that change value at observation times\n- Both PH and AFT effect types\n- Piecewise-constant covariate representation\n\n## SIR Method Comparison (`longtest_sir.jl`)\n\nCompares resampling strategies for posterior approximation:\n\n::: {#6f3fabab .cell execution_count=4}\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div><div style = \"float: left;\"><span>3×4 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Method</th><th style = \"text-align: left;\">Description</th><th style = \"text-align: left;\">Pros</th><th style = \"text-align: left;\">Cons</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">:none</td><td style = \"text-align: left;\">Importance-weighted (no resampling)</td><td style = \"text-align: left;\">Exact weights</td><td style = \"text-align: left;\">High variance with poor proposals</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">:sir</td><td style = \"text-align: left;\">Standard SIR with Pareto smoothing</td><td style = \"text-align: left;\">Reduced variance, PSIS diagnostics</td><td style = \"text-align: left;\">May lose tail coverage</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">:lhs</td><td style = \"text-align: left;\">Latin Hypercube Stratified resampling</td><td style = \"text-align: left;\">Better stratification, uniform coverage</td><td style = \"text-align: left;\">Slightly higher computation</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n**Validation**: All three methods should produce estimates within tolerance of each other and of true parameters.\n\n## Phase-Type Proposal Tests\n\n### Why Phase-Type Proposals?\n\nFor semi-Markov models (non-exponential sojourn times), standard Markov proposals can have poor acceptance rates. Phase-type approximations:\n\n1. Match the first two moments of the true sojourn distribution\n2. Enable Markov-like forward-backward sampling\n3. Dramatically improve MCEM efficiency for non-Markov models\n\n### `longtest_phasetype_exact.jl`\n\nTests phase-type fitting with exactly observed transition times:\n\n::: {#cell-fig-phasetype-exact .cell execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=6}\n![Phase-Type Proposal Performance with Exact Observations](long_tests_files/figure-html/fig-phasetype-exact-output-1.svg){#fig-phasetype-exact}\n:::\n:::\n\n\n### `longtest_phasetype_panel.jl`\n\nTests phase-type proposals with interval-censored (panel) data:\n\n**Test Matrix**:\n- 2-state models: Weibull, Gompertz\n- 3-state progressive: Mixed hazard families\n- Covariate effects: PH, AFT\n- Panel observation patterns: Regular, irregular\n\n## Variance Validation Tests\n\n### `longtest_variance_validation.jl`\n\nValidates that variance estimates achieve nominal coverage.\n\n**Approach**:\n1. Simulate 500+ datasets (1000 for variance, 100 for coverage) from true DGP\n2. Fit model to each dataset\n3. Compute 95% CIs using different variance methods\n4. Check that coverage rate ≈ 95%\n\n::: {#cell-fig-coverage .cell execution_count=6}\n\n::: {.cell-output .cell-output-display execution_count=7}\n![Variance Estimation Coverage Rates](long_tests_files/figure-html/fig-coverage-output-1.svg){#fig-coverage}\n:::\n:::\n\n\n## Simulation Distribution Tests\n\n### `longtest_simulation_distribution.jl`\n\nVerifies that simulated paths have correct statistical properties.\n\n**Validation Approach**:\n1. Simulate many paths from model\n2. Compute empirical sojourn time distribution\n3. Compare to theoretical distribution (KS test)\n4. Verify state occupancy proportions\n\n::: {#cell-fig-sim-dist .cell execution_count=7}\n\n::: {.cell-output .cell-output-display execution_count=8}\n![Simulation Distribution Validation](long_tests_files/figure-html/fig-sim-dist-output-1.svg){#fig-sim-dist}\n:::\n:::\n\n\n## Running Long Tests\n\n### Full Suite\n\n```bash\ncd MultistateModelsTests\n\n# Via the test package API\nMSM_TEST_LEVEL=full julia --project=. -e 'using MultistateModelsTests; MultistateModelsTests.runtests()'\n\n# Or via the dedicated script\njulia --project=. scripts/run_longtests.jl\n```\n\n### Individual Test\n\n```bash\n# Run only a specific suite (by key name)\nMSM_TEST_LEVEL=full MSM_LONGTEST_ONLY=mcem_parametric julia --project=. -e 'using MultistateModelsTests; MultistateModelsTests.runtests()'\n```\n\n### Environment Variables\n\n| Variable | Values | Description |\n|----------|--------|-------------|\n| `MSM_TEST_LEVEL` | `quick` (default), `full` | Controls whether long tests run |\n| `MSM_LONGTEST_ONLY` | test key (e.g., `mcem_parametric`) | Run only one specific long test |\n| `MSM_SUPPRESS_WARNINGS` | `true` (default), `false` | Suppress expected warnings |\n\n### With Debug Logging\n\n```bash\nMSM_TEST_LEVEL=full julia --project=. -e '\n    ENV[\"JULIA_DEBUG\"] = \"MultistateModels\"\n    using MultistateModelsTests\n    MultistateModelsTests.runtests()\n'\n```\n\n## Test Status Dashboard\n\n::: {#11defae5 .cell execution_count=8}\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div><div style = \"float: left;\"><span>10×5 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Test</th><th style = \"text-align: left;\">Status</th><th style = \"text-align: left;\">LastRun</th><th style = \"text-align: left;\">Duration</th><th style = \"text-align: left;\">Notes</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Exact Markov</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~5 min</td><td style = \"text-align: left;\">Direct optimization</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">MCEM Parametric</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~15 min</td><td style = \"text-align: left;\">All hazard families pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">MCEM Splines</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~20 min</td><td style = \"text-align: left;\">5 interior knots</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">MCEM TVC</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~10 min</td><td style = \"text-align: left;\">Step-function covariates</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Simulation Dist</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~5 min</td><td style = \"text-align: left;\">KS test p &gt; 0.05</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Simulation TVC</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~5 min</td><td style = \"text-align: left;\">TVC propagation correct</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Robust Parametric</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~15 min</td><td style = \"text-align: left;\">IJ/JK coverage ~95%</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Markov/PhaseType Validation</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~20 min</td><td style = \"text-align: left;\">Markov ≈ PhaseType consistency</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Phase-Type</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~30 min</td><td style = \"text-align: left;\">Exact + panel data</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Variance Validation</td><td style = \"text-align: left;\">✅ Pass</td><td style = \"text-align: left;\">2025-06</td><td style = \"text-align: left;\">~10 min</td><td style = \"text-align: left;\">Coverage nominal</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Common Issues and Debugging\n\n### Parameter Recovery Failures\n\n**Symptoms**: Estimated parameters far from true values\n\n**Potential Causes**:\n1. **Insufficient sample size**: Increase `N_SUBJECTS`\n2. **Poor initialization**: Check `initialize_parameters!` settings\n3. **Non-identifiability**: Verify model specification\n4. **MCEM convergence**: Increase `MAX_ITER` or tighten `MCEM_TOL`\n\n### Phase-Type Convergence Issues\n\n**Symptoms**: Phase-type fitting fails or produces poor approximation\n\n**Solutions**:\n1. Increase number of phases in expansion\n2. Check moment matching quality\n3. Verify sojourn distribution has finite moments\n\n### Variance Estimation Issues\n\n**Symptoms**: Coverage rates significantly below 95%\n\n**Potential Causes**:\n1. **Small sample bias**: Need larger n\n2. **Boundary parameters**: Transform scale may help\n3. **Model misspecification**: Verify DGP matches fitted model\n\n## Summary\n\nLong tests provide rigorous validation that MultistateModels.jl:\n\n1. **Recovers parameters** within expected tolerance\n2. **Produces valid uncertainty** through variance estimation\n3. **Simulates correctly** from fitted models\n4. **Handles all supported** hazard families and observation types\n\nThese tests run regularly to catch regressions and validate new features before release.\n\n",
    "supporting": [
      "long_tests_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}