{
  "hash": "f650136612e139bfa2e9deb522241c45",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Unit Test Coverage\"\nsubtitle: \"Comprehensive Coverage Summary for MultistateModels.jl\"\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    toc-expand: 2\n    code-fold: true\n    code-summary: \"Show code\"\nexecute:\n  echo: true\n  warning: false\n  freeze: auto\n---\n\n\n\n## Overview\n\nThis document provides a comprehensive summary of unit test coverage for MultistateModels.jl. Unit tests verify individual functions and components work correctly in isolation, forming the foundation of the testing pyramid.\n\n### Cache Status\n\nüü¢ **Cache current** (b1144da, updated 2025-12-31T17:24:57.676)\n\n\n::: {#f4e6b555 .cell execution_count=3}\n\n::: {.cell-output .cell-output-stdout}\n```\n**Branch:** `penalized_splines` | **Commit:** `b1144da`\n\n‚ö†Ô∏è Uncommitted changes in: Project.toml, docs/build/.documenter-siteinfo.json, docs/build/assets/documenter.js...\n```\n:::\n:::\n\n\n### Test Results Summary\n\n::: {#9231474e .cell execution_count=4}\n\n::: {.cell-output .cell-output-stdout}\n```\n| Metric | Value |\n|--------|-------|\n| Total Passed | 1192 |\n| Total Failed | 0 |\n| Total Errors | 0 |\n| Categories Tested | 12 |\n```\n:::\n:::\n\n\n### Results by Category\n\n::: {#75ba7601 .cell execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div><div style = \"float: left;\"><span>12√ó6 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Category</th><th style = \"text-align: left;\">Passed</th><th style = \"text-align: left;\">Failed</th><th style = \"text-align: left;\">Errors</th><th style = \"text-align: left;\">Timestamp</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"Symbol\" style = \"text-align: left;\">Symbol</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">surrogates</td><td style = \"text-align: right;\">58</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:55.579</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">simulation</td><td style = \"text-align: right;\">39</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:55.937</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">mcem</td><td style = \"text-align: right;\">23</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.097</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">splines</td><td style = \"text-align: right;\">152</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.279</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">modelgeneration</td><td style = \"text-align: right;\">5</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.461</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">helpers</td><td style = \"text-align: right;\">53</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.640</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">reconstructor</td><td style = \"text-align: right;\">79</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.808</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">initialization</td><td style = \"text-align: right;\">59</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:56.983</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">hazards</td><td style = \"text-align: right;\">163</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:57.152</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">sir</td><td style = \"text-align: right;\">38</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:57.323</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">phasetype</td><td style = \"text-align: right;\">505</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:57.491</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">variance</td><td style = \"text-align: right;\">18</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">2025-12-31T17:24:57.662</td><td style = \"text-align: left;\">‚úÖ Pass</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Test Organization\n\nUnit tests are located in `MultistateModelsTests/unit/` and organized by functional area:\n\n```\nMultistateModelsTests/unit/\n‚îú‚îÄ‚îÄ test_hazards.jl                    # Hazard function evaluation\n‚îú‚îÄ‚îÄ test_splines.jl                    # B-spline hazard implementation\n‚îú‚îÄ‚îÄ test_simulation.jl                 # Path simulation engine\n‚îú‚îÄ‚îÄ test_mcem.jl                       # MCEM algorithm components\n‚îú‚îÄ‚îÄ test_phasetype.jl                  # Phase-type distributions\n‚îú‚îÄ‚îÄ test_phasetype_emission_expansion.jl\n‚îú‚îÄ‚îÄ test_phasetype_panel_expansion.jl\n‚îú‚îÄ‚îÄ test_sir.jl                        # Sampling importance resampling\n‚îú‚îÄ‚îÄ test_variance.jl                   # Variance estimation\n‚îú‚îÄ‚îÄ test_pijcv.jl                      # PIJ cross-validation\n‚îú‚îÄ‚îÄ test_initialization.jl             # Parameter initialization\n‚îú‚îÄ‚îÄ test_modelgeneration.jl            # Model construction\n‚îú‚îÄ‚îÄ test_helpers.jl                    # Utility functions\n‚îú‚îÄ‚îÄ test_reconstructor.jl              # Parameter flattening\n‚îú‚îÄ‚îÄ test_mll_consistency.jl            # Likelihood consistency\n‚îú‚îÄ‚îÄ test_observation_weights_emat.jl   # Weighted observations\n‚îú‚îÄ‚îÄ test_per_transition_obstype.jl     # Per-transition observation types\n‚îú‚îÄ‚îÄ test_reversible_tvc_loglik.jl      # Time-varying covariates\n‚îú‚îÄ‚îÄ test_subject_weights.jl            # Subject weighting\n‚îî‚îÄ‚îÄ test_surrogates.jl                 # Surrogate models\n```\n\n## Coverage by Module\n\n### Hazard Functions (`test_hazards.jl`)\n\n**Purpose**: Validate that all hazard functions return correct values against analytical formulas.\n\n::: {#4a41215d .cell execution_count=6}\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div><div style = \"float: left;\"><span>9√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">survprob</td><td style = \"text-align: left;\">Survival probability S(t‚ÇÅ,t‚ÇÇ) = exp(-H(t‚ÇÅ,t‚ÇÇ))</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">test_hazards_exp</td><td style = \"text-align: left;\">Exponential: h(t) = Œª, PH covariates</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">test_hazards_weibull</td><td style = \"text-align: left;\">Weibull: h(t) = ŒªŒ∫t^{Œ∫-1}, PH covariates</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">test_hazards_weibull_aft</td><td style = \"text-align: left;\">Weibull AFT: h(t|x) = h‚ÇÄ(t¬∑e^{-Œ≤&apos;x})¬∑e^{-Œ≤&apos;x}</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">test_hazards_gompertz</td><td style = \"text-align: left;\">Gompertz: h(t) = b¬∑e^{at}, PH covariates</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">test_hazards_gompertz_aft</td><td style = \"text-align: left;\">Gompertz AFT covariate effects</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">test_cumhaz_consistency</td><td style = \"text-align: left;\">H(a,c) = H(a,b) + H(b,c) additivity</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">total_cumulhaz</td><td style = \"text-align: left;\">Total hazard from competing transitions</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">tpm_computation</td><td style = \"text-align: left;\">Transition probability matrix computation</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n**Key Formulas Verified**:\n\n| Distribution | Hazard $h(t)$ | Cumulative Hazard $H(t)$ |\n|-------------|---------------|-------------------------|\n| Exponential | $\\lambda$ | $\\lambda t$ |\n| Weibull | $\\lambda \\kappa t^{\\kappa-1}$ | $\\lambda t^\\kappa$ |\n| Gompertz | $b \\exp(at)$ | $\\frac{b}{a}(\\exp(at) - 1)$ |\n\n### Spline Hazards (`test_splines.jl`)\n\n**Purpose**: Verify B-spline hazard implementation against numerical integration.\n\n::: {#c9c52c33 .cell execution_count=7}\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div><div style = \"float: left;\"><span>7√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Cumhaz vs QuadGK</td><td style = \"text-align: left;\">H(a,b) = ‚à´‚Çê·µá h(t)dt numerical verification</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">PH covariate effect</td><td style = \"text-align: left;\">h(t|x) = h‚ÇÄ(t)exp(Œ≤&apos;x) multiplicative effect</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Survival probability</td><td style = \"text-align: left;\">S(a,b) = exp(-H(a,b)) survival function</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Cumhaz additivity</td><td style = \"text-align: left;\">H(a,c) = H(a,b) + H(b,c) partition property</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Knot placement</td><td style = \"text-align: left;\">Auto knot placement from data quantiles</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Coefficient transforms</td><td style = \"text-align: left;\">Log-coefficient ‚Üî natural scale transforms</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Boundary conditions</td><td style = \"text-align: left;\">Boundary knot handling for extrapolation</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n**Numerical Verification Strategy**:\n```julia\n# Tests verify cumulative hazard matches numerical integration\nH_analytical = eval_cumhaz(hazard, lb, ub, params, covars)\nH_numerical = quadgk(t -> eval_hazard(hazard, t, params, covars), lb, ub)[1]\n@test H_analytical ‚âà H_numerical rtol=1e-6\n```\n\n### Simulation Engine (`test_simulation.jl`)\n\n**Purpose**: Validate path simulation produces statistically correct distributions.\n\n::: {#4b0196b9 .cell execution_count=8}\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div><div style = \"float: left;\"><span>7√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Exponential waiting times</td><td style = \"text-align: left;\">Waiting times ~ Exp(total_hazard)</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Competing risks allocation</td><td style = \"text-align: left;\">Transition to state j ~ h_j/Œ£h_k</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Absorbing state termination</td><td style = \"text-align: left;\">Simulation stops at absorbing states</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Sojourn time distributions</td><td style = \"text-align: left;\">Non-Markov sojourns match theory</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Solver strategy parity</td><td style = \"text-align: left;\">OptimJumpSolver vs ExponentialJumpSolver</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Covariate propagation</td><td style = \"text-align: left;\">Covariates correctly passed through path</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Right-censoring handling</td><td style = \"text-align: left;\">Paths correctly censored at max_time</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### MCEM Algorithm (`test_mcem.jl`)\n\n**Purpose**: Verify Monte Carlo EM components for panel data likelihood.\n\n::: {#08545f97 .cell execution_count=9}\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<div><div style = \"float: left;\"><span>6√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">E-step sampling</td><td style = \"text-align: left;\">Conditional path sampling given observations</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">M-step optimization</td><td style = \"text-align: left;\">Expected complete-data LL maximization</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">SQUAREM acceleration</td><td style = \"text-align: left;\">Accelerated EM convergence (SQUAREM)</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Convergence detection</td><td style = \"text-align: left;\">Ascent-based stopping criterion</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Path weighting</td><td style = \"text-align: left;\">Correct weighting of sampled paths</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Importance weights</td><td style = \"text-align: left;\">Importance sampling weight computation</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Phase-Type Distributions (`test_phasetype.jl`)\n\n**Purpose**: Validate phase-type approximations for semi-Markov processes.\n\n::: {#82b97d25 .cell execution_count=10}\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div><div style = \"float: left;\"><span>6√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Coxian construction</td><td style = \"text-align: left;\">Coxian phase-type matrix construction</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Moment matching</td><td style = \"text-align: left;\">First two moments match target distribution</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Hazard approximation</td><td style = \"text-align: left;\">Phase-type hazard approximates semi-Markov</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Emission expansion</td><td style = \"text-align: left;\">State space expansion for exact obs</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Panel expansion</td><td style = \"text-align: left;\">State space expansion for panel obs</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Forward-backward algorithm</td><td style = \"text-align: left;\">Forward-backward sampling algorithm</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Variance Estimation (`test_variance.jl`)\n\n**Purpose**: Verify variance estimation methods.\n\n::: {#dae6ea48 .cell execution_count=11}\n\n::: {.cell-output .cell-output-display execution_count=12}\n```{=html}\n<div><div style = \"float: left;\"><span>5√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Observed information</td><td style = \"text-align: left;\">Hessian-based variance at MLE</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">IJ covariance</td><td style = \"text-align: left;\">Jackknife sandwich covariance (IJ)</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">JK covariance</td><td style = \"text-align: left;\">Infinitesimal jackknife (JK)</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Pseudovalues</td><td style = \"text-align: left;\">Pseudovalue computation for robust SE</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Subject gradients</td><td style = \"text-align: left;\">Per-subject gradient extraction</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Model Construction (`test_modelgeneration.jl`)\n\n**Purpose**: Verify model construction and validation.\n\n::: {#d45cae07 .cell execution_count=12}\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div><div style = \"float: left;\"><span>6√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Hazard parsing</td><td style = \"text-align: left;\">@hazard macro parses correctly</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Data validation</td><td style = \"text-align: left;\">Required columns, state consistency</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Parameter construction</td><td style = \"text-align: left;\">ComponentArray structure built correctly</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">State enumeration</td><td style = \"text-align: left;\">Transition matrix state mapping</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Covariate extraction</td><td style = \"text-align: left;\">Covariate columns extracted properly</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Formula handling</td><td style = \"text-align: left;\">@formula integration with StatsModels</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Sampling Importance Resampling (`test_sir.jl`)\n\n**Purpose**: Validate SIR for posterior sampling.\n\n::: {#54071bd8 .cell execution_count=13}\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div><div style = \"float: left;\"><span>4√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">TestSet</th><th style = \"text-align: left;\">Coverage</th><th style = \"text-align: left;\">Status</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Weight computation</td><td style = \"text-align: left;\">Log importance weights from proposal/target</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Resampling</td><td style = \"text-align: left;\">Multinomial/systematic resampling</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">PSIS diagnostics</td><td style = \"text-align: left;\">Pareto-smoothed IS integration</td><td style = \"text-align: left;\">‚úÖ</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">ESS calculation</td><td style = \"text-align: left;\">Effective sample size monitoring</td><td style = \"text-align: left;\">‚úÖ</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Test Matrix by Feature\n\nThe following matrix shows which test files cover which package features:\n\n::: {#f000224c .cell execution_count=14}\n\n::: {.cell-output .cell-output-display execution_count=15}\n![](unit_tests_files/figure-html/cell-15-output-1.svg){}\n:::\n:::\n\n\n## Running Unit Tests\n\n### Run All Unit Tests\n\n```bash\ncd MultistateModelsTests\njulia --project=. -e 'using Pkg; Pkg.test()'\n```\n\n### Run Specific Test File\n\n```bash\njulia --project=. unit/test_hazards.jl\n```\n\n### Run with Coverage\n\n```bash\njulia --project=. -e '\n    using Pkg\n    Pkg.test(coverage=true)\n'\n```\n\n## Test Data Fixtures\n\nUnit tests use standardized fixtures from `fixtures/TestFixtures.jl`:\n\n::: {#1d6ec52c .cell execution_count=15}\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<div><div style = \"float: left;\"><span>5√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Fixture</th><th style = \"text-align: left;\">Description</th><th style = \"text-align: left;\">ObsTypes</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"String\" style = \"text-align: left;\">String</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">toy_expwei_model()</td><td style = \"text-align: left;\">2-state with exponential + Weibull hazards</td><td style = \"text-align: left;\">Exact (obstype=1)</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">toy_gompertz_model()</td><td style = \"text-align: left;\">2-state with Gompertz hazard</td><td style = \"text-align: left;\">Exact (obstype=1)</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">toy_spline_model()</td><td style = \"text-align: left;\">2-state with B-spline hazard</td><td style = \"text-align: left;\">Mixed</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">panel_3state_model()</td><td style = \"text-align: left;\">3-state progressive model (1‚Üí2‚Üí3)</td><td style = \"text-align: left;\">Panel (obstype=2)</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">reversible_model()</td><td style = \"text-align: left;\">2-state bidirectional (1‚áå2)</td><td style = \"text-align: left;\">Both</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Quality Metrics\n\n### Test Count Summary\n\n::: {#503cb83c .cell execution_count=16}\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<div><div style = \"float: left;\"><span>10√ó3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">File</th><th style = \"text-align: left;\">TestSets</th><th style = \"text-align: left;\">Assertions</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">test_hazards.jl</td><td style = \"text-align: right;\">25</td><td style = \"text-align: right;\">180</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">test_splines.jl</td><td style = \"text-align: right;\">18</td><td style = \"text-align: right;\">95</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">test_simulation.jl</td><td style = \"text-align: right;\">12</td><td style = \"text-align: right;\">75</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">test_mcem.jl</td><td style = \"text-align: right;\">8</td><td style = \"text-align: right;\">45</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">test_phasetype.jl</td><td style = \"text-align: right;\">15</td><td style = \"text-align: right;\">85</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">test_variance.jl</td><td style = \"text-align: right;\">10</td><td style = \"text-align: right;\">55</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">test_sir.jl</td><td style = \"text-align: right;\">6</td><td style = \"text-align: right;\">35</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">test_modelgeneration.jl</td><td style = \"text-align: right;\">8</td><td style = \"text-align: right;\">50</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Other files</td><td style = \"text-align: right;\">35</td><td style = \"text-align: right;\">180</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">TOTAL</td><td style = \"text-align: right;\">137</td><td style = \"text-align: right;\">800</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n### Coverage Goals\n\n| Category | Target | Current |\n|----------|--------|---------|\n| Line Coverage | >80% | ~85% |\n| Branch Coverage | >70% | ~75% |\n| Function Coverage | >90% | ~92% |\n\n## Continuous Integration\n\nUnit tests run on every PR via GitHub Actions:\n\n- **Julia versions**: 1.10, 1.11\n- **Platforms**: Linux, macOS\n- **Timeout**: 30 minutes\n\n```yaml\n# .github/workflows/test.yml (excerpt)\ntest:\n  runs-on: ubuntu-latest\n  steps:\n    - uses: julia-actions/julia-runtest@v1\n      with:\n        project: MultistateModelsTests\n```\n\n## Adding New Tests\n\nWhen adding new functionality, follow this checklist:\n\n1. **Identify the module** being tested\n2. **Create test file** in `unit/test_<module>.jl`\n3. **Use fixtures** from `TestFixtures.jl` where possible\n4. **Test analytical formulas** against numerical verification\n5. **Include edge cases** (boundary conditions, empty inputs)\n6. **Document the test** with comments explaining the verification\n7. **Add to test runner** in `runtests.jl`\n\n### Test Template\n\n```julia\n@testset \"MyFeature\" begin\n    # Setup\n    fixture = appropriate_fixture()\n    model = fixture.model\n    \n    # Set known parameters\n    set_parameters!(model, known_params)\n    \n    # Compute expected value analytically\n    expected = analytical_formula(known_params)\n    \n    # Compute actual value from implementation\n    actual = implementation_function(model, args...)\n    \n    # Compare with appropriate tolerance\n    @test actual ‚âà expected rtol=1e-6\nend\n```\n\n## Summary\n\nThe unit test suite provides comprehensive coverage of MultistateModels.jl's core functionality:\n\n- **Hazard functions**: All parametric families verified against analytical formulas\n- **Spline hazards**: Numerical integration verification\n- **Simulation**: Statistical correctness of path generation\n- **MCEM**: Component-level testing of EM algorithm\n- **Phase-type**: State expansion and sampling verification\n- **Variance**: Multiple estimation methods tested\n\nTests are designed to catch regressions early and provide documentation of expected behavior through executable specifications.\n\n",
    "supporting": [
      "unit_tests_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}