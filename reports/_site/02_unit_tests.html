<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-12">

<title>Unit Test Coverage – MultistateModels Test Reports</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e34c512d8f599efa8461f365689868f8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3bbbbd466991e281563892c5dce73c3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MultistateModels Test Reports</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./01_architecture.html"> 
<span class="menu-text">Architecture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./02_unit_tests.html" aria-current="page"> 
<span class="menu-text">Unit Tests</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./03_long_tests.html"> 
<span class="menu-text">Long Tests</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./04_simulation_diagnostics.html"> 
<span class="menu-text">Simulation</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-benchmarks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Benchmarks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-benchmarks">    
        <li>
    <a class="dropdown-item" href="./05_benchmarks.html">
 <span class="dropdown-text">Performance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./spline_comparison_benchmark.html">
 <span class="dropdown-text">Spline Methods Comparison</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fintzij/MultistateModels.jl"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#coverage-summary" id="toc-coverage-summary" class="nav-link active" data-scroll-target="#coverage-summary">1. Coverage Summary</a>
  <ul class="collapse">
  <li><a href="#overall-statistics-as-of-january-12-2026" id="toc-overall-statistics-as-of-january-12-2026" class="nav-link" data-scroll-target="#overall-statistics-as-of-january-12-2026">Overall Statistics (as of January 12, 2026)</a></li>
  <li><a href="#coverage-by-functional-area" id="toc-coverage-by-functional-area" class="nav-link" data-scroll-target="#coverage-by-functional-area">Coverage by Functional Area</a></li>
  </ul></li>
  <li><a href="#hazard-functions-test_hazards.jl" id="toc-hazard-functions-test_hazards.jl" class="nav-link" data-scroll-target="#hazard-functions-test_hazards.jl">2. Hazard Functions (<code>test_hazards.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference" id="toc-mathematical-reference" class="nav-link" data-scroll-target="#mathematical-reference">2.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria" id="toc-test-criteria" class="nav-link" data-scroll-target="#test-criteria">2.2 Test Criteria</a></li>
  <li><a href="#summary-table" id="toc-summary-table" class="nav-link" data-scroll-target="#summary-table">2.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#spline-hazards-test_splines.jl" id="toc-spline-hazards-test_splines.jl" class="nav-link" data-scroll-target="#spline-hazards-test_splines.jl">3. Spline Hazards (<code>test_splines.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-1" id="toc-mathematical-reference-1" class="nav-link" data-scroll-target="#mathematical-reference-1">3.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-1" id="toc-test-criteria-1" class="nav-link" data-scroll-target="#test-criteria-1">3.2 Test Criteria</a></li>
  <li><a href="#summary-table-1" id="toc-summary-table-1" class="nav-link" data-scroll-target="#summary-table-1">3.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#simulation-test_simulation.jl" id="toc-simulation-test_simulation.jl" class="nav-link" data-scroll-target="#simulation-test_simulation.jl">4. Simulation (<code>test_simulation.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-2" id="toc-mathematical-reference-2" class="nav-link" data-scroll-target="#mathematical-reference-2">4.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-2" id="toc-test-criteria-2" class="nav-link" data-scroll-target="#test-criteria-2">4.2 Test Criteria</a></li>
  <li><a href="#summary-table-2" id="toc-summary-table-2" class="nav-link" data-scroll-target="#summary-table-2">4.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#mcem-algorithm-test_mcem.jl" id="toc-mcem-algorithm-test_mcem.jl" class="nav-link" data-scroll-target="#mcem-algorithm-test_mcem.jl">5. MCEM Algorithm (<code>test_mcem.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-3" id="toc-mathematical-reference-3" class="nav-link" data-scroll-target="#mathematical-reference-3">5.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-3" id="toc-test-criteria-3" class="nav-link" data-scroll-target="#test-criteria-3">5.2 Test Criteria</a></li>
  <li><a href="#summary-table-3" id="toc-summary-table-3" class="nav-link" data-scroll-target="#summary-table-3">5.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#sir-resampling-test_sir.jl" id="toc-sir-resampling-test_sir.jl" class="nav-link" data-scroll-target="#sir-resampling-test_sir.jl">6. SIR Resampling (<code>test_sir.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-4" id="toc-mathematical-reference-4" class="nav-link" data-scroll-target="#mathematical-reference-4">6.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-4" id="toc-test-criteria-4" class="nav-link" data-scroll-target="#test-criteria-4">6.2 Test Criteria</a></li>
  <li><a href="#summary-table-4" id="toc-summary-table-4" class="nav-link" data-scroll-target="#summary-table-4">6.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#variance-estimation-test_variance.jl" id="toc-variance-estimation-test_variance.jl" class="nav-link" data-scroll-target="#variance-estimation-test_variance.jl">7. Variance Estimation (<code>test_variance.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-5" id="toc-mathematical-reference-5" class="nav-link" data-scroll-target="#mathematical-reference-5">7.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-5" id="toc-test-criteria-5" class="nav-link" data-scroll-target="#test-criteria-5">7.2 Test Criteria</a></li>
  <li><a href="#summary-table-5" id="toc-summary-table-5" class="nav-link" data-scroll-target="#summary-table-5">7.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#pijcv-smoothing-selection-test_pijcv.jl" id="toc-pijcv-smoothing-selection-test_pijcv.jl" class="nav-link" data-scroll-target="#pijcv-smoothing-selection-test_pijcv.jl">8. PIJCV Smoothing Selection (<code>test_pijcv.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-6" id="toc-mathematical-reference-6" class="nav-link" data-scroll-target="#mathematical-reference-6">8.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-6" id="toc-test-criteria-6" class="nav-link" data-scroll-target="#test-criteria-6">8.2 Test Criteria</a></li>
  <li><a href="#summary-table-6" id="toc-summary-table-6" class="nav-link" data-scroll-target="#summary-table-6">8.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#phase-type-models-test_phasetype.jl" id="toc-phase-type-models-test_phasetype.jl" class="nav-link" data-scroll-target="#phase-type-models-test_phasetype.jl">9. Phase-Type Models (<code>test_phasetype.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-7" id="toc-mathematical-reference-7" class="nav-link" data-scroll-target="#mathematical-reference-7">9.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-7" id="toc-test-criteria-7" class="nav-link" data-scroll-target="#test-criteria-7">9.2 Test Criteria</a></li>
  <li><a href="#summary-table-7" id="toc-summary-table-7" class="nav-link" data-scroll-target="#summary-table-7">9.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl" id="toc-likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl" class="nav-link" data-scroll-target="#likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl">10. Likelihood Functions (<code>test_mll_consistency.jl</code>, <code>test_loglik_analytical.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#mathematical-reference-8" id="toc-mathematical-reference-8" class="nav-link" data-scroll-target="#mathematical-reference-8">10.1 Mathematical Reference</a></li>
  <li><a href="#test-criteria-8" id="toc-test-criteria-8" class="nav-link" data-scroll-target="#test-criteria-8">10.2 Test Criteria</a></li>
  <li><a href="#summary-table-8" id="toc-summary-table-8" class="nav-link" data-scroll-target="#summary-table-8">10.3 Summary Table</a></li>
  </ul></li>
  <li><a href="#model-construction-test_modelgeneration.jl-test_initialization.jl" id="toc-model-construction-test_modelgeneration.jl-test_initialization.jl" class="nav-link" data-scroll-target="#model-construction-test_modelgeneration.jl-test_initialization.jl">11. Model Construction (<code>test_modelgeneration.jl</code>, <code>test_initialization.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#test-criteria-9" id="toc-test-criteria-9" class="nav-link" data-scroll-target="#test-criteria-9">11.1 Test Criteria</a></li>
  <li><a href="#summary-table-9" id="toc-summary-table-9" class="nav-link" data-scroll-target="#summary-table-9">11.2 Summary Table</a></li>
  </ul></li>
  <li><a href="#reconstructor-test_reconstructor.jl" id="toc-reconstructor-test_reconstructor.jl" class="nav-link" data-scroll-target="#reconstructor-test_reconstructor.jl">12. ReConstructor (<code>test_reconstructor.jl</code>)</a>
  <ul class="collapse">
  <li><a href="#test-criteria-10" id="toc-test-criteria-10" class="nav-link" data-scroll-target="#test-criteria-10">12.1 Test Criteria</a></li>
  <li><a href="#summary-table-10" id="toc-summary-table-10" class="nav-link" data-scroll-target="#summary-table-10">12.2 Summary Table</a></li>
  </ul></li>
  <li><a href="#additional-tests" id="toc-additional-tests" class="nav-link" data-scroll-target="#additional-tests">13. Additional Tests</a>
  <ul class="collapse">
  <li><a href="#ad-backends-test_ad_backends.jl" id="toc-ad-backends-test_ad_backends.jl" class="nav-link" data-scroll-target="#ad-backends-test_ad_backends.jl">13.1 AD Backends (<code>test_ad_backends.jl</code>)</a></li>
  <li><a href="#hazard-macro-test_hazard_macro.jl" id="toc-hazard-macro-test_hazard_macro.jl" class="nav-link" data-scroll-target="#hazard-macro-test_hazard_macro.jl">13.2 <span class="citation" data-cites="hazard">@hazard</span> Macro (<code>test_hazard_macro.jl</code>)</a></li>
  <li><a href="#model-output-test_model_output.jl" id="toc-model-output-test_model_output.jl" class="nav-link" data-scroll-target="#model-output-test_model_output.jl">13.3 Model Output (<code>test_model_output.jl</code>)</a></li>
  </ul></li>
  <li><a href="#coverage-gaps-and-future-work" id="toc-coverage-gaps-and-future-work" class="nav-link" data-scroll-target="#coverage-gaps-and-future-work">14. Coverage Gaps and Future Work</a>
  <ul class="collapse">
  <li><a href="#current-gaps" id="toc-current-gaps" class="nav-link" data-scroll-target="#current-gaps">14.1 Current Gaps</a></li>
  <li><a href="#recently-added-coverage" id="toc-recently-added-coverage" class="nav-link" data-scroll-target="#recently-added-coverage">14.2 Recently Added Coverage</a></li>
  </ul></li>
  <li><a href="#running-tests" id="toc-running-tests" class="nav-link" data-scroll-target="#running-tests">15. Running Tests</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/blob/main/02_unit_tests.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Unit Test Coverage</h1>
<p class="subtitle lead">Comprehensive validation of MultistateModels.jl functions</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 12, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="coverage-summary" class="level2">
<h2 class="anchored" data-anchor-id="coverage-summary">1. Coverage Summary</h2>
<section id="overall-statistics-as-of-january-12-2026" class="level3">
<h3 class="anchored" data-anchor-id="overall-statistics-as-of-january-12-2026">Overall Statistics (as of January 12, 2026)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Total Test Files</td>
<td>35</td>
</tr>
<tr class="even">
<td>Total Test Cases</td>
<td>~2100</td>
</tr>
<tr class="odd">
<td>Passing</td>
<td>~2100</td>
</tr>
<tr class="even">
<td>Failing</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Branch</td>
<td><code>penalized_splines</code></td>
</tr>
</tbody>
</table>
</section>
<section id="coverage-by-functional-area" class="level3">
<h3 class="anchored" data-anchor-id="coverage-by-functional-area">Coverage by Functional Area</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 38%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Area</th>
<th>Test Files</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Hazard Evaluation</td>
<td><code>test_hazards.jl</code>, <code>test_compute_hazard.jl</code></td>
<td>Hazard functions, cumulative hazards, survival</td>
</tr>
<tr class="even">
<td>Spline Infrastructure</td>
<td><code>test_splines.jl</code></td>
<td>B-spline basis, penalization, tensor products</td>
</tr>
<tr class="odd">
<td>Simulation</td>
<td><code>test_simulation.jl</code></td>
<td>Path simulation, distribution fidelity</td>
</tr>
<tr class="even">
<td>MCEM Algorithm</td>
<td><code>test_mcem.jl</code></td>
<td>Monte Carlo EM helper functions</td>
</tr>
<tr class="odd">
<td>Phase-Type</td>
<td><code>test_phasetype.jl</code>, <code>test_phasetype_*.jl</code></td>
<td>State expansion, FFBS, emission matrices</td>
</tr>
<tr class="even">
<td>SIR Resampling</td>
<td><code>test_sir.jl</code></td>
<td>Multinomial and LHS resampling</td>
</tr>
<tr class="odd">
<td>Variance Estimation</td>
<td><code>test_variance.jl</code></td>
<td>Model, IJ, jackknife variance</td>
</tr>
<tr class="even">
<td>PIJCV</td>
<td><code>test_pijcv.jl</code>, <code>test_pijcv_*.jl</code></td>
<td>Smoothing parameter selection</td>
</tr>
<tr class="odd">
<td>Likelihood</td>
<td><code>test_mll_consistency.jl</code>, <code>test_loglik_analytical.jl</code></td>
<td>Exact, panel, penalized likelihoods</td>
</tr>
<tr class="even">
<td>Model Construction</td>
<td><code>test_modelgeneration.jl</code>, <code>test_initialization.jl</code></td>
<td>Model building, parameter init</td>
</tr>
<tr class="odd">
<td>Infrastructure</td>
<td><code>test_reconstructor.jl</code>, <code>test_bounds.jl</code>, <code>test_infrastructure.jl</code></td>
<td>Parameter flattening, AD compat</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="hazard-functions-test_hazards.jl" class="level2">
<h2 class="anchored" data-anchor-id="hazard-functions-test_hazards.jl">2. Hazard Functions (<code>test_hazards.jl</code>)</h2>
<p>Tests verify that all parametric hazard families return mathematically correct values against analytical formulas.</p>
<section id="mathematical-reference" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference">2.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Analytical Hazard Formulas (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Exponential:</strong></p>
<ul>
<li><span class="math inline">\(h(t) = \lambda\)</span> (constant hazard)</li>
<li><span class="math inline">\(H(t) = \lambda t\)</span> (cumulative hazard)</li>
<li><span class="math inline">\(S(t) = \exp(-\lambda t)\)</span> (survival function)</li>
</ul>
<p><strong>Weibull (shape <span class="math inline">\(\kappa\)</span>, scale <span class="math inline">\(\lambda\)</span>):</strong></p>
<ul>
<li><span class="math inline">\(h(t) = \lambda \kappa t^{\kappa-1}\)</span> (increasing/decreasing with <span class="math inline">\(t\)</span>)</li>
<li><span class="math inline">\(H(t) = \lambda t^\kappa\)</span></li>
<li><span class="math inline">\(S(t) = \exp(-\lambda t^\kappa)\)</span></li>
</ul>
<p><strong>Gompertz (shape <span class="math inline">\(a\)</span>, rate <span class="math inline">\(b\)</span>) - flexsurv parameterization:</strong></p>
<ul>
<li><span class="math inline">\(h(t) = b \exp(at)\)</span> (<span class="math inline">\(a&gt;0\)</span>: increasing, <span class="math inline">\(a&lt;0\)</span>: decreasing)</li>
<li><span class="math inline">\(H(t) = \frac{b}{a}(\exp(at) - 1)\)</span> for <span class="math inline">\(a \neq 0\)</span></li>
<li><span class="math inline">\(S(t) = \exp\left(-\frac{b}{a}(\exp(at) - 1)\right)\)</span></li>
</ul>
<p><strong>Covariate Effects:</strong></p>
<ul>
<li><strong>Proportional Hazards (PH):</strong> <span class="math inline">\(h(t|x) = h_0(t) \exp(\beta'x)\)</span></li>
<li><strong>Accelerated Failure Time (AFT):</strong> <span class="math inline">\(h(t|x) = h_0(t \cdot e^{-\beta'x}) e^{-\beta'x}\)</span></li>
</ul>
</div>
</div>
</div>
</section>
<section id="test-criteria" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria">2.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 23%">
<col style="width: 39%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Formula Verified</th>
<th>Tolerance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Survival probability</td>
<td><span class="math inline">\(1 - S(0,t) = F(t)\)</span> matches <code>Distributions.Exponential</code></td>
<td>Total hazard rate = 0.2, <span class="math inline">\(F(2) = 1 - e^{-0.4}\)</span></td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="even">
<td>Exponential baseline</td>
<td><span class="math inline">\(h(t) = \lambda\)</span> constant in <span class="math inline">\(t\)</span></td>
<td><code>eval_hazard</code> = rate parameter</td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="odd">
<td>Exponential with covariates</td>
<td><span class="math inline">\(\log h = \log\lambda + \beta_1 x_1 + \beta_2 x_2 + \beta_{12} x_1 x_2\)</span></td>
<td>Full linear predictor formula</td>
<td>Exact match</td>
</tr>
<tr class="even">
<td>Weibull baseline</td>
<td><span class="math inline">\(\log h = \log\lambda + \log\kappa + (\kappa-1)\log t\)</span></td>
<td>Log-hazard at <span class="math inline">\(t=1.7\)</span></td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="odd">
<td>Weibull with covariates</td>
<td>PH and AFT covariate effects</td>
<td>Shape and scale adjustments</td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="even">
<td>Gompertz baseline</td>
<td><span class="math inline">\(h(t) = b\exp(at)\)</span></td>
<td>Rate exponentially increasing in <span class="math inline">\(t\)</span></td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="odd">
<td>Gompertz cumhaz</td>
<td><span class="math inline">\(H(t) = (b/a)(\exp(at)-1)\)</span></td>
<td>Analytical integration</td>
<td><code>rtol=1e-6</code></td>
</tr>
<tr class="even">
<td>Time transform parity</td>
<td><code>eval_hazard(apply_transform=true)</code> = <code>eval_hazard(apply_transform=false)</code></td>
<td>Tang optimization produces identical values</td>
<td>Exact match</td>
</tr>
<tr class="odd">
<td>Cumulative hazard additivity</td>
<td><span class="math inline">\(H(a,c) = H(a,b) + H(b,c)\)</span></td>
<td>Interval splitting</td>
<td><code>rtol=1e-8</code></td>
</tr>
</tbody>
</table>
<p><strong>Tolerance Justification:</strong> <code>rtol=1e-6</code> accounts for <code>ParameterHandling.positive()</code> using <span class="math inline">\(\varepsilon \approx 1.49 \times 10^{-8}\)</span> safety margin in exp/log round-trips.</p>
</div>
</div>
</div>
</section>
<section id="summary-table" class="level3">
<h3 class="anchored" data-anchor-id="summary-table">2.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Family</th>
<th>Baseline</th>
<th>Covariates</th>
<th>AFT</th>
<th>Time Transform</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exponential</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Pass</td>
</tr>
<tr class="even">
<td>Weibull</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Pass</td>
</tr>
<tr class="odd">
<td>Gompertz</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Pass</td>
</tr>
<tr class="even">
<td>Spline</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="spline-hazards-test_splines.jl" class="level2">
<h2 class="anchored" data-anchor-id="spline-hazards-test_splines.jl">3. Spline Hazards (<code>test_splines.jl</code>)</h2>
<p>Tests verify B-spline basis construction, numerical integration accuracy, and penalization infrastructure.</p>
<section id="mathematical-reference-1" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-1">3.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Spline Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>B-Spline Hazard:</strong></p>
<ul>
<li><span class="math inline">\(h(t) = \sum_i \beta_i B_i(t)\)</span> where <span class="math inline">\(B_i\)</span> are B-spline basis functions</li>
<li>Coefficients <span class="math inline">\(\beta_i &gt; 0\)</span> ensure non-negative hazard</li>
</ul>
<p><strong>Cumulative Hazard:</strong></p>
<ul>
<li><span class="math inline">\(H(a,b) = \int_a^b h(t) dt = \sum_i \beta_i \int_a^b B_i(t) dt\)</span></li>
<li>Uses analytical B-spline antiderivative (not numerical quadrature)</li>
</ul>
<p><strong>Second-Order Penalty Matrix:</strong></p>
<ul>
<li><span class="math inline">\(\mathbf{P} = \int \mathbf{B}''(t) \mathbf{B}''(t)' dt\)</span></li>
<li>Penalizes deviation from linearity (Wood, 2017)</li>
<li>Must be symmetric, positive semi-definite with <span class="math inline">\(\text{rank} = k - m\)</span> where <span class="math inline">\(m\)</span> = penalty order</li>
</ul>
<p><strong>Tensor Product (te()):</strong></p>
<ul>
<li><span class="math inline">\(f(x,y) = \sum_i \sum_j \beta_{ij} B_i^{(x)}(x) B_j^{(y)}(y)\)</span></li>
<li>Basis: Kronecker product <span class="math inline">\(\mathbf{B}^{(x)} \otimes \mathbf{B}^{(y)}\)</span></li>
<li>Penalty: Row + column penalties on coefficient matrix</li>
</ul>
</div>
</div>
</div>
</section>
<section id="test-criteria-1" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-1">3.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Spline Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Numerical Integration Verification:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 44%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cumhaz vs QuadGK</td>
<td><span class="math inline">\(H(a,b)_\text{impl} \approx \int_a^b h(t)dt\)</span></td>
<td>QuadGK adaptive quadrature, 5 random parameter configs, 5 intervals each</td>
</tr>
<tr class="even">
<td>B-spline antiderivative</td>
<td>BSplineKit <code>integral()</code> matches QuadGK</td>
<td><code>rtol=1e-10</code> (machine precision for polynomials)</td>
</tr>
<tr class="odd">
<td>Covariate effect</td>
<td><span class="math inline">\(H(a,b|x) = H_0(a,b) \exp(\beta'x)\)</span> for PH</td>
<td>Multiple covariate values</td>
</tr>
</tbody>
</table>
<p><strong>Penalty Matrix Properties:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Property</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Symmetry</td>
<td><span class="math inline">\(\mathbf{P} = \mathbf{P}'\)</span> exactly</td>
</tr>
<tr class="even">
<td>Positive semi-definiteness</td>
<td>All eigenvalues <span class="math inline">\(\geq 0\)</span></td>
</tr>
<tr class="odd">
<td>Null space dimension</td>
<td><span class="math inline">\(\text{dim}(\text{null}(\mathbf{P})) = m\)</span> (penalty order)</td>
</tr>
<tr class="even">
<td>Null space basis</td>
<td>Contains polynomials of degree <span class="math inline">\(&lt; m\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Smooth Term Parsing:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Input</th>
<th>Expected Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Basic <code>s(x)</code></td>
<td><code>@formula(0 ~ s(x))</code></td>
<td>SmoothTerm with default k=10</td>
</tr>
<tr class="even">
<td>Custom k</td>
<td><code>@formula(0 ~ s(x, k=15))</code></td>
<td>SmoothTerm with k=15</td>
</tr>
<tr class="odd">
<td>Custom m</td>
<td><code>@formula(0 ~ s(x, m=1))</code></td>
<td>First-order penalty (ridge)</td>
</tr>
<tr class="even">
<td>Tensor product</td>
<td><code>@formula(0 ~ te(x,y))</code></td>
<td>TensorProductTerm</td>
</tr>
</tbody>
</table>
<p><strong>Automatic Knot Placement:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Interior knots</td>
<td>Placed at quantiles of transition times</td>
</tr>
<tr class="even">
<td>Boundary knots</td>
<td>Span observed time range</td>
</tr>
<tr class="odd">
<td>Edge case handling</td>
<td>k &gt; n_unique_times handled gracefully</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-1" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-1">3.3 Summary Table</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 18%">
<col style="width: 29%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Tolerance</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cumhaz vs numerical integration</td>
<td>25 random configs</td>
<td><code>rtol=1e-6</code></td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>B-spline antiderivative</td>
<td>6 test cases</td>
<td><code>rtol=1e-10</code></td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Penalty matrix symmetry</td>
<td>Exact equality</td>
<td>Exact</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Penalty matrix eigenvalues</td>
<td>All ≥ 0</td>
<td><code>atol=1e-10</code></td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Penalty null space</td>
<td>Dimension = m</td>
<td>Exact count</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td><code>s()</code> term parsing</td>
<td>10+ variants</td>
<td>N/A</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td><code>te()</code> tensor product</td>
<td>Kronecker construction</td>
<td>Exact</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Automatic knot placement</td>
<td>Quantile-based</td>
<td>N/A</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Monotone rectification</td>
<td>Coefficients non-decreasing</td>
<td>N/A</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="simulation-test_simulation.jl" class="level2">
<h2 class="anchored" data-anchor-id="simulation-test_simulation.jl">4. Simulation (<code>test_simulation.jl</code>)</h2>
<p>Tests verify simulation produces statistically correct output with correct schema.</p>
<section id="mathematical-reference-2" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-2">4.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Simulation Statistical Properties (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Exponential Distribution (<span class="math inline">\(\text{Exp}(\lambda)\)</span>):</strong></p>
<ul>
<li>Mean: <span class="math inline">\(E[T] = 1/\lambda\)</span></li>
<li>Variance: <span class="math inline">\(\text{Var}(T) = 1/\lambda^2\)</span></li>
<li>Standard error of sample mean: <span class="math inline">\(\text{SE}(\bar{T}) = 1/(\lambda\sqrt{n})\)</span></li>
</ul>
<p><strong>Statistical Tests Applied:</strong></p>
<ol type="1">
<li>Sample mean within 10% of true mean (relative tolerance)</li>
<li>Sample variance within 15% of true variance</li>
<li>Sample mean within 3 standard errors of true mean (statistical validity)</li>
</ol>
</div>
</div>
</div>
</section>
<section id="test-criteria-2" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-2">4.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Simulation Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Distribution Correctness (n=500 simulations):</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 37%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean</td>
<td><span class="math inline">\(\|\bar{T} - 1/\lambda\| / (1/\lambda) &lt; 0.10\)</span></td>
<td><span class="math inline">\(\lambda=0.5\)</span>, true mean = 2.0</td>
</tr>
<tr class="even">
<td>Variance</td>
<td><span class="math inline">\(\|s^2 - 1/\lambda^2\| / (1/\lambda^2) &lt; 0.15\)</span></td>
<td>true var = 4.0</td>
</tr>
<tr class="odd">
<td>Standard error</td>
<td><span class="math inline">\(\|\bar{T} - 2.0\| &lt; 3 \times \text{SE}\)</span></td>
<td><span class="math inline">\(\text{SE} \approx 0.0894\)</span></td>
</tr>
</tbody>
</table>
<p><strong>DataFrame Schema:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Column</th>
<th>Required Type</th>
<th>Constraint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td><code>Int</code></td>
<td>Subject identifier</td>
</tr>
<tr class="even">
<td><code>tstart</code></td>
<td><code>Float64</code></td>
<td>Interval start</td>
</tr>
<tr class="odd">
<td><code>tstop</code></td>
<td><code>Float64</code></td>
<td>Interval end, <code>tstop &gt; tstart</code></td>
</tr>
<tr class="even">
<td><code>statefrom</code></td>
<td><code>Int</code></td>
<td>Origin state</td>
</tr>
<tr class="odd">
<td><code>stateto</code></td>
<td><code>Int</code></td>
<td>Destination state</td>
</tr>
<tr class="even">
<td><code>obstype</code></td>
<td><code>Int</code></td>
<td>Observation type</td>
</tr>
</tbody>
</table>
<p><strong>Path Validity:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Monotonic times</td>
<td><code>times[i+1] &gt; times[i]</code> for all <span class="math inline">\(i\)</span></td>
</tr>
<tr class="even">
<td>Legal transitions</td>
<td><code>tmat[from, to] &gt; 0</code> when state changes</td>
</tr>
<tr class="odd">
<td>Initial state</td>
<td>Matches <code>statefrom</code> in data</td>
</tr>
<tr class="even">
<td>Absorbing states</td>
<td>No transitions out of absorbing states</td>
</tr>
</tbody>
</table>
<p><strong>Transform Strategy Equivalence:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CachedTransformStrategy vs DirectTransformStrategy</td>
<td>Identical distribution (same RNG seed)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-2" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-2">4.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test Category</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean correctness</td>
<td>1</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Variance correctness</td>
<td>1</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Schema validation</td>
<td>3 simulations × 6 columns</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Monotonic times</td>
<td>50 paths</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Legal transitions</td>
<td>50 paths</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Initial state</td>
<td>20 paths</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Transform strategy parity</td>
<td>Same RNG</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="mcem-algorithm-test_mcem.jl" class="level2">
<h2 class="anchored" data-anchor-id="mcem-algorithm-test_mcem.jl">5. MCEM Algorithm (<code>test_mcem.jl</code>)</h2>
<p>Tests verify Monte Carlo EM helper functions.</p>
<section id="mathematical-reference-3" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-3">5.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>MCEM Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>MCEM Marginal Log-Likelihood:</strong></p>
<p><span class="math display">\[Q(\theta) = \sum_{i=1}^n w_i \sum_{j=1}^{m_i} p_{ij} \ell(\theta; y_i, z_{ij})\]</span></p>
<p>where <span class="math inline">\(w_i\)</span> = subject weight, <span class="math inline">\(p_{ij}\)</span> = importance weight for path <span class="math inline">\(j\)</span> of subject <span class="math inline">\(i\)</span>.</p>
<p><strong>MCEM Asymptotic Standard Error:</strong></p>
<p><span class="math display">\[\text{ASE} = \sqrt{\sum_{i=1}^n w_i^2 \cdot \text{Var}_{p_i}[\ell(\theta; y_i, z_i) - \ell(\theta_0; y_i, z_i)]}\]</span></p>
</div>
</div>
</div>
</section>
<section id="test-criteria-3" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-3">5.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed MCEM Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>ForwardDiff Gradient Compatibility:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ExactData gradient</td>
<td><code>ForwardDiff.gradient()</code> produces finite values</td>
</tr>
<tr class="even">
<td>SMPanelData gradient</td>
<td><code>ForwardDiff.gradient()</code> produces finite values</td>
</tr>
<tr class="odd">
<td>Gradient length</td>
<td>Matches parameter count</td>
</tr>
</tbody>
</table>
<p><strong>MCEM Helper Functions:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Test</th>
<th>Expected Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mcem_mll</code></td>
<td>Unit weights</td>
<td>Sum of weighted log-liks</td>
</tr>
<tr class="even">
<td><code>mcem_mll</code></td>
<td>Non-unit weights</td>
<td>Subject-weighted sum</td>
</tr>
<tr class="odd">
<td><code>mcem_ase</code></td>
<td>Identical logliks</td>
<td>0.0 (no variance)</td>
</tr>
<tr class="even">
<td><code>var_ris</code></td>
<td>All zeros</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<p><strong>MCEM Monotonicity (Limited Iterations):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Q-function increase</td>
<td>Final MLL not substantially worse than initial</td>
</tr>
<tr class="even">
<td>MC noise allowance</td>
<td>Allow 10% relative decrease</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-3" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-3">5.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AD gradient compatibility</td>
<td>2 data types</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td><code>mcem_mll</code> correctness</td>
<td>2 weight configs</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td><code>mcem_ase</code> correctness</td>
<td>1 edge case</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>MCEM monotonicity</td>
<td>3 iterations</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="sir-resampling-test_sir.jl" class="level2">
<h2 class="anchored" data-anchor-id="sir-resampling-test_sir.jl">6. SIR Resampling (<code>test_sir.jl</code>)</h2>
<p>Tests verify Sampling Importance Resampling functions for MCEM.</p>
<section id="mathematical-reference-4" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-4">6.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>SIR Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Pool Size Formula:</strong></p>
<p><span class="math display">\[m_\text{pool} = \min(c \cdot m \cdot \log(m), m_\text{max})\]</span></p>
<p>where <span class="math inline">\(c\)</span> = constant (default 2), <span class="math inline">\(m\)</span> = target ESS.</p>
<p><strong>Multinomial Resampling:</strong></p>
<ul>
<li>Sample indices with replacement proportional to weights</li>
<li>Expected count for index <span class="math inline">\(i\)</span>: <span class="math inline">\(E[n_i] = m \cdot w_i\)</span></li>
</ul>
<p><strong>Latin Hypercube Sampling (LHS):</strong></p>
<ul>
<li>Stratified sampling with one sample per stratum</li>
<li>Reduces variance compared to multinomial for smooth functions</li>
</ul>
</div>
</div>
</div>
</section>
<section id="test-criteria-4" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-4">6.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed SIR Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Pool Size Computation:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Input</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Basic</td>
<td>ESS=50, c=2.0</td>
<td><span class="math inline">\(\lceil 2 \cdot 50 \cdot \log(50) \rceil\)</span></td>
</tr>
<tr class="even">
<td>Cap</td>
<td>ESS=1000, max=500</td>
<td>500</td>
</tr>
<tr class="odd">
<td>Large ESS</td>
<td>ESS=1000, max=8192</td>
<td>8192 (capped)</td>
</tr>
<tr class="even">
<td>Edge case</td>
<td>ESS=1</td>
<td>1 (log(1)=0 handled)</td>
</tr>
</tbody>
</table>
<p><strong>Multinomial Resampling:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Output length</td>
<td>Equals requested count</td>
</tr>
<tr class="even">
<td>Index range</td>
<td>All indices in [1, n_weights]</td>
</tr>
<tr class="odd">
<td>Proportionality</td>
<td>Higher weights selected more often</td>
</tr>
<tr class="even">
<td>Determinism</td>
<td>Same RNG seed → same result</td>
</tr>
<tr class="odd">
<td>Uniform weights</td>
<td>Approximately equal counts</td>
</tr>
</tbody>
</table>
<p><strong>LHS Resampling:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Output length</td>
<td>Equals requested count</td>
</tr>
<tr class="even">
<td>Index range</td>
<td>All indices in [1, n_weights]</td>
</tr>
<tr class="odd">
<td>Variance reduction</td>
<td><span class="math inline">\(\text{Var}(\bar{X}_\text{LHS}) \leq 1.5 \cdot \text{Var}(\bar{X}_\text{SIR})\)</span></td>
</tr>
</tbody>
</table>
<p><strong>MLL Computation:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 23%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Test</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mcem_mll_sir</code></td>
<td>Uniform indices</td>
<td>Mean of selected log-liks</td>
</tr>
<tr class="even">
<td><code>mcem_mll_sir</code></td>
<td>Subject weights</td>
<td>Weighted sum</td>
</tr>
<tr class="odd">
<td><code>mcem_ase_sir</code></td>
<td>Known differences</td>
<td><span class="math inline">\(\sqrt{\sum_i \text{Var}_i / m_i}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-4" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-4">6.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pool size formula</td>
<td>5 cases</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Multinomial resampling</td>
<td>5 properties</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>LHS resampling</td>
<td>3 properties</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>LHS variance reduction</td>
<td>200 reps comparison</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>MLL with SIR</td>
<td>2 weight configs</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>ASE with SIR</td>
<td>Known variances</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="variance-estimation-test_variance.jl" class="level2">
<h2 class="anchored" data-anchor-id="variance-estimation-test_variance.jl">7. Variance Estimation (<code>test_variance.jl</code>)</h2>
<p>Tests verify variance-covariance matrix computation matches analytical formulas.</p>
<section id="mathematical-reference-5" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-5">7.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Variance Estimation Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Exponential MLE Fisher Information:</strong></p>
<ul>
<li>Observed information: <span class="math inline">\(I(\hat\lambda) = n/\hat\lambda^2\)</span></li>
<li>MLE variance: <span class="math inline">\(\text{Var}(\hat\lambda) = \hat\lambda^2/n\)</span></li>
<li>MLE formula: <span class="math inline">\(\hat\lambda = n / \sum_i t_i\)</span></li>
</ul>
<p><strong>Infinitesimal Jackknife (IJ):</strong></p>
<p><span class="math display">\[\text{Var}_\text{IJ} = \left(\frac{\partial^2 \ell}{\partial \theta^2}\right)^{-1} \left(\sum_i \frac{\partial \ell_i}{\partial \theta} \frac{\partial \ell_i}{\partial \theta}'\right) \left(\frac{\partial^2 \ell}{\partial \theta^2}\right)^{-1}\]</span></p>
<p><strong>JK-IJ Relationship:</strong></p>
<p><span class="math display">\[\text{Var}_\text{JK} = \frac{n-1}{n} \text{Var}_\text{IJ}\]</span></p>
</div>
</div>
</div>
</section>
<section id="test-criteria-5" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-5">7.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Variance Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Analytical Verification (Exponential, n=100):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MLE formula</td>
<td><span class="math inline">\(\hat\lambda = n/\sum t_i\)</span></td>
<td><code>rtol=0.001</code></td>
</tr>
<tr class="even">
<td>Variance formula</td>
<td><span class="math inline">\(\hat\sigma^2 = \hat\lambda^2/n\)</span></td>
<td><code>rtol=0.01</code></td>
</tr>
<tr class="odd">
<td>Asymptotic variance</td>
<td><span class="math inline">\(\approx \lambda^2/n = 0.0025\)</span></td>
<td><code>rtol=0.5</code></td>
</tr>
</tbody>
</table>
<p><strong>Variance Matrix Properties:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Property</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Symmetry</td>
<td><span class="math inline">\(\mathbf{V} = \mathbf{V}'\)</span> exactly</td>
</tr>
<tr class="even">
<td>Positive definiteness</td>
<td>All eigenvalues &gt; 0</td>
</tr>
<tr class="odd">
<td>Eigenvalue sum</td>
<td><span class="math inline">\(\sum \lambda_i = \text{tr}(\mathbf{V})\)</span></td>
</tr>
<tr class="even">
<td>Dimensions</td>
<td><span class="math inline">\(p \times p\)</span> where <span class="math inline">\(p\)</span> = parameter count</td>
</tr>
</tbody>
</table>
<p><strong>API Functionality:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>get_vcov(type=:model)</code></td>
<td>Returns model-based variance</td>
</tr>
<tr class="even">
<td><code>get_vcov(type=:ij)</code></td>
<td>Returns IJ variance</td>
</tr>
<tr class="odd">
<td><code>get_vcov(type=:jk)</code></td>
<td>Returns jackknife variance</td>
</tr>
<tr class="even">
<td>Unfitted model</td>
<td>Warns, returns nothing</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-5" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-5">7.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MLE analytical match</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Variance analytical match</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Symmetry</td>
<td>2 families</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Positive definiteness</td>
<td>2 families</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Eigenvalue checksum</td>
<td>2 families</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>API type selection</td>
<td>3 types</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Warning for missing vcov</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="pijcv-smoothing-selection-test_pijcv.jl" class="level2">
<h2 class="anchored" data-anchor-id="pijcv-smoothing-selection-test_pijcv.jl">8. PIJCV Smoothing Selection (<code>test_pijcv.jl</code>)</h2>
<p>Tests verify Predictive Infinitesimal Jackknife Cross-Validation implementation based on Wood (2024).</p>
<section id="mathematical-reference-6" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-6">8.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>PIJCV Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Cholesky Downdate:</strong></p>
<p>Given <span class="math inline">\(\mathbf{H} = \mathbf{L}\mathbf{L}'\)</span> and vector <span class="math inline">\(v\)</span>, compute <span class="math inline">\(\mathbf{L}_{-}\)</span> such that: <span class="math display">\[\mathbf{L}_{-}\mathbf{L}_{-}' = \mathbf{H} - vv'\]</span></p>
<p><strong>LOO Newton Step:</strong></p>
<p><span class="math display">\[\hat\theta_{-i} \approx \hat\theta - (\mathbf{H} - \mathbf{H}_i)^{-1} g_i\]</span></p>
<p>where <span class="math inline">\(\mathbf{H}_i\)</span> = subject <span class="math inline">\(i\)</span>’s Hessian contribution, <span class="math inline">\(g_i\)</span> = gradient contribution.</p>
<p><strong>PIJCV Criterion (Wood 2024):</strong></p>
<p><span class="math display">\[\text{PIJCV}(\lambda) = \sum_{i=1}^n \ell_i(\hat\theta_{-i}(\lambda))\]</span></p>
<p>Minimizing PIJCV selects optimal <span class="math inline">\(\lambda\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="test-criteria-6" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-6">8.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed PIJCV Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Cholesky Downdate:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Correctness</td>
<td><span class="math inline">\(\mathbf{L}_{-}\mathbf{L}_{-}' = \mathbf{H} - vv'\)</span></td>
</tr>
<tr class="even">
<td>PD preservation</td>
<td>All eigenvalues &gt; 0 after downdate</td>
</tr>
<tr class="odd">
<td>Indefiniteness detection</td>
<td>Returns false when <span class="math inline">\(\mathbf{H} - vv'\)</span> not PD</td>
</tr>
<tr class="even">
<td>Non-mutating copy</td>
<td>Original <span class="math inline">\(\mathbf{L}\)</span> unchanged</td>
</tr>
<tr class="odd">
<td>Sequential downdates</td>
<td>Accumulate correctly</td>
</tr>
</tbody>
</table>
<p><strong>LOO Newton Step:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Direct vs Cholesky</td>
<td>Results match to <code>rtol=1e-8</code></td>
</tr>
<tr class="even">
<td>Subject removal</td>
<td><span class="math inline">\((\mathbf{H} - \mathbf{H}_i)^{-1}\)</span> computed correctly</td>
</tr>
</tbody>
</table>
<p><strong>PIJCV Criterion:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Perturbations</td>
<td>Match direct LOO computation</td>
</tr>
<tr class="even">
<td>Objective value</td>
<td>Correct sum of LOO likelihoods</td>
</tr>
<tr class="odd">
<td>End-to-end API</td>
<td><code>select_smoothing_parameters</code> returns valid <span class="math inline">\(\lambda\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-6" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-6">8.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cholesky downdate correctness</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>PD preservation</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Indefiniteness detection</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Non-mutating copy</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Sequential downdates</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>LOO Newton step</td>
<td>2 methods compared</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>PIJCV criterion</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>End-to-end API</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="phase-type-models-test_phasetype.jl" class="level2">
<h2 class="anchored" data-anchor-id="phase-type-models-test_phasetype.jl">9. Phase-Type Models (<code>test_phasetype.jl</code>)</h2>
<p>Tests verify phase-type distribution implementation against analytical formulas.</p>
<section id="mathematical-reference-7" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-7">9.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Phase-Type Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong><span class="math inline">\(p\)</span>-Phase Coxian Distribution:</strong></p>
<p>Sub-intensity matrix <span class="math inline">\(\mathbf{S}\)</span>, absorption rates <span class="math inline">\(\mathbf{a}\)</span>, initial distribution <span class="math inline">\(\boldsymbol{\pi}\)</span>:</p>
<ul>
<li>Density: <span class="math inline">\(f(t) = \boldsymbol{\pi}' \exp(\mathbf{S}t) \mathbf{a}\)</span></li>
<li>Survival: <span class="math inline">\(S(t) = \boldsymbol{\pi}' \exp(\mathbf{S}t) \mathbf{1}\)</span></li>
<li>Hazard: <span class="math inline">\(h(t) = f(t) / S(t)\)</span></li>
<li>Cumulative hazard: <span class="math inline">\(H(t) = -\log S(t)\)</span></li>
</ul>
<p><strong>2-Phase Coxian Analytical Formulas:</strong></p>
<p>For <span class="math inline">\(\mathbf{S} = \begin{pmatrix} -(r+a_1) &amp; r \\ 0 &amp; -a_2 \end{pmatrix}\)</span>, <span class="math inline">\(\boldsymbol{\pi} = (1, 0)'\)</span>:</p>
<p><span class="math display">\[\exp(\mathbf{S}t)_{11} = e^{-\lambda_1 t}, \quad \exp(\mathbf{S}t)_{22} = e^{-\lambda_2 t}\]</span> <span class="math display">\[\exp(\mathbf{S}t)_{12} = \frac{r(e^{-\lambda_1 t} - e^{-\lambda_2 t})}{\lambda_2 - \lambda_1}\]</span></p>
<p>where <span class="math inline">\(\lambda_1 = r + a_1\)</span>, <span class="math inline">\(\lambda_2 = a_2\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="test-criteria-7" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-7">9.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Phase-Type Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Emission Matrix:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Panel observation (obstype=2)</td>
<td>All phases of destination state = 1.0</td>
</tr>
<tr class="even">
<td>Exact transition (obstype=1)</td>
<td>Only first phase = 1.0</td>
</tr>
<tr class="odd">
<td>Fully censored (obstype=0)</td>
<td>All phases = 1.0</td>
</tr>
<tr class="even">
<td>Custom censoring patterns</td>
<td>Correct pattern application</td>
</tr>
</tbody>
</table>
<p><strong>Data Expansion:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exact transition split</td>
<td>Creates intermediate “remain” row</td>
</tr>
<tr class="even">
<td>Panel observation</td>
<td>No expansion needed</td>
</tr>
<tr class="odd">
<td>Subject index recomputation</td>
<td>Indices remain valid</td>
</tr>
</tbody>
</table>
<p><strong>Hazard/Survival Correctness:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Tolerance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2-phase survival</td>
<td>Matches analytical formula</td>
<td><code>rtol=1e-10</code></td>
</tr>
<tr class="even">
<td>2-phase density</td>
<td>Matches analytical formula</td>
<td><code>rtol=1e-10</code></td>
</tr>
<tr class="odd">
<td>2-phase hazard</td>
<td><span class="math inline">\(h(t) = f(t)/S(t)\)</span></td>
<td><code>rtol=1e-10</code></td>
</tr>
<tr class="even">
<td>Cumulative hazard</td>
<td><span class="math inline">\(H(t) = -\log S(t)\)</span></td>
<td><code>rtol=1e-10</code></td>
</tr>
<tr class="odd">
<td>Log-likelihood</td>
<td>Analytical path likelihood</td>
<td><code>rtol=1e-8</code></td>
</tr>
</tbody>
</table>
<p><strong>Path Operations:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Expand path</td>
<td>Observable states → phase states</td>
</tr>
<tr class="even">
<td>Collapse path</td>
<td>Phase states → observable states</td>
</tr>
<tr class="odd">
<td>Round-trip</td>
<td>Expand then collapse = original</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-7" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-7">9.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Emission matrix obstype=1</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Emission matrix obstype=2</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Emission matrix obstype=0</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Data expansion</td>
<td>2 tests</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>2-phase survival</td>
<td>5 time points</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>2-phase density</td>
<td>5 time points</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>2-phase hazard</td>
<td>5 time points</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Path expansion</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Path collapse</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td>3 paths</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl">10. Likelihood Functions (<code>test_mll_consistency.jl</code>, <code>test_loglik_analytical.jl</code>)</h2>
<p>Tests verify likelihood computation consistency across methods.</p>
<section id="mathematical-reference-8" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-reference-8">10.1 Mathematical Reference</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Likelihood Mathematical Background (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Exact Data Likelihood:</strong></p>
<p><span class="math display">\[\ell(\theta) = \sum_i \left[ \log h(t_i | x_i) - H(0, t_i | x_i) \right]\]</span></p>
<p><strong>Panel Data Likelihood (Markov):</strong></p>
<p><span class="math display">\[\ell(\theta) = \sum_i \log \mathbf{P}(s_i | s_{i-1}, t_i - t_{i-1})\]</span></p>
<p>where <span class="math inline">\(\mathbf{P} = \exp(\mathbf{Q} \Delta t)\)</span> is the transition probability matrix.</p>
<p><strong>IS-Weighted MLL:</strong></p>
<p><span class="math display">\[\hat\ell = \sum_i w_i \sum_j p_{ij} \ell_{ij}\]</span></p>
</div>
</div>
</div>
</section>
<section id="test-criteria-8" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-8">10.2 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Likelihood Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>MLL Consistency Across Methods:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Method Pair</th>
<th>Criterion</th>
<th>Tolerance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>IS-weighted vs SIR</td>
<td>Sample-level agreement</td>
<td>15% relative</td>
</tr>
<tr class="even">
<td>IS-weighted vs LHS</td>
<td>Sample-level agreement</td>
<td>15% relative</td>
</tr>
<tr class="odd">
<td>SIR vs LHS</td>
<td>Sample-level agreement</td>
<td>15% relative</td>
</tr>
<tr class="even">
<td>Subject-level correlation</td>
<td><span class="math inline">\(r &gt; 0.85\)</span></td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>Subject-level MAE</td>
<td>&lt; 25% relative</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p><strong>Analytical Likelihood (Exponential):</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Formula</td>
<td><span class="math inline">\(\ell = n\log\lambda - \lambda \sum t_i\)</span></td>
</tr>
<tr class="even">
<td>Gradient</td>
<td>Matches ForwardDiff</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-8" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-8">10.3 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>IS vs SIR agreement</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>IS vs LHS agreement</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Subject-level correlation</td>
<td>3 pairs</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Subject-level MAE</td>
<td>2 methods</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Analytical likelihood</td>
<td>1 family</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="model-construction-test_modelgeneration.jl-test_initialization.jl" class="level2">
<h2 class="anchored" data-anchor-id="model-construction-test_modelgeneration.jl-test_initialization.jl">11. Model Construction (<code>test_modelgeneration.jl</code>, <code>test_initialization.jl</code>)</h2>
<p>Tests verify model building and parameter initialization.</p>
<section id="test-criteria-9" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-9">11.1 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed Model Construction Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Error Detection:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Input</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Duplicate transitions</td>
<td>Two hazards 1→2</td>
<td><code>ArgumentError</code></td>
</tr>
<tr class="even">
<td>State 0 origin</td>
<td><code>Hazard(..., 0, 1)</code></td>
<td><code>ArgumentError</code></td>
</tr>
<tr class="odd">
<td>State 0 destination</td>
<td><code>Hazard(..., 1, 0)</code></td>
<td><code>ArgumentError</code></td>
</tr>
<tr class="even">
<td>Self-transition</td>
<td><code>Hazard(..., 1, 1)</code></td>
<td><code>ArgumentError</code></td>
</tr>
<tr class="odd">
<td>Invalid family</td>
<td><code>Hazard(..., "invalid", ...)</code></td>
<td><code>ArgumentError</code></td>
</tr>
</tbody>
</table>
<p><strong>Censoring Pattern Handling:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pattern parsing</td>
<td>Row sums ≤ 1</td>
</tr>
<tr class="even">
<td>obstype &gt; 2</td>
<td>Uses pattern matrix</td>
</tr>
<tr class="odd">
<td>obstype = 0</td>
<td>All states possible</td>
</tr>
</tbody>
</table>
<p><strong>Initialization Methods:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Method</th>
<th>When Used</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>:crude</code></td>
<td>Markov models</td>
<td>Parameters non-NaN</td>
</tr>
<tr class="even">
<td><code>:surrogate</code></td>
<td>Semi-Markov models</td>
<td>Parameters non-NaN</td>
</tr>
<tr class="odd">
<td><code>:auto</code></td>
<td>Default</td>
<td>Selects appropriate method</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-9" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-9">11.2 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Duplicate transition detection</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>State 0 detection</td>
<td>2 tests</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Self-transition detection</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Censoring patterns</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Crude initialization</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Auto method selection</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="reconstructor-test_reconstructor.jl" class="level2">
<h2 class="anchored" data-anchor-id="reconstructor-test_reconstructor.jl">12. ReConstructor (<code>test_reconstructor.jl</code>)</h2>
<p>Tests verify AD-compatible parameter flattening/unflattening.</p>
<section id="test-criteria-10" class="level3">
<h3 class="anchored" data-anchor-id="test-criteria-10">12.1 Test Criteria</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Detailed ReConstructor Test Criteria (Click to expand)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Type Construction:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Input Type</th>
<th>Flatten Output</th>
<th>Unflatten Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Float64</code></td>
<td><code>[x]</code></td>
<td><code>x::Float64</code></td>
</tr>
<tr class="even">
<td><code>Vector{Float64}</code></td>
<td><code>x</code> (identity)</td>
<td><code>x::Vector</code></td>
</tr>
<tr class="odd">
<td><code>Vector{Int}</code></td>
<td><code>[]</code> (empty)</td>
<td>Original (no flatten)</td>
</tr>
<tr class="even">
<td><code>Tuple</code></td>
<td>Concatenated</td>
<td>Tuple with correct lengths</td>
</tr>
<tr class="odd">
<td><code>NamedTuple</code></td>
<td>Concatenated</td>
<td>NamedTuple with keys preserved</td>
</tr>
</tbody>
</table>
<p><strong>AD Compatibility:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ForwardDiff gradient</td>
<td>Through unflatten → compute → flatten</td>
</tr>
<tr class="even">
<td>Type stability</td>
<td>Return type matches input type</td>
</tr>
<tr class="odd">
<td>Strict mode</td>
<td>Exact key preservation</td>
</tr>
<tr class="even">
<td>Flexible mode</td>
<td>Structural preservation only</td>
</tr>
</tbody>
</table>
<p><strong>Round-trip:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>unflatten(flatten(x)) == x</code></td>
<td>For all supported types</td>
</tr>
<tr class="even">
<td>Nested structures</td>
<td>Recursive reconstruction</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="summary-table-10" class="level3">
<h3 class="anchored" data-anchor-id="summary-table-10">12.2 Summary Table</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Component</th>
<th>Tests</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Real number</td>
<td>2 modes</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Float vector</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Int vector (skip)</td>
<td>1 test</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Tuple</td>
<td>2 depths</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>NamedTuple</td>
<td>2 depths</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>AD compatibility</td>
<td>ForwardDiff</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Round-trip</td>
<td>All types</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="additional-tests" class="level2">
<h2 class="anchored" data-anchor-id="additional-tests">13. Additional Tests</h2>
<section id="ad-backends-test_ad_backends.jl" class="level3">
<h3 class="anchored" data-anchor-id="ad-backends-test_ad_backends.jl">13.1 AD Backends (<code>test_ad_backends.jl</code>)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Type existence</td>
<td><code>ADBackend</code> types defined</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Default selection</td>
<td>Parameter count thresholds</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>ForwardDiff gradient</td>
<td>Finite, correct length</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>fit() integration</td>
<td><code>adbackend</code> kwarg works</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
</section>
<section id="hazard-macro-test_hazard_macro.jl" class="level3">
<h3 class="anchored" data-anchor-id="hazard-macro-test_hazard_macro.jl">13.2 <span class="citation" data-cites="hazard">@hazard</span> Macro (<code>test_hazard_macro.jl</code>)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Family aliases</td>
<td><code>:exp</code>, <code>:wei</code>, <code>:gom</code>, <code>:sp</code>, <code>:pt</code></td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Transition syntax</td>
<td>Multiple formats</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Formula defaults</td>
<td>Intercept-only</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>Keyword forwarding</td>
<td><code>knots</code>, <code>n_phases</code>, etc.</td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Error messages</td>
<td>Missing/invalid family</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
</section>
<section id="model-output-test_model_output.jl" class="level3">
<h3 class="anchored" data-anchor-id="model-output-test_model_output.jl">13.3 Model Output (<code>test_model_output.jl</code>)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Test</th>
<th>Criterion</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AIC formula</td>
<td><span class="math inline">\(-2\ell + 2k\)</span></td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>BIC formula</td>
<td><span class="math inline">\(-2\ell + k\log n\)</span></td>
<td>✅ Pass</td>
</tr>
<tr class="odd">
<td>Summary table</td>
<td>TypedTable structure</td>
<td>✅ Pass</td>
</tr>
<tr class="even">
<td>estimate_loglik</td>
<td>ESS, MCSE fields</td>
<td>✅ Pass</td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="coverage-gaps-and-future-work" class="level2">
<h2 class="anchored" data-anchor-id="coverage-gaps-and-future-work">14. Coverage Gaps and Future Work</h2>
<section id="current-gaps" class="level3">
<h3 class="anchored" data-anchor-id="current-gaps">14.1 Current Gaps</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 23%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Area</th>
<th>Gap</th>
<th>Priority</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AFT + TVC</td>
<td>Limited testing for AFT with time-varying covariates</td>
<td>Medium</td>
</tr>
<tr class="even">
<td>Panel + Splines</td>
<td>Integration tests for spline hazards with panel data</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td>Edge cases</td>
<td>Degenerate transition matrices</td>
<td>Low</td>
</tr>
<tr class="even">
<td>Performance</td>
<td>Benchmark regression tests</td>
<td>Low</td>
</tr>
</tbody>
</table>
</section>
<section id="recently-added-coverage" class="level3">
<h3 class="anchored" data-anchor-id="recently-added-coverage">14.2 Recently Added Coverage</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Area</th>
<th>Files Added</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2026-01</td>
<td>EFS smoothing</td>
<td><code>test_efs.jl</code></td>
</tr>
<tr class="even">
<td>2026-01</td>
<td>PIJCV reference</td>
<td><code>test_pijcv_reference.jl</code>, <code>test_pijcv_vs_loocv.jl</code></td>
</tr>
<tr class="odd">
<td>2026-01</td>
<td>Analytical likelihood</td>
<td><code>test_loglik_analytical.jl</code></td>
</tr>
<tr class="even">
<td>2026-01</td>
<td>Subject weights</td>
<td><code>test_subject_weights.jl</code></td>
</tr>
<tr class="odd">
<td>2026-01</td>
<td>Penalty infrastructure</td>
<td><code>test_penalty_infrastructure.jl</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="running-tests" class="level2">
<h2 class="anchored" data-anchor-id="running-tests">15. Running Tests</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run all unit tests</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">julia</span> <span class="at">--project</span><span class="op">=</span>MultistateModelsTests <span class="at">-e</span> <span class="st">'using MultistateModelsTests; MultistateModelsTests.runtests()'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run specific test file</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">julia</span> <span class="at">--project</span><span class="op">=</span>MultistateModelsTests MultistateModelsTests/unit/test_hazards.jl</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run with verbose output</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">julia</span> <span class="at">--project</span><span class="op">=</span>MultistateModelsTests <span class="at">-e</span> <span class="st">'using Pkg; Pkg.test(test_args=["--verbose"])'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 MultistateModels.jl</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/blob/main/02_unit_tests.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>