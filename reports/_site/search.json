[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MultistateModels.jl",
    "section": "",
    "text": "Branch: penalized_splines ¬† Commit: bde2a53"
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "MultistateModels.jl",
    "section": "Overview",
    "text": "Overview\nComprehensive validation and documentation for MultistateModels.jl ‚Äî a Julia package for continuous-time multistate modeling.\n\n\nüìê Architecture\nType hierarchy, hazard families, inference engine, and simulation strategies.\n\n\n‚úÖ Unit Tests\nFunction-level tests for hazards, simulation, MCEM, and model construction.\n\n\nüìä Long Tests\nStatistical recovery of parameters across hazard families and data types.\n\n\nüéØ Simulation\nVisual verification of event time distributions (CDF diagnostic plots).\n\n\n‚ö° Benchmarks\nPerformance comparison of sampling methods and optimization strategies.\n\n\nüì¶ Main Package\nSource code and documentation for MultistateModels.jl."
  },
  {
    "objectID": "index.html#test-results-summary",
    "href": "index.html#test-results-summary",
    "title": "MultistateModels.jl",
    "section": "Test Results Summary",
    "text": "Test Results Summary\nNo cached test results available."
  },
  {
    "objectID": "index.html#quick-start",
    "href": "index.html#quick-start",
    "title": "MultistateModels.jl",
    "section": "Quick Start",
    "text": "Quick Start\n\nBuilding Reports Locally\ncd MultistateModelsTests/reports\nquarto render\n\n\nRunning Tests and Recording Results\n# Run full test suite with automatic cache recording\njulia --project=. -e 'using MultistateModelsTests; MultistateModelsTests.runtests()'\n\n# Or run with the dedicated script\njulia --project=. scripts/run_all_tests.jl\nTest results are automatically cached when running via runtests().\n\n\nChecking Cache Status\njulia --project=. scripts/refresh_cache.jl"
  },
  {
    "objectID": "02_unit_tests.html",
    "href": "02_unit_tests.html",
    "title": "Unit Test Coverage",
    "section": "",
    "text": "Metric\nValue\n\n\n\n\nTotal Test Files\n26\n\n\nTotal Test Cases\n~2831\n\n\nPassing\n~2831\n\n\nFailing\n0\n\n\nBranch\npenalized_splines\n\n\nRuntime\n~8.5 minutes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nArea\nTest Files\nDescription\n\n\n\n\nHazard Evaluation\ntest_hazards.jl, test_compute_hazard.jl\nHazard functions, cumulative hazards, survival\n\n\nSpline Infrastructure\ntest_splines.jl, test_penalty_infrastructure.jl\nB-spline basis, penalization\n\n\nSimulation\ntest_simulation.jl\nPath simulation, distribution fidelity\n\n\nMCEM Algorithm\ntest_mcem.jl\nMonte Carlo EM helper functions\n\n\nPhase-Type\ntest_phasetype.jl\nState expansion, FFBS, emission matrices, Coxian math\n\n\nSurrogates\ntest_surrogates.jl\nMarkov and phase-type surrogate fitting\n\n\nSIR Resampling\ntest_sir.jl\nMultinomial and LHS resampling\n\n\nVariance Estimation\ntest_variance.jl\nModel, IJ, jackknife variance\n\n\nWeights\ntest_subject_weights.jl\nSubject and observation weights\n\n\nPIJCV\ntest_pijcv.jl\nSmoothing parameter selection\n\n\nLikelihood\ntest_loglik_analytical.jl\nExact, panel, penalized likelihoods\n\n\nModel Construction\ntest_hazard_macro.jl, test_initialization.jl\nModel building, parameter init\n\n\nInfrastructure\ntest_bounds.jl, test_constraints.jl, test_ad_backends.jl\nParameter bounds, optimization, AD compatibility"
  },
  {
    "objectID": "02_unit_tests.html#coverage-summary",
    "href": "02_unit_tests.html#coverage-summary",
    "title": "Unit Test Coverage",
    "section": "",
    "text": "Metric\nValue\n\n\n\n\nTotal Test Files\n26\n\n\nTotal Test Cases\n~2831\n\n\nPassing\n~2831\n\n\nFailing\n0\n\n\nBranch\npenalized_splines\n\n\nRuntime\n~8.5 minutes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nArea\nTest Files\nDescription\n\n\n\n\nHazard Evaluation\ntest_hazards.jl, test_compute_hazard.jl\nHazard functions, cumulative hazards, survival\n\n\nSpline Infrastructure\ntest_splines.jl, test_penalty_infrastructure.jl\nB-spline basis, penalization\n\n\nSimulation\ntest_simulation.jl\nPath simulation, distribution fidelity\n\n\nMCEM Algorithm\ntest_mcem.jl\nMonte Carlo EM helper functions\n\n\nPhase-Type\ntest_phasetype.jl\nState expansion, FFBS, emission matrices, Coxian math\n\n\nSurrogates\ntest_surrogates.jl\nMarkov and phase-type surrogate fitting\n\n\nSIR Resampling\ntest_sir.jl\nMultinomial and LHS resampling\n\n\nVariance Estimation\ntest_variance.jl\nModel, IJ, jackknife variance\n\n\nWeights\ntest_subject_weights.jl\nSubject and observation weights\n\n\nPIJCV\ntest_pijcv.jl\nSmoothing parameter selection\n\n\nLikelihood\ntest_loglik_analytical.jl\nExact, panel, penalized likelihoods\n\n\nModel Construction\ntest_hazard_macro.jl, test_initialization.jl\nModel building, parameter init\n\n\nInfrastructure\ntest_bounds.jl, test_constraints.jl, test_ad_backends.jl\nParameter bounds, optimization, AD compatibility"
  },
  {
    "objectID": "02_unit_tests.html#hazard-functions-test_hazards.jl",
    "href": "02_unit_tests.html#hazard-functions-test_hazards.jl",
    "title": "Unit Test Coverage",
    "section": "2. Hazard Functions (test_hazards.jl)",
    "text": "2. Hazard Functions (test_hazards.jl)\nTests verify that all parametric hazard families return mathematically correct values against analytical formulas.\n\n2.1 Mathematical Reference\n\n\n\n\n\n\nNoteAnalytical Hazard Formulas (Click to expand)\n\n\n\n\n\nExponential:\n\n\\(h(t) = \\lambda\\) (constant hazard)\n\\(H(t) = \\lambda t\\) (cumulative hazard)\n\\(S(t) = \\exp(-\\lambda t)\\) (survival function)\n\nWeibull (shape \\(\\kappa\\), scale \\(\\lambda\\)):\n\n\\(h(t) = \\lambda \\kappa t^{\\kappa-1}\\) (increasing/decreasing with \\(t\\))\n\\(H(t) = \\lambda t^\\kappa\\)\n\\(S(t) = \\exp(-\\lambda t^\\kappa)\\)\n\nGompertz (shape \\(a\\), rate \\(b\\)) - flexsurv parameterization:\n\n\\(h(t) = b \\exp(at)\\) (\\(a&gt;0\\): increasing, \\(a&lt;0\\): decreasing)\n\\(H(t) = \\frac{b}{a}(\\exp(at) - 1)\\) for \\(a \\neq 0\\)\n\\(S(t) = \\exp\\left(-\\frac{b}{a}(\\exp(at) - 1)\\right)\\)\n\nCovariate Effects:\n\nProportional Hazards (PH): \\(h(t|x) = h_0(t) \\exp(\\beta'x)\\)\nAccelerated Failure Time (AFT): \\(h(t|x) = h_0(t \\cdot e^{-\\beta'x}) e^{-\\beta'x}\\)\n\n\n\n\n\n\n2.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Test Criteria (Click to expand)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTest\nCriterion\nFormula Verified\nTolerance\n\n\n\n\nSurvival probability\n\\(1 - S(0,t) = F(t)\\) matches Distributions.Exponential\nTotal hazard rate = 0.2, \\(F(2) = 1 - e^{-0.4}\\)\nrtol=1e-6\n\n\nExponential baseline\n\\(h(t) = \\lambda\\) constant in \\(t\\)\neval_hazard = rate parameter\nrtol=1e-6\n\n\nExponential with covariates\n\\(\\log h = \\log\\lambda + \\beta_1 x_1 + \\beta_2 x_2 + \\beta_{12} x_1 x_2\\)\nFull linear predictor formula\nExact match\n\n\nWeibull baseline\n\\(\\log h = \\log\\lambda + \\log\\kappa + (\\kappa-1)\\log t\\)\nLog-hazard at \\(t=1.7\\)\nrtol=1e-6\n\n\nWeibull with covariates\nPH and AFT covariate effects\nShape and scale adjustments\nrtol=1e-6\n\n\nGompertz baseline\n\\(h(t) = b\\exp(at)\\)\nRate exponentially increasing in \\(t\\)\nrtol=1e-6\n\n\nGompertz cumhaz\n\\(H(t) = (b/a)(\\exp(at)-1)\\)\nAnalytical integration\nrtol=1e-6\n\n\nTime transform parity\neval_hazard(apply_transform=true) = eval_hazard(apply_transform=false)\nTang optimization produces identical values\nExact match\n\n\nCumulative hazard additivity\n\\(H(a,c) = H(a,b) + H(b,c)\\)\nInterval splitting\nrtol=1e-8\n\n\n\nTolerance Justification: rtol=1e-6 accounts for ParameterHandling.positive() using \\(\\varepsilon \\approx 1.49 \\times 10^{-8}\\) safety margin in exp/log round-trips.\n\n\n\n\n\n2.3 Summary Table\n\n\n\nFamily\nBaseline\nCovariates\nAFT\nTime Transform\nStatus\n\n\n\n\nExponential\n‚úÖ\n‚úÖ\n‚úÖ\n‚úÖ\nPass\n\n\nWeibull\n‚úÖ\n‚úÖ\n‚úÖ\n‚úÖ\nPass\n\n\nGompertz\n‚úÖ\n‚úÖ\n‚úÖ\n‚úÖ\nPass\n\n\nSpline\n‚úÖ\n‚úÖ\n‚úÖ\n‚úÖ\nPass"
  },
  {
    "objectID": "02_unit_tests.html#spline-hazards-test_splines.jl",
    "href": "02_unit_tests.html#spline-hazards-test_splines.jl",
    "title": "Unit Test Coverage",
    "section": "3. Spline Hazards (test_splines.jl)",
    "text": "3. Spline Hazards (test_splines.jl)\nTests verify B-spline basis construction, numerical integration accuracy, and penalization infrastructure.\n\n3.1 Mathematical Reference\n\n\n\n\n\n\nNoteSpline Mathematical Background (Click to expand)\n\n\n\n\n\nB-Spline Hazard:\n\n\\(h(t) = \\sum_i \\beta_i B_i(t)\\) where \\(B_i\\) are B-spline basis functions\nCoefficients \\(\\beta_i &gt; 0\\) ensure non-negative hazard\n\nCumulative Hazard:\n\n\\(H(a,b) = \\int_a^b h(t) dt = \\sum_i \\beta_i \\int_a^b B_i(t) dt\\)\nUses analytical B-spline antiderivative (not numerical quadrature)\n\nSecond-Order Penalty Matrix:\n\n\\(\\mathbf{P} = \\int \\mathbf{B}''(t) \\mathbf{B}''(t)' dt\\)\nPenalizes deviation from linearity (Wood, 2017)\nMust be symmetric, positive semi-definite with \\(\\text{rank} = k - m\\) where \\(m\\) = penalty order\n\nTensor Product (te()):\n\n\\(f(x,y) = \\sum_i \\sum_j \\beta_{ij} B_i^{(x)}(x) B_j^{(y)}(y)\\)\nBasis: Kronecker product \\(\\mathbf{B}^{(x)} \\otimes \\mathbf{B}^{(y)}\\)\nPenalty: Row + column penalties on coefficient matrix\n\n\n\n\n\n\n3.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Spline Test Criteria (Click to expand)\n\n\n\n\n\nNumerical Integration Verification:\n\n\n\n\n\n\n\n\nTest\nCriterion\nMethod\n\n\n\n\nCumhaz vs QuadGK\n\\(H(a,b)_\\text{impl} \\approx \\int_a^b h(t)dt\\)\nQuadGK adaptive quadrature, 5 random parameter configs, 5 intervals each\n\n\nB-spline antiderivative\nBSplineKit integral() matches QuadGK\nrtol=1e-10 (machine precision for polynomials)\n\n\nCovariate effect\n\\(H(a,b|x) = H_0(a,b) \\exp(\\beta'x)\\) for PH\nMultiple covariate values\n\n\n\nPenalty Matrix Properties:\n\n\n\n\n\n\n\nProperty\nCriterion\n\n\n\n\nSymmetry\n\\(\\mathbf{P} = \\mathbf{P}'\\) exactly\n\n\nPositive semi-definiteness\nAll eigenvalues \\(\\geq 0\\)\n\n\nNull space dimension\n\\(\\text{dim}(\\text{null}(\\mathbf{P})) = m\\) (penalty order)\n\n\nNull space basis\nContains polynomials of degree \\(&lt; m\\)\n\n\n\nSmooth Term Parsing:\n\n\n\nTest\nInput\nExpected Output\n\n\n\n\nBasic s(x)\n@formula(0 ~ s(x))\nSmoothTerm with default k=10\n\n\nCustom k\n@formula(0 ~ s(x, k=15))\nSmoothTerm with k=15\n\n\nCustom m\n@formula(0 ~ s(x, m=1))\nFirst-order penalty (ridge)\n\n\nTensor product\n@formula(0 ~ te(x,y))\nTensorProductTerm\n\n\n\nAutomatic Knot Placement:\n\n\n\nTest\nCriterion\n\n\n\n\nInterior knots\nPlaced at quantiles of transition times\n\n\nBoundary knots\nSpan observed time range\n\n\nEdge case handling\nk &gt; n_unique_times handled gracefully\n\n\n\n\n\n\n\n\n3.3 Summary Table\n\n\n\n\n\n\n\n\n\nComponent\nTests\nTolerance\nStatus\n\n\n\n\nCumhaz vs numerical integration\n25 random configs\nrtol=1e-6\n‚úÖ Pass\n\n\nB-spline antiderivative\n6 test cases\nrtol=1e-10\n‚úÖ Pass\n\n\nPenalty matrix symmetry\nExact equality\nExact\n‚úÖ Pass\n\n\nPenalty matrix eigenvalues\nAll ‚â• 0\natol=1e-10\n‚úÖ Pass\n\n\nPenalty null space\nDimension = m\nExact count\n‚úÖ Pass\n\n\ns() term parsing\n10+ variants\nN/A\n‚úÖ Pass\n\n\nte() tensor product\nKronecker construction\nExact\n‚úÖ Pass\n\n\nAutomatic knot placement\nQuantile-based\nN/A\n‚úÖ Pass\n\n\nMonotone rectification\nCoefficients non-decreasing\nN/A\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#simulation-test_simulation.jl",
    "href": "02_unit_tests.html#simulation-test_simulation.jl",
    "title": "Unit Test Coverage",
    "section": "4. Simulation (test_simulation.jl)",
    "text": "4. Simulation (test_simulation.jl)\nTests verify simulation produces statistically correct output with correct schema.\n\n4.1 Mathematical Reference\n\n\n\n\n\n\nNoteSimulation Statistical Properties (Click to expand)\n\n\n\n\n\nExponential Distribution (\\(\\text{Exp}(\\lambda)\\)):\n\nMean: \\(E[T] = 1/\\lambda\\)\nVariance: \\(\\text{Var}(T) = 1/\\lambda^2\\)\nStandard error of sample mean: \\(\\text{SE}(\\bar{T}) = 1/(\\lambda\\sqrt{n})\\)\n\nStatistical Tests Applied:\n\nSample mean within 10% of true mean (relative tolerance)\nSample variance within 15% of true variance\nSample mean within 3 standard errors of true mean (statistical validity)\n\n\n\n\n\n\n4.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Simulation Test Criteria (Click to expand)\n\n\n\n\n\nDistribution Correctness (n=500 simulations):\n\n\n\n\n\n\n\n\nTest\nCriterion\nParameters\n\n\n\n\nMean\n\\(\\|\\bar{T} - 1/\\lambda\\| / (1/\\lambda) &lt; 0.10\\)\n\\(\\lambda=0.5\\), true mean = 2.0\n\n\nVariance\n\\(\\|s^2 - 1/\\lambda^2\\| / (1/\\lambda^2) &lt; 0.15\\)\ntrue var = 4.0\n\n\nStandard error\n\\(\\|\\bar{T} - 2.0\\| &lt; 3 \\times \\text{SE}\\)\n\\(\\text{SE} \\approx 0.0894\\)\n\n\n\nDataFrame Schema:\n\n\n\nColumn\nRequired Type\nConstraint\n\n\n\n\nid\nInt\nSubject identifier\n\n\ntstart\nFloat64\nInterval start\n\n\ntstop\nFloat64\nInterval end, tstop &gt; tstart\n\n\nstatefrom\nInt\nOrigin state\n\n\nstateto\nInt\nDestination state\n\n\nobstype\nInt\nObservation type\n\n\n\nPath Validity:\n\n\n\nTest\nCriterion\n\n\n\n\nMonotonic times\ntimes[i+1] &gt; times[i] for all \\(i\\)\n\n\nLegal transitions\ntmat[from, to] &gt; 0 when state changes\n\n\nInitial state\nMatches statefrom in data\n\n\nAbsorbing states\nNo transitions out of absorbing states\n\n\n\nTransform Strategy Equivalence:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nCachedTransformStrategy vs DirectTransformStrategy\nIdentical distribution (same RNG seed)\n\n\n\n\n\n\n\n\n4.3 Summary Table\n\n\n\nTest Category\nTests\nStatus\n\n\n\n\nMean correctness\n1\n‚úÖ Pass\n\n\nVariance correctness\n1\n‚úÖ Pass\n\n\nSchema validation\n3 simulations √ó 6 columns\n‚úÖ Pass\n\n\nMonotonic times\n50 paths\n‚úÖ Pass\n\n\nLegal transitions\n50 paths\n‚úÖ Pass\n\n\nInitial state\n20 paths\n‚úÖ Pass\n\n\nTransform strategy parity\nSame RNG\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#mcem-algorithm-test_mcem.jl",
    "href": "02_unit_tests.html#mcem-algorithm-test_mcem.jl",
    "title": "Unit Test Coverage",
    "section": "5. MCEM Algorithm (test_mcem.jl)",
    "text": "5. MCEM Algorithm (test_mcem.jl)\nTests verify Monte Carlo EM helper functions.\n\n5.1 Mathematical Reference\n\n\n\n\n\n\nNoteMCEM Mathematical Background (Click to expand)\n\n\n\n\n\nMCEM Marginal Log-Likelihood:\n\\[Q(\\theta) = \\sum_{i=1}^n w_i \\sum_{j=1}^{m_i} p_{ij} \\ell(\\theta; y_i, z_{ij})\\]\nwhere \\(w_i\\) = subject weight, \\(p_{ij}\\) = importance weight for path \\(j\\) of subject \\(i\\).\nMCEM Asymptotic Standard Error:\n\\[\\text{ASE} = \\sqrt{\\sum_{i=1}^n w_i^2 \\cdot \\text{Var}_{p_i}[\\ell(\\theta; y_i, z_i) - \\ell(\\theta_0; y_i, z_i)]}\\]\n\n\n\n\n\n5.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed MCEM Test Criteria (Click to expand)\n\n\n\n\n\nForwardDiff Gradient Compatibility:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nExactData gradient\nForwardDiff.gradient() produces finite values\n\n\nSMPanelData gradient\nForwardDiff.gradient() produces finite values\n\n\nGradient length\nMatches parameter count\n\n\n\nMCEM Helper Functions:\n\n\n\nFunction\nTest\nExpected Value\n\n\n\n\nmcem_mll\nUnit weights\nSum of weighted log-liks\n\n\nmcem_mll\nNon-unit weights\nSubject-weighted sum\n\n\nmcem_ase\nIdentical logliks\n0.0 (no variance)\n\n\nvar_ris\nAll zeros\n0.0\n\n\n\nMCEM Monotonicity (Limited Iterations):\n\n\n\nTest\nCriterion\n\n\n\n\nQ-function increase\nFinal MLL not substantially worse than initial\n\n\nMC noise allowance\nAllow 10% relative decrease\n\n\n\n\n\n\n\n\n5.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nAD gradient compatibility\n2 data types\n‚úÖ Pass\n\n\nmcem_mll correctness\n2 weight configs\n‚úÖ Pass\n\n\nmcem_ase correctness\n1 edge case\n‚úÖ Pass\n\n\nMCEM monotonicity\n3 iterations\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#sir-resampling-test_sir.jl",
    "href": "02_unit_tests.html#sir-resampling-test_sir.jl",
    "title": "Unit Test Coverage",
    "section": "6. SIR Resampling (test_sir.jl)",
    "text": "6. SIR Resampling (test_sir.jl)\nTests verify Sampling Importance Resampling functions for MCEM.\n\n6.1 Mathematical Reference\n\n\n\n\n\n\nNoteSIR Mathematical Background (Click to expand)\n\n\n\n\n\nPool Size Formula:\n\\[m_\\text{pool} = \\min(c \\cdot m \\cdot \\log(m), m_\\text{max})\\]\nwhere \\(c\\) = constant (default 2), \\(m\\) = target ESS.\nMultinomial Resampling:\n\nSample indices with replacement proportional to weights\nExpected count for index \\(i\\): \\(E[n_i] = m \\cdot w_i\\)\n\nLatin Hypercube Sampling (LHS):\n\nStratified sampling with one sample per stratum\nReduces variance compared to multinomial for smooth functions\n\n\n\n\n\n\n6.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed SIR Test Criteria (Click to expand)\n\n\n\n\n\nPool Size Computation:\n\n\n\nTest\nInput\nExpected\n\n\n\n\nBasic\nESS=50, c=2.0\n\\(\\lceil 2 \\cdot 50 \\cdot \\log(50) \\rceil\\)\n\n\nCap\nESS=1000, max=500\n500\n\n\nLarge ESS\nESS=1000, max=8192\n8192 (capped)\n\n\nEdge case\nESS=1\n1 (log(1)=0 handled)\n\n\n\nMultinomial Resampling:\n\n\n\nTest\nCriterion\n\n\n\n\nOutput length\nEquals requested count\n\n\nIndex range\nAll indices in [1, n_weights]\n\n\nProportionality\nHigher weights selected more often\n\n\nDeterminism\nSame RNG seed ‚Üí same result\n\n\nUniform weights\nApproximately equal counts\n\n\n\nLHS Resampling:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nOutput length\nEquals requested count\n\n\nIndex range\nAll indices in [1, n_weights]\n\n\nVariance reduction\n\\(\\text{Var}(\\bar{X}_\\text{LHS}) \\leq 1.5 \\cdot \\text{Var}(\\bar{X}_\\text{SIR})\\)\n\n\n\nMLL Computation:\n\n\n\n\n\n\n\n\nFunction\nTest\nExpected\n\n\n\n\nmcem_mll_sir\nUniform indices\nMean of selected log-liks\n\n\nmcem_mll_sir\nSubject weights\nWeighted sum\n\n\nmcem_ase_sir\nKnown differences\n\\(\\sqrt{\\sum_i \\text{Var}_i / m_i}\\)\n\n\n\n\n\n\n\n\n6.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nPool size formula\n5 cases\n‚úÖ Pass\n\n\nMultinomial resampling\n5 properties\n‚úÖ Pass\n\n\nLHS resampling\n3 properties\n‚úÖ Pass\n\n\nLHS variance reduction\n200 reps comparison\n‚úÖ Pass\n\n\nMLL with SIR\n2 weight configs\n‚úÖ Pass\n\n\nASE with SIR\nKnown variances\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#variance-estimation-test_variance.jl",
    "href": "02_unit_tests.html#variance-estimation-test_variance.jl",
    "title": "Unit Test Coverage",
    "section": "7. Variance Estimation (test_variance.jl)",
    "text": "7. Variance Estimation (test_variance.jl)\nTests verify variance-covariance matrix computation matches analytical formulas.\n\n7.1 Mathematical Reference\n\n\n\n\n\n\nNoteVariance Estimation Mathematical Background (Click to expand)\n\n\n\n\n\nExponential MLE Fisher Information:\n\nObserved information: \\(I(\\hat\\lambda) = n/\\hat\\lambda^2\\)\nMLE variance: \\(\\text{Var}(\\hat\\lambda) = \\hat\\lambda^2/n\\)\nMLE formula: \\(\\hat\\lambda = n / \\sum_i t_i\\)\n\nInfinitesimal Jackknife (IJ):\n\\[\\text{Var}_\\text{IJ} = \\left(\\frac{\\partial^2 \\ell}{\\partial \\theta^2}\\right)^{-1} \\left(\\sum_i \\frac{\\partial \\ell_i}{\\partial \\theta} \\frac{\\partial \\ell_i}{\\partial \\theta}'\\right) \\left(\\frac{\\partial^2 \\ell}{\\partial \\theta^2}\\right)^{-1}\\]\nJK-IJ Relationship:\n\\[\\text{Var}_\\text{JK} = \\frac{n-1}{n} \\text{Var}_\\text{IJ}\\]\n\n\n\n\n\n7.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Variance Test Criteria (Click to expand)\n\n\n\n\n\nAnalytical Verification (Exponential, n=100):\n\n\n\nTest\nCriterion\nExpected\n\n\n\n\nMLE formula\n\\(\\hat\\lambda = n/\\sum t_i\\)\nrtol=0.001\n\n\nVariance formula\n\\(\\hat\\sigma^2 = \\hat\\lambda^2/n\\)\nrtol=0.01\n\n\nAsymptotic variance\n\\(\\approx \\lambda^2/n = 0.0025\\)\nrtol=0.5\n\n\n\nVariance Matrix Properties:\n\n\n\nProperty\nCriterion\n\n\n\n\nSymmetry\n\\(\\mathbf{V} = \\mathbf{V}'\\) exactly\n\n\nPositive definiteness\nAll eigenvalues &gt; 0\n\n\nEigenvalue sum\n\\(\\sum \\lambda_i = \\text{tr}(\\mathbf{V})\\)\n\n\nDimensions\n\\(p \\times p\\) where \\(p\\) = parameter count\n\n\n\nAPI Functionality:\n\n\n\nTest\nCriterion\n\n\n\n\nget_vcov(type=:model)\nReturns model-based variance\n\n\nget_vcov(type=:ij)\nReturns IJ variance\n\n\nget_vcov(type=:jk)\nReturns jackknife variance\n\n\nUnfitted model\nWarns, returns nothing\n\n\n\n\n\n\n\n\n7.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nMLE analytical match\n1 test\n‚úÖ Pass\n\n\nVariance analytical match\n1 test\n‚úÖ Pass\n\n\nSymmetry\n2 families\n‚úÖ Pass\n\n\nPositive definiteness\n2 families\n‚úÖ Pass\n\n\nEigenvalue checksum\n2 families\n‚úÖ Pass\n\n\nAPI type selection\n3 types\n‚úÖ Pass\n\n\nWarning for missing vcov\n1 test\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#pijcv-smoothing-selection-test_pijcv.jl",
    "href": "02_unit_tests.html#pijcv-smoothing-selection-test_pijcv.jl",
    "title": "Unit Test Coverage",
    "section": "8. PIJCV Smoothing Selection (test_pijcv.jl)",
    "text": "8. PIJCV Smoothing Selection (test_pijcv.jl)\nTests verify Predictive Infinitesimal Jackknife Cross-Validation implementation based on Wood (2024).\n\n8.1 Mathematical Reference\n\n\n\n\n\n\nNotePIJCV Mathematical Background (Click to expand)\n\n\n\n\n\nCholesky Downdate:\nGiven \\(\\mathbf{H} = \\mathbf{L}\\mathbf{L}'\\) and vector \\(v\\), compute \\(\\mathbf{L}_{-}\\) such that: \\[\\mathbf{L}_{-}\\mathbf{L}_{-}' = \\mathbf{H} - vv'\\]\nLOO Newton Step:\n\\[\\hat\\theta_{-i} \\approx \\hat\\theta - (\\mathbf{H} - \\mathbf{H}_i)^{-1} g_i\\]\nwhere \\(\\mathbf{H}_i\\) = subject \\(i\\)‚Äôs Hessian contribution, \\(g_i\\) = gradient contribution.\nPIJCV Criterion (Wood 2024):\n\\[\\text{PIJCV}(\\lambda) = \\sum_{i=1}^n \\ell_i(\\hat\\theta_{-i}(\\lambda))\\]\nMinimizing PIJCV selects optimal \\(\\lambda\\).\n\n\n\n\n\n8.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed PIJCV Test Criteria (Click to expand)\n\n\n\n\n\nCholesky Downdate:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nCorrectness\n\\(\\mathbf{L}_{-}\\mathbf{L}_{-}' = \\mathbf{H} - vv'\\)\n\n\nPD preservation\nAll eigenvalues &gt; 0 after downdate\n\n\nIndefiniteness detection\nReturns false when \\(\\mathbf{H} - vv'\\) not PD\n\n\nNon-mutating copy\nOriginal \\(\\mathbf{L}\\) unchanged\n\n\nSequential downdates\nAccumulate correctly\n\n\n\nLOO Newton Step:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nDirect vs Cholesky\nResults match to rtol=1e-8\n\n\nSubject removal\n\\((\\mathbf{H} - \\mathbf{H}_i)^{-1}\\) computed correctly\n\n\n\nPIJCV Criterion:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nPerturbations\nMatch direct LOO computation\n\n\nObjective value\nCorrect sum of LOO likelihoods\n\n\nEnd-to-end API\nselect_smoothing_parameters returns valid \\(\\lambda\\)\n\n\n\n\n\n\n\n\n8.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nCholesky downdate correctness\n1 test\n‚úÖ Pass\n\n\nPD preservation\n1 test\n‚úÖ Pass\n\n\nIndefiniteness detection\n1 test\n‚úÖ Pass\n\n\nNon-mutating copy\n1 test\n‚úÖ Pass\n\n\nSequential downdates\n1 test\n‚úÖ Pass\n\n\nLOO Newton step\n2 methods compared\n‚úÖ Pass\n\n\nPIJCV criterion\n1 test\n‚úÖ Pass\n\n\nEnd-to-end API\n1 test\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#phase-type-models-test_phasetype.jl",
    "href": "02_unit_tests.html#phase-type-models-test_phasetype.jl",
    "title": "Unit Test Coverage",
    "section": "9. Phase-Type Models (test_phasetype.jl)",
    "text": "9. Phase-Type Models (test_phasetype.jl)\nTests verify phase-type distribution implementation against analytical formulas.\n\n9.1 Mathematical Reference\n\n\n\n\n\n\nNotePhase-Type Mathematical Background (Click to expand)\n\n\n\n\n\n\\(p\\)-Phase Coxian Distribution:\nSub-intensity matrix \\(\\mathbf{S}\\), absorption rates \\(\\mathbf{a}\\), initial distribution \\(\\boldsymbol{\\pi}\\):\n\nDensity: \\(f(t) = \\boldsymbol{\\pi}' \\exp(\\mathbf{S}t) \\mathbf{a}\\)\nSurvival: \\(S(t) = \\boldsymbol{\\pi}' \\exp(\\mathbf{S}t) \\mathbf{1}\\)\nHazard: \\(h(t) = f(t) / S(t)\\)\nCumulative hazard: \\(H(t) = -\\log S(t)\\)\n\n2-Phase Coxian Analytical Formulas:\nFor \\(\\mathbf{S} = \\begin{pmatrix} -(r+a_1) & r \\\\ 0 & -a_2 \\end{pmatrix}\\), \\(\\boldsymbol{\\pi} = (1, 0)'\\):\n\\[\\exp(\\mathbf{S}t)_{11} = e^{-\\lambda_1 t}, \\quad \\exp(\\mathbf{S}t)_{22} = e^{-\\lambda_2 t}\\] \\[\\exp(\\mathbf{S}t)_{12} = \\frac{r(e^{-\\lambda_1 t} - e^{-\\lambda_2 t})}{\\lambda_2 - \\lambda_1}\\]\nwhere \\(\\lambda_1 = r + a_1\\), \\(\\lambda_2 = a_2\\).\n\n\n\n\n\n9.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Phase-Type Test Criteria (Click to expand)\n\n\n\n\n\nEmission Matrix:\n\n\n\n\n\n\n\nTest\nCriterion\n\n\n\n\nPanel observation (obstype=2)\nAll phases of destination state = 1.0\n\n\nExact transition (obstype=1)\nOnly first phase = 1.0\n\n\nFully censored (obstype=0)\nAll phases = 1.0\n\n\nCustom censoring patterns\nCorrect pattern application\n\n\n\nData Expansion:\n\n\n\nTest\nCriterion\n\n\n\n\nExact transition split\nCreates intermediate ‚Äúremain‚Äù row\n\n\nPanel observation\nNo expansion needed\n\n\nSubject index recomputation\nIndices remain valid\n\n\n\nHazard/Survival Correctness:\n\n\n\nTest\nCriterion\nTolerance\n\n\n\n\n2-phase survival\nMatches analytical formula\nrtol=1e-10\n\n\n2-phase density\nMatches analytical formula\nrtol=1e-10\n\n\n2-phase hazard\n\\(h(t) = f(t)/S(t)\\)\nrtol=1e-10\n\n\nCumulative hazard\n\\(H(t) = -\\log S(t)\\)\nrtol=1e-10\n\n\nLog-likelihood\nAnalytical path likelihood\nrtol=1e-8\n\n\n\nPath Operations:\n\n\n\nTest\nCriterion\n\n\n\n\nExpand path\nObservable states ‚Üí phase states\n\n\nCollapse path\nPhase states ‚Üí observable states\n\n\nRound-trip\nExpand then collapse = original\n\n\n\n\n\n\n\n\n9.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nEmission matrix obstype=1\n1 test\n‚úÖ Pass\n\n\nEmission matrix obstype=2\n1 test\n‚úÖ Pass\n\n\nEmission matrix obstype=0\n1 test\n‚úÖ Pass\n\n\nData expansion\n2 tests\n‚úÖ Pass\n\n\n2-phase survival\n5 time points\n‚úÖ Pass\n\n\n2-phase density\n5 time points\n‚úÖ Pass\n\n\n2-phase hazard\n5 time points\n‚úÖ Pass\n\n\nPath expansion\n1 test\n‚úÖ Pass\n\n\nPath collapse\n1 test\n‚úÖ Pass\n\n\nLog-likelihood\n3 paths\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl",
    "href": "02_unit_tests.html#likelihood-functions-test_mll_consistency.jl-test_loglik_analytical.jl",
    "title": "Unit Test Coverage",
    "section": "10. Likelihood Functions (test_mll_consistency.jl, test_loglik_analytical.jl)",
    "text": "10. Likelihood Functions (test_mll_consistency.jl, test_loglik_analytical.jl)\nTests verify likelihood computation consistency across methods.\n\n10.1 Mathematical Reference\n\n\n\n\n\n\nNoteLikelihood Mathematical Background (Click to expand)\n\n\n\n\n\nExact Data Likelihood:\n\\[\\ell(\\theta) = \\sum_i \\left[ \\log h(t_i | x_i) - H(0, t_i | x_i) \\right]\\]\nPanel Data Likelihood (Markov):\n\\[\\ell(\\theta) = \\sum_i \\log \\mathbf{P}(s_i | s_{i-1}, t_i - t_{i-1})\\]\nwhere \\(\\mathbf{P} = \\exp(\\mathbf{Q} \\Delta t)\\) is the transition probability matrix.\nIS-Weighted MLL:\n\\[\\hat\\ell = \\sum_i w_i \\sum_j p_{ij} \\ell_{ij}\\]\n\n\n\n\n\n10.2 Test Criteria\n\n\n\n\n\n\nNoteDetailed Likelihood Test Criteria (Click to expand)\n\n\n\n\n\nMLL Consistency Across Methods:\n\n\n\nMethod Pair\nCriterion\nTolerance\n\n\n\n\nIS-weighted vs SIR\nSample-level agreement\n15% relative\n\n\nIS-weighted vs LHS\nSample-level agreement\n15% relative\n\n\nSIR vs LHS\nSample-level agreement\n15% relative\n\n\nSubject-level correlation\n\\(r &gt; 0.85\\)\nN/A\n\n\nSubject-level MAE\n&lt; 25% relative\nN/A\n\n\n\nAnalytical Likelihood (Exponential):\n\n\n\nTest\nCriterion\n\n\n\n\nFormula\n\\(\\ell = n\\log\\lambda - \\lambda \\sum t_i\\)\n\n\nGradient\nMatches ForwardDiff\n\n\n\n\n\n\n\n\n10.3 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nIS vs SIR agreement\n1 test\n‚úÖ Pass\n\n\nIS vs LHS agreement\n1 test\n‚úÖ Pass\n\n\nSubject-level correlation\n3 pairs\n‚úÖ Pass\n\n\nSubject-level MAE\n2 methods\n‚úÖ Pass\n\n\nAnalytical likelihood\n1 family\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#model-construction-test_modelgeneration.jl-test_initialization.jl",
    "href": "02_unit_tests.html#model-construction-test_modelgeneration.jl-test_initialization.jl",
    "title": "Unit Test Coverage",
    "section": "11. Model Construction (test_modelgeneration.jl, test_initialization.jl)",
    "text": "11. Model Construction (test_modelgeneration.jl, test_initialization.jl)\nTests verify model building and parameter initialization.\n\n11.1 Test Criteria\n\n\n\n\n\n\nNoteDetailed Model Construction Test Criteria (Click to expand)\n\n\n\n\n\nError Detection:\n\n\n\nTest\nInput\nExpected\n\n\n\n\nDuplicate transitions\nTwo hazards 1‚Üí2\nArgumentError\n\n\nState 0 origin\nHazard(..., 0, 1)\nArgumentError\n\n\nState 0 destination\nHazard(..., 1, 0)\nArgumentError\n\n\nSelf-transition\nHazard(..., 1, 1)\nArgumentError\n\n\nInvalid family\nHazard(..., \"invalid\", ...)\nArgumentError\n\n\n\nCensoring Pattern Handling:\n\n\n\nTest\nCriterion\n\n\n\n\nPattern parsing\nRow sums ‚â§ 1\n\n\nobstype &gt; 2\nUses pattern matrix\n\n\nobstype = 0\nAll states possible\n\n\n\nInitialization Methods:\n\n\n\nMethod\nWhen Used\nCriterion\n\n\n\n\n:crude\nMarkov models\nParameters non-NaN\n\n\n:surrogate\nSemi-Markov models\nParameters non-NaN\n\n\n:auto\nDefault\nSelects appropriate method\n\n\n\n\n\n\n\n\n11.2 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nDuplicate transition detection\n1 test\n‚úÖ Pass\n\n\nState 0 detection\n2 tests\n‚úÖ Pass\n\n\nSelf-transition detection\n1 test\n‚úÖ Pass\n\n\nCensoring patterns\n1 test\n‚úÖ Pass\n\n\nCrude initialization\n1 test\n‚úÖ Pass\n\n\nAuto method selection\n1 test\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#reconstructor-test_reconstructor.jl",
    "href": "02_unit_tests.html#reconstructor-test_reconstructor.jl",
    "title": "Unit Test Coverage",
    "section": "12. ReConstructor (test_reconstructor.jl)",
    "text": "12. ReConstructor (test_reconstructor.jl)\nTests verify AD-compatible parameter flattening/unflattening.\n\n12.1 Test Criteria\n\n\n\n\n\n\nNoteDetailed ReConstructor Test Criteria (Click to expand)\n\n\n\n\n\nType Construction:\n\n\n\nInput Type\nFlatten Output\nUnflatten Output\n\n\n\n\nFloat64\n[x]\nx::Float64\n\n\nVector{Float64}\nx (identity)\nx::Vector\n\n\nVector{Int}\n[] (empty)\nOriginal (no flatten)\n\n\nTuple\nConcatenated\nTuple with correct lengths\n\n\nNamedTuple\nConcatenated\nNamedTuple with keys preserved\n\n\n\nAD Compatibility:\n\n\n\nTest\nCriterion\n\n\n\n\nForwardDiff gradient\nThrough unflatten ‚Üí compute ‚Üí flatten\n\n\nType stability\nReturn type matches input type\n\n\nStrict mode\nExact key preservation\n\n\nFlexible mode\nStructural preservation only\n\n\n\nRound-trip:\n\n\n\nTest\nCriterion\n\n\n\n\nunflatten(flatten(x)) == x\nFor all supported types\n\n\nNested structures\nRecursive reconstruction\n\n\n\n\n\n\n\n\n12.2 Summary Table\n\n\n\nComponent\nTests\nStatus\n\n\n\n\nReal number\n2 modes\n‚úÖ Pass\n\n\nFloat vector\n1 test\n‚úÖ Pass\n\n\nInt vector (skip)\n1 test\n‚úÖ Pass\n\n\nTuple\n2 depths\n‚úÖ Pass\n\n\nNamedTuple\n2 depths\n‚úÖ Pass\n\n\nAD compatibility\nForwardDiff\n‚úÖ Pass\n\n\nRound-trip\nAll types\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#additional-tests",
    "href": "02_unit_tests.html#additional-tests",
    "title": "Unit Test Coverage",
    "section": "13. Additional Tests",
    "text": "13. Additional Tests\n\n13.1 AD Backends (test_ad_backends.jl)\n\n\n\nTest\nCriterion\nStatus\n\n\n\n\nType existence\nADBackend types defined\n‚úÖ Pass\n\n\nDefault selection\nParameter count thresholds\n‚úÖ Pass\n\n\nForwardDiff gradient\nFinite, correct length\n‚úÖ Pass\n\n\nfit() integration\nadbackend kwarg works\n‚úÖ Pass\n\n\n\n\n\n13.2 @hazard Macro (test_hazard_macro.jl)\n\n\n\nTest\nCriterion\nStatus\n\n\n\n\nFamily aliases\n:exp, :wei, :gom, :sp, :pt\n‚úÖ Pass\n\n\nTransition syntax\nMultiple formats\n‚úÖ Pass\n\n\nFormula defaults\nIntercept-only\n‚úÖ Pass\n\n\nKeyword forwarding\nknots, n_phases, etc.\n‚úÖ Pass\n\n\nError messages\nMissing/invalid family\n‚úÖ Pass\n\n\n\n\n\n13.3 Model Output (test_model_output.jl)\n\n\n\nTest\nCriterion\nStatus\n\n\n\n\nAIC formula\n\\(-2\\ell + 2k\\)\n‚úÖ Pass\n\n\nBIC formula\n\\(-2\\ell + k\\log n\\)\n‚úÖ Pass\n\n\nSummary table\nTypedTable structure\n‚úÖ Pass\n\n\nestimate_loglik\nESS, MCSE fields\n‚úÖ Pass"
  },
  {
    "objectID": "02_unit_tests.html#coverage-gaps-and-future-work",
    "href": "02_unit_tests.html#coverage-gaps-and-future-work",
    "title": "Unit Test Coverage",
    "section": "14. Coverage Gaps and Future Work",
    "text": "14. Coverage Gaps and Future Work\n\n14.1 Current Gaps\n\n\n\n\n\n\n\n\nArea\nGap\nPriority\n\n\n\n\nAFT + TVC\nLimited testing for AFT with time-varying covariates\nMedium\n\n\nPanel + Splines\nIntegration tests for spline hazards with panel data\nMedium\n\n\nEdge cases\nDegenerate transition matrices\nLow\n\n\nPerformance\nBenchmark regression tests\nLow\n\n\n\n\n\n14.2 Test Suite History\n\n\n\n\n\n\n\n\nDate\nAction\nResult\n\n\n\n\n2026-01-23\nMajor cleanup: consolidated/deleted redundant tests\n26 files, 2831 tests\n\n\n2026-01-22\nMerged variance and weight tests\nReduced redundancy\n\n\n2026-01-21\nMerged phase-type tests (7‚Üí2 files)\nConsolidated coverage\n\n\n2026-01\nAdded analytical likelihood tests\ntest_loglik_analytical.jl\n\n\n2026-01\nAdded penalty infrastructure tests\ntest_penalty_infrastructure.jl\n\n\n\n\n\n14.3 Deleted Test Files (Cleanup 2026-01-23)\nThe following files were deleted during test suite cleanup due to redundancy, obsolescence, or low value:\n\ntest_perf.jl - Hardware-dependent, moved to benchmarks\ntest_error_paths.jl - Redundant with test_error_messages.jl\ntest_infrastructure.jl - Tested internal implementation details\ntest_regressions.jl - Bug fixes now covered by other tests\ntest_modelgeneration.jl - Superseded by test_hazard_macro.jl\ntest_mll_consistency.jl - Superseded by test_loglik_analytical.jl\ntest_helpers.jl - Low value utility function tests\ntest_efs.jl - Outdated EDF implementation\ntest_reconstructor.jl - Internal ReConstructor tests\ntest_phasetype_*.jl (6 files) - Merged into test_phasetype.jl\ntest_pijcv_reference.jl, test_pijcv_vs_loocv.jl - Merged into test_pijcv.jl\ntest_constrained_variance.jl - Merged into test_variance.jl\ntest_observation_weights_emat.jl, test_weight_validation.jl - Merged into test_subject_weights.jl\ntest_concurrency.jl, test_ordering_at.jl - Stale APIs"
  },
  {
    "objectID": "02_unit_tests.html#running-tests",
    "href": "02_unit_tests.html#running-tests",
    "title": "Unit Test Coverage",
    "section": "15. Running Tests",
    "text": "15. Running Tests\n# Run all unit tests\njulia --project -e 'using Pkg; Pkg.test()'\n\n# Run specific test file (standalone - may need imports)\njulia --project -e 'using Test, MultistateModels; include(\"MultistateModelsTests/unit/test_hazards.jl\")'\n\n# Run with full long tests\nMSM_TEST_LEVEL=full julia --project -e 'using Pkg; Pkg.test()'"
  }
]