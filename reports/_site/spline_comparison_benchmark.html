<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-01-03">

<title>Spline Methods Comparison – MultistateModels Test Reports</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e34c512d8f599efa8461f365689868f8.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-3bbbbd466991e281563892c5dce73c3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MultistateModels Test Reports</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./architecture.html"> 
<span class="menu-text">Architecture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./unit_tests.html"> 
<span class="menu-text">Unit Tests</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./long_tests.html"> 
<span class="menu-text">Long Tests</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./simulation_diagnostics.html"> 
<span class="menu-text">Simulation</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-benchmarks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Benchmarks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-benchmarks">    
        <li>
    <a class="dropdown-item" href="./performance_benchmarks.html">
 <span class="dropdown-text">Performance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./spline_comparison_benchmark.html">
 <span class="dropdown-text">Spline Methods Comparison</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fintzij/MultistateModels.jl"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">Model Specification</a>
  <ul class="collapse">
  <li><a href="#illness-death-model" id="toc-illness-death-model" class="nav-link" data-scroll-target="#illness-death-model">Illness-Death Model</a></li>
  <li><a href="#true-hazard-functions" id="toc-true-hazard-functions" class="nav-link" data-scroll-target="#true-hazard-functions">True Hazard Functions</a></li>
  <li><a href="#transition-probability-matrix" id="toc-transition-probability-matrix" class="nav-link" data-scroll-target="#transition-probability-matrix">Transition Probability Matrix</a></li>
  <li><a href="#state-prevalence" id="toc-state-prevalence" class="nav-link" data-scroll-target="#state-prevalence">State Prevalence</a></li>
  <li><a href="#cumulative-incidence-functions" id="toc-cumulative-incidence-functions" class="nav-link" data-scroll-target="#cumulative-incidence-functions">Cumulative Incidence Functions</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#loading-simulated-data" id="toc-loading-simulated-data" class="nav-link" data-scroll-target="#loading-simulated-data">Loading Simulated Data</a></li>
  <li><a href="#data-summary" id="toc-data-summary" class="nav-link" data-scroll-target="#data-summary">Data Summary</a></li>
  <li><a href="#event-time-distribution" id="toc-event-time-distribution" class="nav-link" data-scroll-target="#event-time-distribution">Event Time Distribution</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#true-hazard-functions-1" id="toc-true-hazard-functions-1" class="nav-link" data-scroll-target="#true-hazard-functions-1">True Hazard Functions</a></li>
  <li><a href="#standardized-knot-placement" id="toc-standardized-knot-placement" class="nav-link" data-scroll-target="#standardized-knot-placement">Standardized Knot Placement</a></li>
  <li><a href="#method-1-pammtoolsmgcv-pam" id="toc-method-1-pammtoolsmgcv-pam" class="nav-link" data-scroll-target="#method-1-pammtoolsmgcv-pam">Method 1: pammtools/mgcv (PAM)</a></li>
  <li><a href="#method-2-flexsurv" id="toc-method-2-flexsurv" class="nav-link" data-scroll-target="#method-2-flexsurv">Method 2: flexsurv</a></li>
  <li><a href="#method-3-multistatemodels.jl-julia" id="toc-method-3-multistatemodels.jl-julia" class="nav-link" data-scroll-target="#method-3-multistatemodels.jl-julia">Method 3: MultistateModels.jl (Julia)</a></li>
  </ul></li>
  <li><a href="#hazard-estimation" id="toc-hazard-estimation" class="nav-link" data-scroll-target="#hazard-estimation">Hazard Estimation</a>
  <ul class="collapse">
  <li><a href="#predicted-hazards" id="toc-predicted-hazards" class="nav-link" data-scroll-target="#predicted-hazards">Predicted Hazards</a></li>
  <li><a href="#hazard-plots" id="toc-hazard-plots" class="nav-link" data-scroll-target="#hazard-plots">Hazard Plots</a></li>
  <li><a href="#hazard-rmse" id="toc-hazard-rmse" class="nav-link" data-scroll-target="#hazard-rmse">Hazard RMSE</a></li>
  </ul></li>
  <li><a href="#state-prevalence-1" id="toc-state-prevalence-1" class="nav-link" data-scroll-target="#state-prevalence-1">State Prevalence</a>
  <ul class="collapse">
  <li><a href="#computing-transition-probabilities" id="toc-computing-transition-probabilities" class="nav-link" data-scroll-target="#computing-transition-probabilities">Computing Transition Probabilities</a></li>
  <li><a href="#prevalence-plots" id="toc-prevalence-plots" class="nav-link" data-scroll-target="#prevalence-plots">Prevalence Plots</a></li>
  <li><a href="#prevalence-rmse" id="toc-prevalence-rmse" class="nav-link" data-scroll-target="#prevalence-rmse">Prevalence RMSE</a></li>
  </ul></li>
  <li><a href="#cumulative-incidence" id="toc-cumulative-incidence" class="nav-link" data-scroll-target="#cumulative-incidence">Cumulative Incidence</a>
  <ul class="collapse">
  <li><a href="#computing-cumulative-incidence" id="toc-computing-cumulative-incidence" class="nav-link" data-scroll-target="#computing-cumulative-incidence">Computing Cumulative Incidence</a></li>
  <li><a href="#cumulative-incidence-plots" id="toc-cumulative-incidence-plots" class="nav-link" data-scroll-target="#cumulative-incidence-plots">Cumulative Incidence Plots</a></li>
  <li><a href="#cumulative-incidence-rmse" id="toc-cumulative-incidence-rmse" class="nav-link" data-scroll-target="#cumulative-incidence-rmse">Cumulative Incidence RMSE</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#overall-comparison" id="toc-overall-comparison" class="nav-link" data-scroll-target="#overall-comparison">Overall Comparison</a></li>
  <li><a href="#computation-time" id="toc-computation-time" class="nav-link" data-scroll-target="#computation-time">Computation Time</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings</a></li>
  <li><a href="#recommendations" id="toc-recommendations" class="nav-link" data-scroll-target="#recommendations">Recommendations</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session Info</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/blob/main/spline_comparison_benchmark.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spline Methods Comparison</h1>
<p class="subtitle lead">Comparing MultistateModels.jl Splines vs pammtools/mgcv and flexsurv</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This report presents a comprehensive benchmark comparing three approaches for fitting flexible hazard models to multistate survival data:</p>
<ol type="1">
<li><strong>MultistateModels.jl</strong> (Julia): Joint likelihood estimation with natural cubic splines</li>
<li><strong>pammtools/mgcv</strong> (R): Piecewise-exponential additive models via GAM</li>
<li><strong>flexsurv</strong> (R): Flexible parametric survival models with spline hazards</li>
</ol>
<p>All methods are evaluated on the same simulated dataset generated using MultistateModels.jl.</p>
</section>
<section id="model-specification" class="level1">
<h1>Model Specification</h1>
<section id="illness-death-model" class="level2">
<h2 class="anchored" data-anchor-id="illness-death-model">Illness-Death Model</h2>
<p>We consider a three-state illness-death model without recovery:</p>
<ul>
<li><strong>State 1</strong>: Healthy (initial state)</li>
<li><strong>State 2</strong>: Illness (transient state)</li>
<li><strong>State 3</strong>: Death (absorbing state)</li>
</ul>
<p><strong>Transitions:</strong></p>
<ul>
<li><span class="math inline">\(1 \to 2\)</span>: Healthy to Illness (incidence)</li>
<li><span class="math inline">\(1 \to 3\)</span>: Healthy to Death (direct mortality)</li>
<li><span class="math inline">\(2 \to 3\)</span>: Illness to Death (disease-related mortality)</li>
</ul>
</section>
<section id="true-hazard-functions" class="level2">
<h2 class="anchored" data-anchor-id="true-hazard-functions">True Hazard Functions</h2>
<p>The data are simulated using Weibull hazard functions with the <strong>rate parameterization</strong>:</p>
<p><span class="math display">\[h_{rs}(t) = \kappa_{rs} \cdot \lambda_{rs} \cdot t^{\kappa_{rs} - 1}\]</span></p>
<p>where <span class="math inline">\(\kappa_{rs} &gt; 0\)</span> is the shape parameter and <span class="math inline">\(\lambda_{rs} &gt; 0\)</span> is the rate parameter.</p>
<p>The cumulative hazard is: <span class="math display">\[H_{rs}(t) = \lambda_{rs} \cdot t^{\kappa_{rs}}\]</span></p>
<p><strong>True Parameter Values:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 28%">
<col style="width: 28%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Transition</th>
<th>Shape (<span class="math inline">\(\kappa\)</span>)</th>
<th>Rate (<span class="math inline">\(\lambda\)</span>)</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(h_{12}\)</span> (Healthy to Illness)</td>
<td>1.3</td>
<td>0.04</td>
<td>Increasing hazard</td>
</tr>
<tr class="even">
<td><span class="math inline">\(h_{13}\)</span> (Healthy to Death)</td>
<td>1.2</td>
<td>0.015</td>
<td>Mildly increasing</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(h_{23}\)</span> (Illness to Death)</td>
<td>1.4</td>
<td>0.08</td>
<td>Higher mortality after illness</td>
</tr>
</tbody>
</table>
</section>
<section id="transition-probability-matrix" class="level2">
<h2 class="anchored" data-anchor-id="transition-probability-matrix">Transition Probability Matrix</h2>
<p>For a time-homogeneous Markov model, the transition probability matrix <span class="math inline">\(\mathbf{P}(s, t)\)</span> satisfies the Kolmogorov forward equation:</p>
<p><span class="math display">\[\frac{\partial}{\partial t}\mathbf{P}(s,t) = \mathbf{P}(s,t) \cdot \mathbf{Q}(t)\]</span></p>
<p>where <span class="math inline">\(\mathbf{Q}(t)\)</span> is the transition intensity (generator) matrix:</p>
<p><span class="math display">\[\mathbf{Q}(t) = \begin{pmatrix}
-(h_{12}(t) + h_{13}(t)) &amp; h_{12}(t) &amp; h_{13}(t) \\
0 &amp; -h_{23}(t) &amp; h_{23}(t) \\
0 &amp; 0 &amp; 0
\end{pmatrix}\]</span></p>
<p>The solution is computed via the <strong>product integral</strong>: <span class="math display">\[\mathbf{P}(0, t) = \prod_{s=0}^{t} \exp\left(\mathbf{Q}(s) ds\right)\]</span></p>
</section>
<section id="state-prevalence" class="level2">
<h2 class="anchored" data-anchor-id="state-prevalence">State Prevalence</h2>
<p>State prevalence at time <span class="math inline">\(t\)</span> for subjects starting in state 1:</p>
<ul>
<li><span class="math inline">\(P_1(t) = P_{11}(0, t)\)</span> - Probability of remaining healthy</li>
<li><span class="math inline">\(P_2(t) = P_{12}(0, t)\)</span> - Probability of being in illness state</li>
<li><span class="math inline">\(P_3(t) = P_{13}(0, t)\)</span> - Probability of having died</li>
</ul>
</section>
<section id="cumulative-incidence-functions" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-incidence-functions">Cumulative Incidence Functions</h2>
<p>The cause-specific cumulative incidence function for transition <span class="math inline">\(1 \to r\)</span> is:</p>
<p><span class="math display">\[F_{1r}(t) = \int_0^t P_{11}(0, s) \cdot h_{1r}(s) \, ds\]</span></p>
<p>This represents the probability of experiencing transition <span class="math inline">\(1 \to r\)</span> by time <span class="math inline">\(t\)</span>.</p>
</section>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<section id="loading-simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-simulated-data">Loading Simulated Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data generated by MultistateModels.jl</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_path <span class="ot">&lt;-</span> <span class="st">"../fixtures/illness_death_data.csv"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>meta_path <span class="ot">&lt;-</span> <span class="st">"../fixtures/illness_death_metadata.json"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(data_path)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(meta_path)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Display metadata</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sample Size:"</span>, meta<span class="sc">$</span>n_subjects, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Sample Size: 1000 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Maximum Follow-up Time:"</span>, meta<span class="sc">$</span>max_time, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Follow-up Time: 20 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">True Parameters:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
True Parameters:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h12: shape ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h12<span class="sc">$</span>shape, <span class="st">", rate ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h12<span class="sc">$</span>rate, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h12: shape = 1.3 , rate = 0.04 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h13: shape ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h13<span class="sc">$</span>shape, <span class="st">", rate ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h13<span class="sc">$</span>rate, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h13: shape = 1.2 , rate = 0.015 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h23: shape ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h23<span class="sc">$</span>shape, <span class="st">", rate ="</span>, meta<span class="sc">$</span>true_params<span class="sc">$</span>h23<span class="sc">$</span>rate, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h23: shape = 1.4 , rate = 0.08 </code></pre>
</div>
</div>
</section>
<section id="data-summary" class="level2">
<h2 class="anchored" data-anchor-id="data-summary">Data Summary</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition counts</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>trans_counts <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(from, to) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transition =</span> <span class="fu">paste0</span>(from, <span class="st">" -&gt; "</span>, to))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(trans_counts, <span class="at">caption =</span> <span class="st">"Observed Transition Counts"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Observed Transition Counts</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">from</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">to</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">transition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">711</td>
<td style="text-align: left;">1 -&gt; 2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">215</td>
<td style="text-align: left;">1 -&gt; 3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">595</td>
<td style="text-align: left;">2 -&gt; 3</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Final state distribution</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>final_states <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(to) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      to <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Healthy"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      to <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Illness"</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      to <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Death"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">1</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(final_states, <span class="at">caption =</span> <span class="st">"Final State Distribution"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Final State Distribution</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">to</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">n</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state_name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">74</td>
<td style="text-align: left;">Healthy</td>
<td style="text-align: right;">7.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">116</td>
<td style="text-align: left;">Illness</td>
<td style="text-align: right;">11.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">810</td>
<td style="text-align: left;">Death</td>
<td style="text-align: right;">81.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="event-time-distribution" class="level2">
<h2 class="anchored" data-anchor-id="event-time-distribution">Event Time Distribution</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot event time distributions</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>events <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transition =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(from, <span class="st">" -&gt; "</span>, to),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1 -&gt; 2"</span>, <span class="st">"1 -&gt; 3"</span>, <span class="st">"2 -&gt; 3"</span>)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(events, <span class="fu">aes</span>(<span class="at">x =</span> tstop)) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> transition, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Event Times by Transition"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="spline_comparison_benchmark_files/figure-html/event-times-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="true-hazard-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="true-hazard-functions-1">True Hazard Functions</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define true hazard functions</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>true_hazard <span class="ot">&lt;-</span> <span class="cf">function</span>(t, shape, rate) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  shape <span class="sc">*</span> rate <span class="sc">*</span> t<span class="sc">^</span>(shape <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>true_cumhaz <span class="ot">&lt;-</span> <span class="cf">function</span>(t, shape, rate) {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  rate <span class="sc">*</span> t<span class="sc">^</span>shape</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># True hazards</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>h12_true <span class="ot">&lt;-</span> <span class="cf">function</span>(t) <span class="fu">true_hazard</span>(t, meta<span class="sc">$</span>true_params<span class="sc">$</span>h12<span class="sc">$</span>shape, meta<span class="sc">$</span>true_params<span class="sc">$</span>h12<span class="sc">$</span>rate)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>h13_true <span class="ot">&lt;-</span> <span class="cf">function</span>(t) <span class="fu">true_hazard</span>(t, meta<span class="sc">$</span>true_params<span class="sc">$</span>h13<span class="sc">$</span>shape, meta<span class="sc">$</span>true_params<span class="sc">$</span>h13<span class="sc">$</span>rate)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>h23_true <span class="ot">&lt;-</span> <span class="cf">function</span>(t) <span class="fu">true_hazard</span>(t, meta<span class="sc">$</span>true_params<span class="sc">$</span>h23<span class="sc">$</span>shape, meta<span class="sc">$</span>true_params<span class="sc">$</span>h23<span class="sc">$</span>rate)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="standardized-knot-placement" class="level2">
<h2 class="anchored" data-anchor-id="standardized-knot-placement">Standardized Knot Placement</h2>
<p>All three methods use the <strong>same interior knots</strong>: 9 knots placed at the decile quantiles (0.1, 0.2, …, 0.9) of the observed event times from the simulation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Julia results early to get standardized knots</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>julia_results <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"../fixtures/illness_death_results.json"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the standardized interior knots from Julia fit</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>interior_knots <span class="ot">&lt;-</span> julia_results<span class="sc">$</span>julia_fit<span class="sc">$</span>interior_knots</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>n_interior_knots <span class="ot">&lt;-</span> <span class="fu">length</span>(interior_knots)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Boundary knots (min and max event times)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>event_times <span class="ot">&lt;-</span> dat<span class="sc">$</span>tstop[dat<span class="sc">$</span>status <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>boundary_knots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(event_times), <span class="fu">max</span>(event_times))</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Standardized Knot Specification:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Standardized Knot Specification:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Number of interior knots:"</span>, n_interior_knots, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Number of interior knots: 9 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Interior knots (decile quantiles):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Interior knots (decile quantiles):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(interior_knots)) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"    Q%d: %.3f</span><span class="sc">\n</span><span class="st">"</span>, i <span class="sc">*</span> <span class="dv">10</span>, interior_knots[i]))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Q10: 2.196
    Q20: 3.972
    Q30: 5.714
    Q40: 7.094
    Q50: 8.695
    Q60: 10.289
    Q70: 11.994
    Q80: 13.923
    Q90: 16.380</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Boundary knots:"</span>, <span class="fu">round</span>(boundary_knots, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Boundary knots: 0.018 19.979 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Total spline df:"</span>, n_interior_knots <span class="sc">+</span> <span class="dv">2</span>, <span class="st">"(interior + 2 for natural spline)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Total spline df: 11 (interior + 2 for natural spline)</code></pre>
</div>
</div>
</section>
<section id="method-1-pammtoolsmgcv-pam" class="level2">
<h2 class="anchored" data-anchor-id="method-1-pammtoolsmgcv-pam">Method 1: pammtools/mgcv (PAM)</h2>
<p>The piecewise-exponential additive model (PAM) transforms survival data into a Poisson regression framework. Following Bender et al.&nbsp;(2018) and the pammtools documentation:</p>
<p><strong>Data Transformation:</strong></p>
<ol type="1">
<li>Split follow-up time into intervals using a set of cut points</li>
<li>For each subject-interval combination, create a pseudo-observation with:
<ul>
<li>Exposure time (offset): <span class="math inline">\(\log(\text{time at risk in interval})\)</span></li>
<li>Event indicator: 1 if event occurred in interval, 0 otherwise</li>
</ul></li>
</ol>
<p><strong>Model:</strong></p>
<p><span class="math display">\[\log(E[d_{ij}]) = \log(t_{ij}) + f(t_j) + \mathbf{x}_i'\boldsymbol{\beta}\]</span></p>
<p>where <span class="math inline">\(d_{ij}\)</span> is the event indicator for subject <span class="math inline">\(i\)</span> in interval <span class="math inline">\(j\)</span>, <span class="math inline">\(t_{ij}\)</span> is the exposure time, and <span class="math inline">\(f(t)\)</span> is a smooth function of time.</p>
<p><strong>Spline specification:</strong> We use a cubic regression spline with the <strong>same knots</strong> as Julia. The <code>mgcv::gam</code> function uses penalized splines, but we fix the knot locations to match.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create cut points for PAM</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>n_intervals <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>max_t <span class="ot">&lt;-</span> <span class="fu">max</span>(dat<span class="sc">$</span>tstop)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cut_points <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_t <span class="sc">*</span> <span class="fl">1.01</span>, <span class="at">length.out =</span> n_intervals <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create PAM data for a specific transition</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>create_pam_data <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, from_state, to_state, cuts) {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to subjects at risk from this state</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  trans_dat <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>from <span class="sc">==</span> from_state, ]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  pam_rows <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(trans_dat)) {</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> trans_dat[i, ]</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    t_start <span class="ot">&lt;-</span> row<span class="sc">$</span>tstart</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    t_end <span class="ot">&lt;-</span> row<span class="sc">$</span>tstop</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    is_event <span class="ot">&lt;-</span> (row<span class="sc">$</span>status <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;&amp;</span> (row<span class="sc">$</span>to <span class="sc">==</span> to_state)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(cuts)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      int_start <span class="ot">&lt;-</span> cuts[j]</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      int_end <span class="ot">&lt;-</span> cuts[j<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (int_end <span class="sc">&lt;=</span> t_start) <span class="cf">next</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (int_start <span class="sc">&gt;=</span> t_end) <span class="cf">break</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>      risk_start <span class="ot">&lt;-</span> <span class="fu">max</span>(int_start, t_start)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>      risk_end <span class="ot">&lt;-</span> <span class="fu">min</span>(int_end, t_end)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>      offset_val <span class="ot">&lt;-</span> <span class="fu">log</span>(risk_end <span class="sc">-</span> risk_start)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>      event_in_interval <span class="ot">&lt;-</span> is_event <span class="sc">&amp;&amp;</span> (t_end <span class="sc">&lt;=</span> int_end) <span class="sc">&amp;&amp;</span> (t_end <span class="sc">&gt;</span> int_start)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>      pam_rows[[<span class="fu">length</span>(pam_rows) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> row<span class="sc">$</span>id,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">interval =</span> j,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">t_mid =</span> (risk_start <span class="sc">+</span> risk_end) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">t_start =</span> risk_start,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">t_end =</span> risk_end,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">offset =</span> offset_val,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">event =</span> <span class="fu">as.integer</span>(event_in_interval)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(rbind, pam_rows)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Create PAM datasets</span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>pam_12 <span class="ot">&lt;-</span> <span class="fu">create_pam_data</span>(dat, <span class="dv">1</span>, <span class="dv">2</span>, cut_points)</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>pam_13 <span class="ot">&lt;-</span> <span class="fu">create_pam_data</span>(dat, <span class="dv">1</span>, <span class="dv">3</span>, cut_points)</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>pam_23 <span class="ot">&lt;-</span> <span class="fu">create_pam_data</span>(dat, <span class="dv">2</span>, <span class="dv">3</span>, cut_points)</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PAM Data Created:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>PAM Data Created:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 1-&gt;2:"</span>, <span class="fu">nrow</span>(pam_12), <span class="st">"rows,"</span>, <span class="fu">sum</span>(pam_12<span class="sc">$</span>event), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 1-&gt;2: 13011 rows, 711 events</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 1-&gt;3:"</span>, <span class="fu">nrow</span>(pam_13), <span class="st">"rows,"</span>, <span class="fu">sum</span>(pam_13<span class="sc">$</span>event), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 1-&gt;3: 13011 rows, 215 events</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 2-&gt;3:"</span>, <span class="fu">nrow</span>(pam_23), <span class="st">"rows,"</span>, <span class="fu">sum</span>(pam_23<span class="sc">$</span>event), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 2-&gt;3: 6004 rows, 595 events</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GAM models using cubic regression splines with FIXED knot locations</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to match Julia's specification exactly</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>t_start_pam <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For mgcv with bs="cr" (cubic regression spline):</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># When supplying knots, k = number of knots supplied</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The knots argument specifies ALL knots (not just interior)</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>k_mgcv <span class="ot">&lt;-</span> n_interior_knots</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>fit_pam_12 <span class="ot">&lt;-</span> <span class="fu">gam</span>(event <span class="sc">~</span> <span class="fu">s</span>(t_mid, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> k_mgcv), </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">poisson</span>(), </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">offset =</span> offset,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pam_12,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">knots =</span> <span class="fu">list</span>(<span class="at">t_mid =</span> interior_knots),</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>fit_pam_13 <span class="ot">&lt;-</span> <span class="fu">gam</span>(event <span class="sc">~</span> <span class="fu">s</span>(t_mid, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> k_mgcv), </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">poisson</span>(), </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">offset =</span> offset,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pam_13,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">knots =</span> <span class="fu">list</span>(<span class="at">t_mid =</span> interior_knots),</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>fit_pam_23 <span class="ot">&lt;-</span> <span class="fu">gam</span>(event <span class="sc">~</span> <span class="fu">s</span>(t_mid, <span class="at">bs =</span> <span class="st">"cr"</span>, <span class="at">k =</span> k_mgcv), </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">poisson</span>(), </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">offset =</span> offset,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pam_23,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">knots =</span> <span class="fu">list</span>(<span class="at">t_mid =</span> interior_knots),</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>t_pam <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> t_start_pam, <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PAM Fit Time:"</span>, <span class="fu">round</span>(t_pam, <span class="dv">2</span>), <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>PAM Fit Time: 0.42 seconds</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Effective Degrees of Freedom (after penalization):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Effective Degrees of Freedom (after penalization):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h12:"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(fit_pam_12<span class="sc">$</span>edf), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h12: 3.1 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h13:"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(fit_pam_13<span class="sc">$</span>edf), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h13: 2 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  h23:"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(fit_pam_23<span class="sc">$</span>edf), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  h23: 3.8 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Knots used by mgcv:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Knots used by mgcv:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Interior knots:"</span>, <span class="fu">round</span>(interior_knots, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Interior knots: 2.196 3.972 5.714 7.094 8.695 10.289 11.994 13.923 16.38 </code></pre>
</div>
</div>
</section>
<section id="method-2-flexsurv" class="level2">
<h2 class="anchored" data-anchor-id="method-2-flexsurv">Method 2: flexsurv</h2>
<p>The flexsurv package implements flexible parametric survival models using cubic splines on the log cumulative hazard or log hazard scale (Royston-Parmar models).</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for flexsurv (one row per transition)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For multistate models, we need to create separate datasets</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 1-&gt;2: at risk while in state 1, event if goes to state 2</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>flex_12 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> tstop <span class="sc">-</span> tstart,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">as.integer</span>(status <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> to <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, time, status)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 1-&gt;3: at risk while in state 1, event if goes to state 3  </span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>flex_13 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> tstop <span class="sc">-</span> tstart,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">as.integer</span>(status <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> to <span class="sc">==</span> <span class="dv">3</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, time, status)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Transition 2-&gt;3: at risk while in state 2, event if goes to state 3</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>flex_23 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> tstop <span class="sc">-</span> tstart,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">as.integer</span>(status <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> to <span class="sc">==</span> <span class="dv">3</span>)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, time, status)</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"flexsurv Data:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>flexsurv Data:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 1-&gt;2:"</span>, <span class="fu">nrow</span>(flex_12), <span class="st">"observations,"</span>, <span class="fu">sum</span>(flex_12<span class="sc">$</span>status), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 1-&gt;2: 1000 observations, 711 events</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 1-&gt;3:"</span>, <span class="fu">nrow</span>(flex_13), <span class="st">"observations,"</span>, <span class="fu">sum</span>(flex_13<span class="sc">$</span>status), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 1-&gt;3: 1000 observations, 215 events</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Transition 2-&gt;3:"</span>, <span class="fu">nrow</span>(flex_23), <span class="st">"observations,"</span>, <span class="fu">sum</span>(flex_23<span class="sc">$</span>status), <span class="st">"events</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Transition 2-&gt;3: 711 observations, 595 events</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit flexible parametric models with splines on log cumulative hazard</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using FIXED knot locations to match Julia's specification</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># flexsurv places knots on the LOG time scale</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># It automatically adds boundary knots at min and max event times</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to specify internal knots on log scale</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>log_interior_knots <span class="ot">&lt;-</span> <span class="fu">log</span>(interior_knots)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>t_start_flex <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>fit_flex_12 <span class="ot">&lt;-</span> <span class="fu">flexsurvspline</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> flex_12, </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">knots =</span> log_interior_knots,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">scale =</span> <span class="st">"hazard"</span>)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>fit_flex_13 <span class="ot">&lt;-</span> <span class="fu">flexsurvspline</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> flex_13, </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">knots =</span> log_interior_knots,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>                               <span class="at">scale =</span> <span class="st">"hazard"</span>)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>fit_flex_23 <span class="ot">&lt;-</span> <span class="fu">flexsurvspline</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> flex_23, </span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>                               <span class="at">knots =</span> log_interior_knots,</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>                               <span class="at">scale =</span> <span class="st">"hazard"</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>t_flex <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> t_start_flex, <span class="at">units =</span> <span class="st">"secs"</span>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"flexsurv Fit Time:"</span>, <span class="fu">round</span>(t_flex, <span class="dv">2</span>), <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>flexsurv Fit Time: 0.71 seconds</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Interior knots (original scale):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Interior knots (original scale):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  "</span>, <span class="fu">round</span>(interior_knots, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   2.196 3.972 5.714 7.094 8.695 10.289 11.994 13.923 16.38 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Interior knots (log scale for flexsurv):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Interior knots (log scale for flexsurv):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  "</span>, <span class="fu">round</span>(log_interior_knots, <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   0.787 1.379 1.743 1.959 2.163 2.331 2.484 2.634 2.796 </code></pre>
</div>
</div>
</section>
<section id="method-3-multistatemodels.jl-julia" class="level2">
<h2 class="anchored" data-anchor-id="method-3-multistatemodels.jl-julia">Method 3: MultistateModels.jl (Julia)</h2>
<p>MultistateModels.jl fits all transition hazards jointly via maximum likelihood with natural cubic spline baseline hazards. Results are loaded from pre-computed fits.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Julia predictions (julia_results already loaded in knot-setup chunk)</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>julia_pred <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"../fixtures/illness_death_julia_predictions.json"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Julia Fit Time:"</span>, <span class="fu">round</span>(julia_results<span class="sc">$</span>julia_fit<span class="sc">$</span>fit_time_seconds, <span class="dv">2</span>), <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Julia Fit Time: 13.22 seconds</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Interior Knots:"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(julia_results<span class="sc">$</span>julia_fit<span class="sc">$</span>interior_knots, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Interior Knots: 2.2, 3.97, 5.71, 7.09, 8.69, 10.29, 11.99, 13.92, 16.38 </code></pre>
</div>
</div>
</section>
</section>
<section id="hazard-estimation" class="level1">
<h1>Hazard Estimation</h1>
<section id="predicted-hazards" class="level2">
<h2 class="anchored" data-anchor-id="predicted-hazards">Predicted Hazards</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation times</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>eval_times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># True hazards</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>h12_true_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(eval_times, h12_true)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>h13_true_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(eval_times, h13_true)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>h23_true_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(eval_times, h23_true)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># PAM predictions</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">t_mid =</span> eval_times, <span class="at">offset =</span> <span class="dv">0</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>h12_pam <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">predict</span>(fit_pam_12, <span class="at">newdata =</span> pred_data, <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>h13_pam <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">predict</span>(fit_pam_13, <span class="at">newdata =</span> pred_data, <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>h23_pam <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">predict</span>(fit_pam_23, <span class="at">newdata =</span> pred_data, <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co"># flexsurv predictions</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>h12_flex <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_flex_12, <span class="at">t =</span> eval_times, <span class="at">type =</span> <span class="st">"hazard"</span>)[[<span class="dv">1</span>]]<span class="sc">$</span>est</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>h13_flex <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_flex_13, <span class="at">t =</span> eval_times, <span class="at">type =</span> <span class="st">"hazard"</span>)[[<span class="dv">1</span>]]<span class="sc">$</span>est</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>h23_flex <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit_flex_23, <span class="at">t =</span> eval_times, <span class="at">type =</span> <span class="st">"hazard"</span>)[[<span class="dv">1</span>]]<span class="sc">$</span>est</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Julia predictions (from loaded file)</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>h12_julia <span class="ot">&lt;-</span> julia_pred<span class="sc">$</span>hazards<span class="sc">$</span>h12_julia</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>h13_julia <span class="ot">&lt;-</span> julia_pred<span class="sc">$</span>hazards<span class="sc">$</span>h13_julia</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>h23_julia <span class="ot">&lt;-</span> julia_pred<span class="sc">$</span>hazards<span class="sc">$</span>h23_julia</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into data frame</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>hazard_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">rep</span>(eval_times, <span class="dv">12</span>),</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">hazard =</span> <span class="fu">c</span>(h12_true_vec, h12_julia, h12_pam, h12_flex,</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>             h13_true_vec, h13_julia, h13_pam, h13_flex,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>             h23_true_vec, h23_julia, h23_pam, h23_flex),</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"True"</span>, <span class="st">"Julia"</span>, <span class="st">"PAM (mgcv)"</span>, <span class="st">"flexsurv"</span>), <span class="at">each =</span> <span class="fu">length</span>(eval_times)), <span class="dv">3</span>),</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">transition =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"h12 (Healthy -&gt; Illness)"</span>, </span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"h13 (Healthy -&gt; Death)"</span>,</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"h23 (Illness -&gt; Death)"</span>), <span class="at">each =</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">length</span>(eval_times))</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="hazard-plots" class="level2">
<h2 class="anchored" data-anchor-id="hazard-plots">Hazard Plots</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hazard_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> hazard, <span class="at">color =</span> method, <span class="at">linetype =</span> method)) <span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"dotted"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"twodash"</span>)) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> transition, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Estimated vs True Hazard Functions"</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Hazard Rate h(t)"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Method"</span>,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"Method"</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="spline_comparison_benchmark_files/figure-html/hazard-plots-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hazard-rmse" class="level2">
<h2 class="anchored" data-anchor-id="hazard-rmse">Hazard RMSE</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">sqrt</span>(<span class="fu">mean</span>((a <span class="sc">-</span> b)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>hazard_rmse <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Transition =</span> <span class="fu">c</span>(<span class="st">"h12"</span>, <span class="st">"h13"</span>, <span class="st">"h23"</span>),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Julia =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(h12_julia, h12_true_vec),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(h13_julia, h13_true_vec),</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(h23_julia, h23_true_vec)),</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAM_mgcv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(h12_pam, h12_true_vec),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(h13_pam, h13_true_vec),</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(h23_pam, h23_true_vec)),</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">flexsurv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(h12_flex, h12_true_vec),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(h13_flex, h13_true_vec),</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(h23_flex, h23_true_vec))</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(hazard_rmse, <span class="at">digits =</span> <span class="dv">5</span>, </span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Hazard RMSE (vs True)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Hazard RMSE (vs True)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Transition</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Julia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PAM_mgcv</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">flexsurv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">h12</td>
<td style="text-align: right;">0.01358</td>
<td style="text-align: right;">0.00645</td>
<td style="text-align: right;">0.00998</td>
</tr>
<tr class="even">
<td style="text-align: left;">h13</td>
<td style="text-align: right;">0.00429</td>
<td style="text-align: right;">0.00163</td>
<td style="text-align: right;">0.00491</td>
</tr>
<tr class="odd">
<td style="text-align: left;">h23</td>
<td style="text-align: right;">0.13832</td>
<td style="text-align: right;">0.11949</td>
<td style="text-align: right;">0.22306</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="state-prevalence-1" class="level1">
<h1>State Prevalence</h1>
<section id="computing-transition-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="computing-transition-probabilities">Computing Transition Probabilities</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute transition probability matrix via product integral</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>compute_tpm <span class="ot">&lt;-</span> <span class="cf">function</span>(t, h12_fn, h13_fn, h23_fn, <span class="at">dt =</span> <span class="fl">0.01</span>) {</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="fu">diag</span>(<span class="dv">3</span>))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  n_steps <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">ceiling</span>(t <span class="sc">/</span> dt))</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  actual_dt <span class="ot">&lt;-</span> t <span class="sc">/</span> n_steps</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">3</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> actual_dt</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    h12 <span class="ot">&lt;-</span> <span class="fu">h12_fn</span>(s)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    h13 <span class="ot">&lt;-</span> <span class="fu">h13_fn</span>(s)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    h23 <span class="ot">&lt;-</span> <span class="fu">h23_fn</span>(s)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span>(h12 <span class="sc">+</span> h13), h12, h13,</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">0</span>, <span class="sc">-</span>h23, h23,</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    dP <span class="ot">&lt;-</span> <span class="fu">expm</span>(Q <span class="sc">*</span> actual_dt)</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    P <span class="ot">&lt;-</span> P <span class="sc">%*%</span> dP</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(P)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interpolation functions for each method</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>make_interp <span class="ot">&lt;-</span> <span class="cf">function</span>(times, values) {</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">approxfun</span>(times, values, <span class="at">rule =</span> <span class="dv">2</span>)</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>h12_pam_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h12_pam)</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>h13_pam_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h13_pam)</span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>h23_pam_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h23_pam)</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>h12_flex_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h12_flex)</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>h13_flex_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h13_flex)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>h23_flex_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h23_flex)</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>h12_julia_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h12_julia)</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>h13_julia_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h13_julia)</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>h23_julia_fn <span class="ot">&lt;-</span> <span class="fu">make_interp</span>(eval_times, h23_julia)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute state prevalence for each method</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>prev_true <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(eval_times), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>prev_julia <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(eval_times), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>prev_pam <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(eval_times), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>prev_flex <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(eval_times), <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(eval_times)) {</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> eval_times[i]</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  P_true <span class="ot">&lt;-</span> <span class="fu">compute_tpm</span>(t, h12_true, h13_true, h23_true)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  prev_true[i, ] <span class="ot">&lt;-</span> P_true[<span class="dv">1</span>, ]</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  P_julia <span class="ot">&lt;-</span> <span class="fu">compute_tpm</span>(t, h12_julia_fn, h13_julia_fn, h23_julia_fn)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  prev_julia[i, ] <span class="ot">&lt;-</span> P_julia[<span class="dv">1</span>, ]</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  P_pam <span class="ot">&lt;-</span> <span class="fu">compute_tpm</span>(t, h12_pam_fn, h13_pam_fn, h23_pam_fn)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  prev_pam[i, ] <span class="ot">&lt;-</span> P_pam[<span class="dv">1</span>, ]</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  P_flex <span class="ot">&lt;-</span> <span class="fu">compute_tpm</span>(t, h12_flex_fn, h13_flex_fn, h23_flex_fn)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  prev_flex[i, ] <span class="ot">&lt;-</span> P_flex[<span class="dv">1</span>, ]</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Empirical prevalence from data</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>prev_emp <span class="ot">&lt;-</span> julia_results<span class="sc">$</span>empirical</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="prevalence-plots" class="level2">
<h2 class="anchored" data-anchor-id="prevalence-plots">Prevalence Plots</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>prev_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">rep</span>(eval_times, <span class="dv">15</span>),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prevalence =</span> <span class="fu">c</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    prev_true[,<span class="dv">1</span>], prev_julia[,<span class="dv">1</span>], prev_pam[,<span class="dv">1</span>], prev_flex[,<span class="dv">1</span>], prev_emp<span class="sc">$</span>prevalence_healthy,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    prev_true[,<span class="dv">2</span>], prev_julia[,<span class="dv">2</span>], prev_pam[,<span class="dv">2</span>], prev_flex[,<span class="dv">2</span>], prev_emp<span class="sc">$</span>prevalence_illness,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    prev_true[,<span class="dv">3</span>], prev_julia[,<span class="dv">3</span>], prev_pam[,<span class="dv">3</span>], prev_flex[,<span class="dv">3</span>], prev_emp<span class="sc">$</span>prevalence_death</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"True"</span>, <span class="st">"Julia"</span>, <span class="st">"PAM (mgcv)"</span>, <span class="st">"flexsurv"</span>, <span class="st">"Empirical"</span>), </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">each =</span> <span class="fu">length</span>(eval_times)), <span class="dv">3</span>),</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"P1(t): Healthy"</span>, <span class="st">"P2(t): Illness"</span>, <span class="st">"P3(t): Death"</span>), </span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">each =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="fu">length</span>(eval_times))</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prev_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> prevalence, <span class="at">color =</span> method, <span class="at">linetype =</span> method)) <span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, </span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Empirical"</span> <span class="ot">=</span> <span class="st">"grey50"</span>)) <span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, </span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"dotted"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"twodash"</span>,</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Empirical"</span> <span class="ot">=</span> <span class="st">"dotdash"</span>)) <span class="sc">+</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"State Prevalence: Estimated vs True"</span>,</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Starting from State 1 (Healthy)"</span>,</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Probability"</span>,</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Method"</span>,</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"Method"</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="spline_comparison_benchmark_files/figure-html/prevalence-plots-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prevalence-rmse" class="level2">
<h2 class="anchored" data-anchor-id="prevalence-rmse">Prevalence RMSE</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>prev_rmse <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">State =</span> <span class="fu">c</span>(<span class="st">"P1 (Healthy)"</span>, <span class="st">"P2 (Illness)"</span>, <span class="st">"P3 (Death)"</span>),</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Empirical =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(prev_true[,<span class="dv">1</span>], prev_emp<span class="sc">$</span>prevalence_healthy),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rmse</span>(prev_true[,<span class="dv">2</span>], prev_emp<span class="sc">$</span>prevalence_illness),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">rmse</span>(prev_true[,<span class="dv">3</span>], prev_emp<span class="sc">$</span>prevalence_death)),</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Julia =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(prev_true[,<span class="dv">1</span>], prev_julia[,<span class="dv">1</span>]),</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(prev_true[,<span class="dv">2</span>], prev_julia[,<span class="dv">2</span>]),</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(prev_true[,<span class="dv">3</span>], prev_julia[,<span class="dv">3</span>])),</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAM_mgcv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(prev_true[,<span class="dv">1</span>], prev_pam[,<span class="dv">1</span>]),</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(prev_true[,<span class="dv">2</span>], prev_pam[,<span class="dv">2</span>]),</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(prev_true[,<span class="dv">3</span>], prev_pam[,<span class="dv">3</span>])),</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flexsurv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(prev_true[,<span class="dv">1</span>], prev_flex[,<span class="dv">1</span>]),</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(prev_true[,<span class="dv">2</span>], prev_flex[,<span class="dv">2</span>]),</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(prev_true[,<span class="dv">3</span>], prev_flex[,<span class="dv">3</span>]))</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(prev_rmse, <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"State Prevalence RMSE (vs True)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>State Prevalence RMSE (vs True)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Empirical</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Julia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PAM_mgcv</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">flexsurv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">P1 (Healthy)</td>
<td style="text-align: right;">0.00839</td>
<td style="text-align: right;">0.00790</td>
<td style="text-align: right;">0.01080</td>
<td style="text-align: right;">0.00803</td>
</tr>
<tr class="even">
<td style="text-align: left;">P2 (Illness)</td>
<td style="text-align: right;">0.06081</td>
<td style="text-align: right;">0.01633</td>
<td style="text-align: right;">0.05858</td>
<td style="text-align: right;">0.01752</td>
</tr>
<tr class="odd">
<td style="text-align: left;">P3 (Death)</td>
<td style="text-align: right;">0.05591</td>
<td style="text-align: right;">0.02269</td>
<td style="text-align: right;">0.05474</td>
<td style="text-align: right;">0.02337</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="cumulative-incidence" class="level1">
<h1>Cumulative Incidence</h1>
<section id="computing-cumulative-incidence" class="level2">
<h2 class="anchored" data-anchor-id="computing-cumulative-incidence">Computing Cumulative Incidence</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute cause-specific cumulative incidence</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># CI_1r(t) = integral_0^t P11(s) * h1r(s) ds</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>compute_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(times, h_fn, h12_all_fn, h13_all_fn, h23_all_fn, <span class="at">dt =</span> <span class="fl">0.05</span>) {</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(times))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(times)) {</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    t <span class="ot">&lt;-</span> times[i]</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>      ci[i] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    n_steps <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">ceiling</span>(t <span class="sc">/</span> dt))</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    actual_dt <span class="ot">&lt;-</span> t <span class="sc">/</span> n_steps</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    integral <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>      s <span class="ot">&lt;-</span> (j <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> actual_dt</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> <span class="fu">compute_tpm</span>(s, h12_all_fn, h13_all_fn, h23_all_fn, <span class="at">dt =</span> <span class="fl">0.05</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>      P11 <span class="ot">&lt;-</span> P[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>      h <span class="ot">&lt;-</span> <span class="fu">h_fn</span>(s)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>      integral <span class="ot">&lt;-</span> integral <span class="sc">+</span> P11 <span class="sc">*</span> h <span class="sc">*</span> actual_dt</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    ci[i] <span class="ot">&lt;-</span> integral</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ci)</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># True cumulative incidence</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>ci_12_true <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h12_true, h12_true, h13_true, h23_true)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ci_13_true <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h13_true, h12_true, h13_true, h23_true)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Julia CI</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>ci_12_julia <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h12_julia_fn, h12_julia_fn, h13_julia_fn, h23_julia_fn)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>ci_13_julia <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h13_julia_fn, h12_julia_fn, h13_julia_fn, h23_julia_fn)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># PAM CI</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>ci_12_pam <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h12_pam_fn, h12_pam_fn, h13_pam_fn, h23_pam_fn)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>ci_13_pam <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h13_pam_fn, h12_pam_fn, h13_pam_fn, h23_pam_fn)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co"># flexsurv CI</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>ci_12_flex <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h12_flex_fn, h12_flex_fn, h13_flex_fn, h23_flex_fn)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>ci_13_flex <span class="ot">&lt;-</span> <span class="fu">compute_ci</span>(eval_times, h13_flex_fn, h12_flex_fn, h13_flex_fn, h23_flex_fn)</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Total death CI = P(state 3)</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>ci_death_true <span class="ot">&lt;-</span> prev_true[, <span class="dv">3</span>]</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>ci_death_julia <span class="ot">&lt;-</span> prev_julia[, <span class="dv">3</span>]</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>ci_death_pam <span class="ot">&lt;-</span> prev_pam[, <span class="dv">3</span>]</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>ci_death_flex <span class="ot">&lt;-</span> prev_flex[, <span class="dv">3</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="cumulative-incidence-plots" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-incidence-plots">Cumulative Incidence Plots</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">rep</span>(eval_times, <span class="dv">12</span>),</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="fu">c</span>(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    ci_12_true, ci_12_julia, ci_12_pam, ci_12_flex,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    ci_13_true, ci_13_julia, ci_13_pam, ci_13_flex,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    ci_death_true, ci_death_julia, ci_death_pam, ci_death_flex</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"True"</span>, <span class="st">"Julia"</span>, <span class="st">"PAM (mgcv)"</span>, <span class="st">"flexsurv"</span>), <span class="at">each =</span> <span class="fu">length</span>(eval_times)), <span class="dv">3</span>),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">event =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"CI12: Illness"</span>, <span class="st">"CI13: Direct Death"</span>, <span class="st">"CI Total Death"</span>), </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">each =</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">length</span>(eval_times))</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ci_df, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> ci, <span class="at">color =</span> method, <span class="at">linetype =</span> method)) <span class="sc">+</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"True"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"Julia"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"PAM (mgcv)"</span> <span class="ot">=</span> <span class="st">"dotted"</span>, <span class="st">"flexsurv"</span> <span class="ot">=</span> <span class="st">"twodash"</span>)) <span class="sc">+</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> event, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Incidence Functions"</span>,</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Starting from State 1 (Healthy)"</span>,</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative Incidence"</span>,</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Method"</span>,</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"Method"</span></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="spline_comparison_benchmark_files/figure-html/ci-plots-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cumulative-incidence-rmse" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-incidence-rmse">Cumulative Incidence RMSE</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ci_rmse <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cumulative_Incidence =</span> <span class="fu">c</span>(<span class="st">"CI12 (Illness)"</span>, <span class="st">"CI13 (Direct Death)"</span>, <span class="st">"CI Total Death"</span>),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Julia =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(ci_12_true, ci_12_julia),</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(ci_13_true, ci_13_julia),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rmse</span>(ci_death_true, ci_death_julia)),</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAM_mgcv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(ci_12_true, ci_12_pam),</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(ci_13_true, ci_13_pam),</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">rmse</span>(ci_death_true, ci_death_pam)),</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">flexsurv =</span> <span class="fu">c</span>(<span class="fu">rmse</span>(ci_12_true, ci_12_flex),</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(ci_13_true, ci_13_flex),</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rmse</span>(ci_death_true, ci_death_flex))</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(ci_rmse, <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Cumulative Incidence RMSE (vs True)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Cumulative Incidence RMSE (vs True)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Cumulative_Incidence</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Julia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PAM_mgcv</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">flexsurv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CI12 (Illness)</td>
<td style="text-align: right;">0.00762</td>
<td style="text-align: right;">0.00720</td>
<td style="text-align: right;">0.00793</td>
</tr>
<tr class="even">
<td style="text-align: left;">CI13 (Direct Death)</td>
<td style="text-align: right;">0.00911</td>
<td style="text-align: right;">0.00791</td>
<td style="text-align: right;">0.00948</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CI Total Death</td>
<td style="text-align: right;">0.02269</td>
<td style="text-align: right;">0.05474</td>
<td style="text-align: right;">0.02337</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<section id="overall-comparison" class="level2">
<h2 class="anchored" data-anchor-id="overall-comparison">Overall Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Category =</span> <span class="fu">c</span>(<span class="st">"Hazard h12"</span>, <span class="st">"Hazard h13"</span>, <span class="st">"Hazard h23"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Prevalence P1"</span>, <span class="st">"Prevalence P2"</span>, <span class="st">"Prevalence P3"</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"CI Illness"</span>, <span class="st">"CI Direct Death"</span>, <span class="st">"CI Total Death"</span>),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Julia =</span> <span class="fu">c</span>(hazard_rmse<span class="sc">$</span>Julia, prev_rmse<span class="sc">$</span>Julia, ci_rmse<span class="sc">$</span>Julia),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">PAM_mgcv =</span> <span class="fu">c</span>(hazard_rmse<span class="sc">$</span>PAM_mgcv, prev_rmse<span class="sc">$</span>PAM_mgcv, ci_rmse<span class="sc">$</span>PAM_mgcv),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flexsurv =</span> <span class="fu">c</span>(hazard_rmse<span class="sc">$</span>flexsurv, prev_rmse<span class="sc">$</span>flexsurv, ci_rmse<span class="sc">$</span>flexsurv)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add winner column</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>summary_df<span class="sc">$</span>Winner <span class="ot">&lt;-</span> <span class="fu">apply</span>(summary_df[, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Julia"</span>, <span class="st">"PAM (mgcv)"</span>, <span class="st">"flexsurv"</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  methods[<span class="fu">which.min</span>(x)]</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(summary_df, <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Summary: RMSE by Method and Metric"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">5</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Summary: RMSE by Method and Metric</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Category</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Julia</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PAM_mgcv</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">flexsurv</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hazard h12</td>
<td style="text-align: right;">0.01358</td>
<td style="text-align: right;">0.00645</td>
<td style="text-align: right;">0.00998</td>
<td style="text-align: left; font-weight: bold;">PAM (mgcv)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hazard h13</td>
<td style="text-align: right;">0.00429</td>
<td style="text-align: right;">0.00163</td>
<td style="text-align: right;">0.00491</td>
<td style="text-align: left; font-weight: bold;">PAM (mgcv)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hazard h23</td>
<td style="text-align: right;">0.13832</td>
<td style="text-align: right;">0.11949</td>
<td style="text-align: right;">0.22306</td>
<td style="text-align: left; font-weight: bold;">PAM (mgcv)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Prevalence P1</td>
<td style="text-align: right;">0.00790</td>
<td style="text-align: right;">0.01080</td>
<td style="text-align: right;">0.00803</td>
<td style="text-align: left; font-weight: bold;">Julia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prevalence P2</td>
<td style="text-align: right;">0.01633</td>
<td style="text-align: right;">0.05858</td>
<td style="text-align: right;">0.01752</td>
<td style="text-align: left; font-weight: bold;">Julia</td>
</tr>
<tr class="even">
<td style="text-align: left;">Prevalence P3</td>
<td style="text-align: right;">0.02269</td>
<td style="text-align: right;">0.05474</td>
<td style="text-align: right;">0.02337</td>
<td style="text-align: left; font-weight: bold;">Julia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CI Illness</td>
<td style="text-align: right;">0.00762</td>
<td style="text-align: right;">0.00720</td>
<td style="text-align: right;">0.00793</td>
<td style="text-align: left; font-weight: bold;">PAM (mgcv)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CI Direct Death</td>
<td style="text-align: right;">0.00911</td>
<td style="text-align: right;">0.00791</td>
<td style="text-align: right;">0.00948</td>
<td style="text-align: left; font-weight: bold;">PAM (mgcv)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CI Total Death</td>
<td style="text-align: right;">0.02269</td>
<td style="text-align: right;">0.05474</td>
<td style="text-align: right;">0.02337</td>
<td style="text-align: left; font-weight: bold;">Julia</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="computation-time" class="level2">
<h2 class="anchored" data-anchor-id="computation-time">Computation Time</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>timing_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">c</span>(<span class="st">"MultistateModels.jl (Julia)"</span>, <span class="st">"PAM (mgcv)"</span>, <span class="st">"flexsurv"</span>),</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fit_Time_s =</span> <span class="fu">c</span>(julia_results<span class="sc">$</span>julia_fit<span class="sc">$</span>fit_time_seconds, t_pam, t_flex),</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Approach =</span> <span class="fu">c</span>(<span class="st">"Joint likelihood (all transitions)"</span>, </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Separate GAMs (independent)"</span>, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Separate MLE (independent)"</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(timing_df, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Computation Time Comparison"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small">
<caption>Computation Time Comparison</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fit_Time_s</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Approach</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MultistateModels.jl (Julia)</td>
<td style="text-align: right;">13.22</td>
<td style="text-align: left;">Joint likelihood (all transitions)</td>
</tr>
<tr class="even">
<td style="text-align: left;">PAM (mgcv)</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">Separate GAMs (independent)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flexsurv</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: left;">Separate MLE (independent)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count wins</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>wins <span class="ot">&lt;-</span> <span class="fu">table</span>(summary_df<span class="sc">$</span>Winner)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Method Wins (out of 9 metrics):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Method Wins (out of 9 metrics):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wins)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Julia PAM (mgcv) 
         4          5 </code></pre>
</div>
</div>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings">Key Findings</h3>
<ol type="1">
<li><p><strong>MultistateModels.jl</strong> uses joint likelihood estimation, fitting all transition hazards simultaneously. This captures the multistate structure correctly.</p></li>
<li><p><strong>pammtools/mgcv</strong> fits each transition independently using GAMs with NCV smoothing parameter selection. While computationally efficient, it ignores cross-transition dependencies.</p></li>
<li><p><strong>flexsurv</strong> provides flexible parametric models with excellent hazard estimation but also fits transitions independently.</p></li>
<li><p>For <strong>state prevalence</strong> and <strong>cumulative incidence</strong> estimation, joint modeling (Julia) tends to outperform independent fitting approaches because it correctly accounts for competing risks.</p></li>
</ol>
</section>
<section id="recommendations" class="level3">
<h3 class="anchored" data-anchor-id="recommendations">Recommendations</h3>
<ul>
<li>For exploratory analysis of individual hazard shapes: Any method works well</li>
<li>For accurate prevalence/cumulative incidence prediction: Joint likelihood (Julia) preferred</li>
<li>For large datasets with complex covariate structures: Consider pammtools for flexibility</li>
</ul>
</section>
</section>
</section>
<section id="session-info" class="level1">
<h1>Session Info</h1>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.7.3

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] splines   stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] kableExtra_1.4.0 knitr_1.50       patchwork_1.3.2  jsonlite_2.0.0  
 [5] expm_1.0-0       Matrix_1.7-3     mstate_0.3.3     flexsurv_2.3.2  
 [9] survival_3.8-3   pammtools_0.7.3  mgcv_1.9-3       nlme_3.1-168    
[13] lubridate_1.9.4  forcats_1.0.0    stringr_1.5.1    dplyr_1.1.4     
[17] purrr_1.1.0      readr_2.1.5      tidyr_1.3.1      tibble_3.3.0    
[21] ggplot2_3.5.2    tidyverse_2.0.0 

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1    viridisLite_0.4.2   farver_2.1.2       
 [4] fastmap_1.2.0       lazyeval_0.2.2      digest_0.6.37      
 [7] timechange_0.3.0    lifecycle_1.0.4     statmod_1.5.1      
[10] magrittr_2.0.3      compiler_4.5.1      rlang_1.1.6        
[13] tools_4.5.1         yaml_2.3.10         data.table_1.17.8  
[16] labeling_0.4.3      timereg_2.0.7       htmlwidgets_1.6.4  
[19] xml2_1.4.0          RColorBrewer_1.1-3  withr_3.0.2        
[22] numDeriv_2016.8-1.1 pec_2025.06.24      grid_4.5.1         
[25] future_1.67.0       globals_0.18.0      scales_1.4.0       
[28] iterators_1.0.14    cli_3.6.5           mvtnorm_1.3-3      
[31] rmarkdown_2.29      generics_0.1.4      rstudioapi_0.17.1  
[34] future.apply_1.20.0 tzdb_0.5.0          parallel_4.5.1     
[37] scam_1.2-20         muhaz_1.2.6.4       vctrs_0.6.5        
[40] hms_1.1.3           Formula_1.2-5       listenv_0.9.1      
[43] systemfonts_1.2.3   foreach_1.5.2       glue_1.8.0         
[46] parallelly_1.45.1   codetools_0.2-20    stringi_1.8.7      
[49] gtable_0.3.6        quadprog_1.5-8      pillar_1.11.0      
[52] htmltools_0.5.8.1   deSolve_1.40        lava_1.8.1         
[55] R6_2.6.1            textshaping_1.0.1   evaluate_1.0.5     
[58] lattice_0.22-7      backports_1.5.0     Rcpp_1.1.0         
[61] svglite_2.2.1       prodlim_2025.04.28  checkmate_2.3.3    
[64] xfun_0.53           pkgconfig_2.0.3    </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 MultistateModels.jl</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/blob/main/spline_comparison_benchmark.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/fintzij/MultistateModelsTests.jl/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>